(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,41931,e=>{"use strict";let t=e.i(47167).default.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",a=!1;class r extends Error{status;constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function i(e){if(!e.ok){let t=await e.text().catch(()=>"Unknown error");throw new r(e.status,t)}return e.json()}let s=[{id:1,name:"KAFD Tower Complex",region:"saudi_arabia",building_type:"office",phase:"design_development",gfa:45e3,floors:32,status:"In progress"},{id:2,name:"Al Maryah Residences",region:"uae",building_type:"residential",phase:"schematic",gfa:28e3,floors:18,status:"Review"},{id:3,name:"Qatar Innovation Hub",region:"qatar",building_type:"mixed_use",phase:"construction_documents",gfa:62e3,floors:24,status:"Completed"}],n=100;e.s(["apiClient",0,{async checkBackend(){try{let e=new AbortController,r=setTimeout(()=>e.abort(),2e3),i=await fetch(`${t}/api/state`,{signal:e.signal,method:"GET"});return clearTimeout(r),a=!i.ok,i.ok}catch{return a=!0,console.warn("Backend not available, using demo mode"),!1}},isDemoMode:()=>a,getBackendStatus:()=>a?{available:!1,message:"Backend server is not connected. Start the backend to view generated content."}:{available:!0,message:""},async retryConnection(){let e=a,t=await this.checkBackend();return e&&t&&console.info("Backend connection restored"),t},async getState(){try{let e=await fetch(`${t}/api/state`);return i(e)}catch{return a=!0,{project:null,run:null,outputs:null}}},async updateState(e){if(a){let t={id:n++,name:e.project.name||"New Project",region:e.project.region||"saudi_arabia",building_type:e.project.building_type||"office",phase:e.project.phase||"schematic",gfa:e.project.gfa||1e4,floors:e.project.floors||10,status:"Draft",...e.project};return s.unshift(t),{project:t,run:null,outputs:null}}return i(await fetch(`${t}/api/state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))},async createProject(e){return this.updateState({project:e})},async getProject(e){if(a){let t="number"==typeof e?e:Number(e);return Number.isFinite(t)&&s.find(e=>e.id===t)||null}return(await this.getState()).project},getProjects:()=>s,async startRun(e,r="full"){if(a){let t=s.find(t=>t.id===e);return t&&(t.status="In progress"),{project:t||null,run:{id:Date.now(),project_id:e,status:"In progress",conflicts:0,started_at:new Date().toISOString()},outputs:null}}return i(await fetch(`${t}/api/runs/start?project_id=${e}&stage=${r}`,{method:"POST"}))},getRunEvents:async e=>a?[{id:1,run_id:e,message:"Starting design generation...",level:"info",step:"init",created_at:new Date().toISOString()},{id:2,run_id:e,message:"Analyzing site context",level:"info",step:"analysis",created_at:new Date().toISOString()},{id:3,run_id:e,message:"Generating floor plans",level:"info",step:"architectural",created_at:new Date().toISOString()}]:i(await fetch(`${t}/api/runs/${e}/events`)),async getRunArtifacts(e){if(a)return console.warn("[Demo Mode] Artifacts not available - backend connection required"),[];try{let a=await fetch(`${t}/api/runs/${e}/artifacts`);return i(a)}catch(e){return console.error("Failed to fetch artifacts:",e),[]}},async getLatestRunForProject(e){if(a)return console.warn("[Demo Mode] Runs not available - backend connection required"),null;try{let a=await fetch(`${t}/api/projects/${e}/runs/latest`);return(await i(a)).run}catch{return null}},getPlanRevision:async e=>a?{}:i(await fetch(`${t}/api/runs/${e}/plan`)),async savePlanRevision(e,r){a?console.log("Demo mode: Plan saved locally",r):await fetch(`${t}/api/runs/${e}/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:r})})},getFileUrl:(e,a,r)=>`${t}/files/${e}/${a}/${r}`,async fetchFile(e){let t=await fetch(e);if(!t.ok)throw new r(t.status,"Failed to fetch file");return t.text()},async getRunOutputs(e,t){let a=await this.getRunArtifacts(t),r={};for(let i of a){let a=this.getFileUrl(e,t,i.file_name);r[i.kind]=a}return r},async downloadFile(e,t,a){let i=this.getFileUrl(e,t,a),s=await fetch(i);if(!s.ok)throw new r(s.status,"Failed to download file");let n=await s.blob(),l=URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.download=a,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)}}])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},66823,e=>{"use strict";var t=e.i(43476),a=e.i(18566),r=e.i(71645),i=e.i(88844),s=e.i(75254);let n=(0,s.default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),l=(0,s.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var c=e.i(72664);let o=(0,s.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),d=(0,s.default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var u=e.i(69638),m=e.i(3116);let h=(0,s.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]);var p=e.i(31278);e.i(16787);var f=e.i(39964),g=e.i(59544),x=e.i(96640),y=e.i(41740),v=e.i(41931),j=e.i(32171),k=e.i(37625);let w={ifc:{name:"BIM Model",nameAr:"نموذج BIM",description:"IFC 4.0 format",descriptionAr:"صيغة IFC 4.0",icon:c.Box},plan_svg:{name:"Floor Plans",nameAr:"مخططات الطوابق",description:"SVG vector drawings",descriptionAr:"رسومات SVG",icon:o},dxf:{name:"CAD Drawing",nameAr:"رسم CAD",description:"DXF format for AutoCAD",descriptionAr:"صيغة DXF لـ AutoCAD",icon:h},gltf:{name:"3D Model",nameAr:"نموذج ثلاثي الأبعاد",description:"glTF 2.0 format",descriptionAr:"صيغة glTF 2.0",icon:c.Box},schedule:{name:"MEP Schedule",nameAr:"جدول MEP",description:"Excel spreadsheet",descriptionAr:"جدول Excel",icon:d},energy_report:{name:"Energy Report",nameAr:"تقرير الطاقة",description:"PDF analysis",descriptionAr:"تحليل PDF",icon:n},structural_report:{name:"Structural Report",nameAr:"التقرير الهيكلي",description:"PDF analysis",descriptionAr:"تحليل PDF",icon:n},structural_plan:{name:"Structural Plan",nameAr:"المخطط الهيكلي",description:"SVG structural layout",descriptionAr:"تخطيط هيكلي SVG",icon:o},mep_layout:{name:"MEP Layout",nameAr:"تخطيط MEP",description:"SVG MEP drawing",descriptionAr:"رسم MEP بصيغة SVG",icon:o},review_package:{name:"Review Package",nameAr:"حزمة المراجعة",description:"ZIP with all files",descriptionAr:"ملف ZIP بكل الملفات",icon:i.Package}};function b(){let e=(0,a.useParams)(),{language:s}=(0,j.useUIStore)(),{project:c,run:o,setProject:d,setRun:h}=(0,k.useProjectStore)(),b="ar"===s,N=(Array.isArray(e.id)?e.id[0]:e.id)??"",[C,A]=(0,r.useState)([]),[S,P]=(0,r.useState)(!0),[M,R]=(0,r.useState)(null),[_,F]=(0,r.useState)({available:!0,message:""});(0,r.useEffect)(()=>{(async()=>{await v.apiClient.checkBackend(),F(v.apiClient.getBackendStatus());let e=await v.apiClient.getProject(N);if(e){d(e);let t=await v.apiClient.getLatestRunForProject(N);t&&h(t)}})()},[N,d,h]);let D=async()=>{await v.apiClient.retryConnection()?window.location.reload():F(v.apiClient.getBackendStatus())};(0,r.useEffect)(()=>{(async()=>{if(!o?.id)return P(!1);try{P(!0);let e=(await v.apiClient.getRunArtifacts(o.id)).map(e=>{let t=w[e.kind]||{name:e.kind,nameAr:e.kind,description:e.description||"",descriptionAr:e.description||"",icon:n};return{id:e.kind,...t,fileName:e.file_name,status:"ready"}});A(e)}catch(e){console.error("Failed to load artifacts:",e)}finally{P(!1)}})()},[o?.id]);let B=(0,r.useCallback)(async e=>{if(c?.id&&o?.id&&e.fileName){R(e.id);try{let t=v.apiClient.getFileUrl(c.id,o.id,e.fileName),a=await fetch(t);if(!a.ok)throw Error("Download failed");let r=await a.blob(),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=e.fileName,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}catch(e){console.error("Download failed:",e)}finally{R(null)}}},[c?.id,o?.id]),E=(0,r.useCallback)(async()=>{let e=C.find(e=>"review_package"===e.id);if(e)B(e);else for(let e of C)"ready"===e.status&&e.fileName&&await B(e)},[C,B]);return(0,t.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-bold uppercase tracking-[3px] text-[var(--accent-2)] mb-1",children:c?.name||(b?"المشروع":"Project")}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-[var(--ink)]",children:b?"المخرجات":"Deliverables"})]}),(0,t.jsxs)(g.Button,{className:"flex items-center gap-2",onClick:E,disabled:0===C.length||S,children:[(0,t.jsx)(i.Package,{className:"w-4 h-4"}),b?"تحميل الكل":"Download All"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(f.Card,{children:(0,t.jsxs)(f.CardContent,{className:"p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:b?"الملفات المتاحة":"Available Files"}),S?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(p.Loader2,{className:"w-8 h-8 animate-spin text-[var(--accent)]"})}):0===C.length?(0,t.jsxs)("div",{className:"text-center py-12 text-[var(--ink-soft)]",children:[(0,t.jsx)(i.Package,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),_.available?o?.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:b?"لا توجد ملفات متاحة":"No files available"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:b?"ابدأ التوليد لإنشاء الملفات":"Start generation to create files"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"font-medium",children:b?"لا يوجد تشغيل نشط":"No Active Run"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:b?"انتقل إلى المنظم لبدء التوليد":"Go to Orchestrator to start generation"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-medium text-amber-600",children:b?"الخادم غير متصل":"Backend Not Connected"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:b?"قم بتشغيل الخادم لعرض الملفات المتاحة":"Start the backend server to view available files"}),(0,t.jsx)(g.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:D,children:b?"إعادة المحاولة":"Retry Connection"})]})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:C.map(e=>{let a=e.icon,r="ready"===e.status,i=M===e.id;return(0,t.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-[var(--radius-md)] border border-[var(--line)] bg-[var(--surface-2)]",children:[(0,t.jsx)("div",{className:"p-3 bg-[var(--surface)] rounded-[var(--radius-sm)] border border-[var(--line)]",children:(0,t.jsx)(a,{className:"w-6 h-6 text-[var(--accent)]"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-[var(--ink)] truncate",children:b?e.nameAr:e.name}),r?(0,t.jsx)(u.CheckCircle,{className:"w-4 h-4 text-[var(--accent-3)]"}):(0,t.jsx)(m.Clock,{className:"w-4 h-4 text-[var(--ink-faint)]"})]}),(0,t.jsx)("p",{className:"text-sm text-[var(--ink-soft)]",children:b?e.descriptionAr:e.description}),e.fileName&&(0,t.jsx)("p",{className:"text-xs text-[var(--ink-faint)] mt-1 font-mono truncate",children:e.fileName})]}),(0,t.jsx)(g.Button,{variant:"outline",size:"sm",disabled:!r||i,className:"flex-shrink-0",onClick:()=>B(e),children:i?(0,t.jsx)(p.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(l,{className:"w-4 h-4"})})]},e.id)})})]})})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(f.Card,{children:(0,t.jsxs)(f.CardContent,{className:"p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:b?"صحة النموذج":"Model Health"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(y.Progress,{value:95,label:b?"خالي من التعارض":"Clash Free",variant:"success"}),(0,t.jsx)(y.Progress,{value:88,label:b?"الامتثال للكود":"Code Compliance",variant:"success"}),(0,t.jsx)(y.Progress,{value:72,label:b?"كفاءة الطاقة":"Energy Score",variant:"warning"}),(0,t.jsx)(y.Progress,{value:91,label:b?"السلامة الهيكلية":"Structural Score",variant:"success"})]})]})}),(0,t.jsx)(f.Card,{children:(0,t.jsxs)(f.CardContent,{className:"p-5",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:b?"ملاحظات المراجعة":"Review Notes"}),(0,t.jsx)("textarea",{placeholder:b?"أضف ملاحظاتك هنا...":"Add your notes here...",className:"w-full min-h-[100px] p-3 rounded-[var(--radius-sm)] border border-[var(--line)] bg-white text-sm resize-none focus:outline-none focus:border-[var(--accent)]"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[(0,t.jsxs)("select",{className:"flex-1 p-2 rounded-[var(--radius-sm)] border border-[var(--line)] bg-white text-sm",children:[(0,t.jsx)("option",{children:b?"اختر الفئة":"Select category"}),(0,t.jsx)("option",{children:b?"معماري":"Architectural"}),(0,t.jsx)("option",{children:b?"هيكلي":"Structural"}),(0,t.jsx)("option",{children:"MEP"})]}),(0,t.jsx)(g.Button,{size:"sm",children:b?"إضافة":"Add"})]})]})}),(0,t.jsx)(f.Card,{children:(0,t.jsxs)(f.CardContent,{className:"p-5 text-center",children:[(0,t.jsx)(x.Badge,{variant:"warning",className:"mb-3",children:b?"قيد المراجعة":"Pending Review"}),(0,t.jsx)("p",{className:"text-sm text-[var(--ink-soft)] mb-4",children:b?"وافق على التصميم لبدء توليد التفاصيل":"Approve design to start generating detailed output"}),(0,t.jsx)(g.Button,{className:"w-full",children:b?"الموافقة على التصميم":"Approve Design"})]})})]})]})]})}e.s(["default",()=>b],66823)}]);