module.exports=[91938,a=>{"use strict";let b=process.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",c=!1;class d extends Error{status;constructor(a,b){super(b),this.status=a,this.name="ApiError"}}async function e(a){if(!a.ok){let b=await a.text().catch(()=>"Unknown error");throw new d(a.status,b)}return a.json()}let f=[{id:1,name:"KAFD Tower Complex",region:"saudi_arabia",building_type:"office",phase:"design_development",gfa:45e3,floors:32,status:"In progress"},{id:2,name:"Al Maryah Residences",region:"uae",building_type:"residential",phase:"schematic",gfa:28e3,floors:18,status:"Review"},{id:3,name:"Qatar Innovation Hub",region:"qatar",building_type:"mixed_use",phase:"construction_documents",gfa:62e3,floors:24,status:"Completed"}],g=100;a.s(["apiClient",0,{async checkBackend(){try{let a=new AbortController,d=setTimeout(()=>a.abort(),2e3),e=await fetch(`${b}/api/state`,{signal:a.signal,method:"GET"});return clearTimeout(d),c=!e.ok,e.ok}catch{return c=!0,console.warn("Backend not available, using demo mode"),!1}},isDemoMode:()=>c,getBackendStatus:()=>c?{available:!1,message:"Backend server is not connected. Start the backend to view generated content."}:{available:!0,message:""},async retryConnection(){let a=c,b=await this.checkBackend();return a&&b&&console.info("Backend connection restored"),b},async getState(){try{let a=await fetch(`${b}/api/state`);return e(a)}catch{return c=!0,{project:null,run:null,outputs:null}}},async updateState(a){if(c){let b={id:g++,name:a.project.name||"New Project",region:a.project.region||"saudi_arabia",building_type:a.project.building_type||"office",phase:a.project.phase||"schematic",gfa:a.project.gfa||1e4,floors:a.project.floors||10,status:"Draft",...a.project};return f.unshift(b),{project:b,run:null,outputs:null}}return e(await fetch(`${b}/api/state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}))},async createProject(a){return this.updateState({project:a})},async getProject(a){if(c){let b="number"==typeof a?a:Number(a);return Number.isFinite(b)&&f.find(a=>a.id===b)||null}return(await this.getState()).project},getProjects:()=>f,async startRun(a,d="full"){if(c){let b=f.find(b=>b.id===a);return b&&(b.status="In progress"),{project:b||null,run:{id:Date.now(),project_id:a,status:"In progress",conflicts:0,started_at:new Date().toISOString()},outputs:null}}return e(await fetch(`${b}/api/runs/start?project_id=${a}&stage=${d}`,{method:"POST"}))},getRunEvents:async a=>c?[{id:1,run_id:a,message:"Starting design generation...",level:"info",step:"init",created_at:new Date().toISOString()},{id:2,run_id:a,message:"Analyzing site context",level:"info",step:"analysis",created_at:new Date().toISOString()},{id:3,run_id:a,message:"Generating floor plans",level:"info",step:"architectural",created_at:new Date().toISOString()}]:e(await fetch(`${b}/api/runs/${a}/events`)),async getRunArtifacts(a){if(c)return console.warn("[Demo Mode] Artifacts not available - backend connection required"),[];try{let c=await fetch(`${b}/api/runs/${a}/artifacts`);return e(c)}catch(a){return console.error("Failed to fetch artifacts:",a),[]}},async getLatestRunForProject(a){if(c)return console.warn("[Demo Mode] Runs not available - backend connection required"),null;try{let c=await fetch(`${b}/api/projects/${a}/runs/latest`);return(await e(c)).run}catch{return null}},getPlanRevision:async a=>c?{}:e(await fetch(`${b}/api/runs/${a}/plan`)),async savePlanRevision(a,d){c?console.log("Demo mode: Plan saved locally",d):await fetch(`${b}/api/runs/${a}/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:d})})},getFileUrl:(a,c,d)=>`${b}/files/${a}/${c}/${d}`,async fetchFile(a){let b=await fetch(a);if(!b.ok)throw new d(b.status,"Failed to fetch file");return b.text()},async getRunOutputs(a,b){let c=await this.getRunArtifacts(b),d={};for(let e of c){let c=this.getFileUrl(a,b,e.file_name);d[e.kind]=c}return d},async downloadFile(a,b,c){let e=this.getFileUrl(a,b,c),f=await fetch(e);if(!f.ok)throw new d(f.status,"Failed to download file");let g=await f.blob(),h=URL.createObjectURL(g),i=document.createElement("a");i.href=h,i.download=c,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(h)}}])},96221,a=>{"use strict";let b=(0,a.i(70106).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Clock",()=>b],41710)},16201,a=>{"use strict";let b=(0,a.i(70106).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],16201)},72882,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(83497),f=a.i(70106);let g=(0,f.default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),h=(0,f.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var i=a.i(80032);let j=(0,f.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),k=(0,f.default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var l=a.i(16201),m=a.i(41710);let n=(0,f.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]);var o=a.i(96221);a.i(11909);var p=a.i(62067),q=a.i(96438),r=a.i(55486),s=a.i(90231),t=a.i(91938),u=a.i(30455),v=a.i(81211);let w={ifc:{name:"BIM Model",nameAr:"نموذج BIM",description:"IFC 4.0 format",descriptionAr:"صيغة IFC 4.0",icon:i.Box},plan_svg:{name:"Floor Plans",nameAr:"مخططات الطوابق",description:"SVG vector drawings",descriptionAr:"رسومات SVG",icon:j},dxf:{name:"CAD Drawing",nameAr:"رسم CAD",description:"DXF format for AutoCAD",descriptionAr:"صيغة DXF لـ AutoCAD",icon:n},gltf:{name:"3D Model",nameAr:"نموذج ثلاثي الأبعاد",description:"glTF 2.0 format",descriptionAr:"صيغة glTF 2.0",icon:i.Box},schedule:{name:"MEP Schedule",nameAr:"جدول MEP",description:"Excel spreadsheet",descriptionAr:"جدول Excel",icon:k},energy_report:{name:"Energy Report",nameAr:"تقرير الطاقة",description:"PDF analysis",descriptionAr:"تحليل PDF",icon:g},structural_report:{name:"Structural Report",nameAr:"التقرير الهيكلي",description:"PDF analysis",descriptionAr:"تحليل PDF",icon:g},structural_plan:{name:"Structural Plan",nameAr:"المخطط الهيكلي",description:"SVG structural layout",descriptionAr:"تخطيط هيكلي SVG",icon:j},mep_layout:{name:"MEP Layout",nameAr:"تخطيط MEP",description:"SVG MEP drawing",descriptionAr:"رسم MEP بصيغة SVG",icon:j},review_package:{name:"Review Package",nameAr:"حزمة المراجعة",description:"ZIP with all files",descriptionAr:"ملف ZIP بكل الملفات",icon:e.Package}};function x(){let a=(0,c.useParams)(),{language:f}=(0,u.useUIStore)(),{project:i,run:j,setProject:k,setRun:n}=(0,v.useProjectStore)(),x="ar"===f,y=(Array.isArray(a.id)?a.id[0]:a.id)??"",[z,A]=(0,d.useState)([]),[B,C]=(0,d.useState)(!0),[D,E]=(0,d.useState)(null),[F,G]=(0,d.useState)({available:!0,message:""});(0,d.useEffect)(()=>{(async()=>{await t.apiClient.checkBackend(),G(t.apiClient.getBackendStatus());let a=await t.apiClient.getProject(y);if(a){k(a);let b=await t.apiClient.getLatestRunForProject(y);b&&n(b)}})()},[y,k,n]);let H=async()=>{await t.apiClient.retryConnection()?window.location.reload():G(t.apiClient.getBackendStatus())};(0,d.useEffect)(()=>{(async()=>{if(!j?.id)return C(!1);try{C(!0);let a=(await t.apiClient.getRunArtifacts(j.id)).map(a=>{let b=w[a.kind]||{name:a.kind,nameAr:a.kind,description:a.description||"",descriptionAr:a.description||"",icon:g};return{id:a.kind,...b,fileName:a.file_name,status:"ready"}});A(a)}catch(a){console.error("Failed to load artifacts:",a)}finally{C(!1)}})()},[j?.id]);let I=(0,d.useCallback)(async a=>{if(i?.id&&j?.id&&a.fileName){E(a.id);try{let b=t.apiClient.getFileUrl(i.id,j.id,a.fileName),c=await fetch(b);if(!c.ok)throw Error("Download failed");let d=await c.blob(),e=URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=a.fileName,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(e)}catch(a){console.error("Download failed:",a)}finally{E(null)}}},[i?.id,j?.id]),J=(0,d.useCallback)(async()=>{let a=z.find(a=>"review_package"===a.id);if(a)I(a);else for(let a of z)"ready"===a.status&&a.fileName&&await I(a)},[z,I]);return(0,b.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-bold uppercase tracking-[3px] text-[var(--accent-2)] mb-1",children:i?.name||(x?"المشروع":"Project")}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-[var(--ink)]",children:x?"المخرجات":"Deliverables"})]}),(0,b.jsxs)(q.Button,{className:"flex items-center gap-2",onClick:J,disabled:0===z.length||B,children:[(0,b.jsx)(e.Package,{className:"w-4 h-4"}),x?"تحميل الكل":"Download All"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsx)(p.Card,{children:(0,b.jsxs)(p.CardContent,{className:"p-5",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:x?"الملفات المتاحة":"Available Files"}),B?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(o.Loader2,{className:"w-8 h-8 animate-spin text-[var(--accent)]"})}):0===z.length?(0,b.jsxs)("div",{className:"text-center py-12 text-[var(--ink-soft)]",children:[(0,b.jsx)(e.Package,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),F.available?j?.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:x?"لا توجد ملفات متاحة":"No files available"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:x?"ابدأ التوليد لإنشاء الملفات":"Start generation to create files"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"font-medium",children:x?"لا يوجد تشغيل نشط":"No Active Run"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:x?"انتقل إلى المنظم لبدء التوليد":"Go to Orchestrator to start generation"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-medium text-amber-600",children:x?"الخادم غير متصل":"Backend Not Connected"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:x?"قم بتشغيل الخادم لعرض الملفات المتاحة":"Start the backend server to view available files"}),(0,b.jsx)(q.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:H,children:x?"إعادة المحاولة":"Retry Connection"})]})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:z.map(a=>{let c=a.icon,d="ready"===a.status,e=D===a.id;return(0,b.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-[var(--radius-md)] border border-[var(--line)] bg-[var(--surface-2)]",children:[(0,b.jsx)("div",{className:"p-3 bg-[var(--surface)] rounded-[var(--radius-sm)] border border-[var(--line)]",children:(0,b.jsx)(c,{className:"w-6 h-6 text-[var(--accent)]"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-[var(--ink)] truncate",children:x?a.nameAr:a.name}),d?(0,b.jsx)(l.CheckCircle,{className:"w-4 h-4 text-[var(--accent-3)]"}):(0,b.jsx)(m.Clock,{className:"w-4 h-4 text-[var(--ink-faint)]"})]}),(0,b.jsx)("p",{className:"text-sm text-[var(--ink-soft)]",children:x?a.descriptionAr:a.description}),a.fileName&&(0,b.jsx)("p",{className:"text-xs text-[var(--ink-faint)] mt-1 font-mono truncate",children:a.fileName})]}),(0,b.jsx)(q.Button,{variant:"outline",size:"sm",disabled:!d||e,className:"flex-shrink-0",onClick:()=>I(a),children:e?(0,b.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(h,{className:"w-4 h-4"})})]},a.id)})})]})})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(p.Card,{children:(0,b.jsxs)(p.CardContent,{className:"p-5",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:x?"صحة النموذج":"Model Health"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(s.Progress,{value:95,label:x?"خالي من التعارض":"Clash Free",variant:"success"}),(0,b.jsx)(s.Progress,{value:88,label:x?"الامتثال للكود":"Code Compliance",variant:"success"}),(0,b.jsx)(s.Progress,{value:72,label:x?"كفاءة الطاقة":"Energy Score",variant:"warning"}),(0,b.jsx)(s.Progress,{value:91,label:x?"السلامة الهيكلية":"Structural Score",variant:"success"})]})]})}),(0,b.jsx)(p.Card,{children:(0,b.jsxs)(p.CardContent,{className:"p-5",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-[var(--ink)] mb-4",children:x?"ملاحظات المراجعة":"Review Notes"}),(0,b.jsx)("textarea",{placeholder:x?"أضف ملاحظاتك هنا...":"Add your notes here...",className:"w-full min-h-[100px] p-3 rounded-[var(--radius-sm)] border border-[var(--line)] bg-white text-sm resize-none focus:outline-none focus:border-[var(--accent)]"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[(0,b.jsxs)("select",{className:"flex-1 p-2 rounded-[var(--radius-sm)] border border-[var(--line)] bg-white text-sm",children:[(0,b.jsx)("option",{children:x?"اختر الفئة":"Select category"}),(0,b.jsx)("option",{children:x?"معماري":"Architectural"}),(0,b.jsx)("option",{children:x?"هيكلي":"Structural"}),(0,b.jsx)("option",{children:"MEP"})]}),(0,b.jsx)(q.Button,{size:"sm",children:x?"إضافة":"Add"})]})]})}),(0,b.jsx)(p.Card,{children:(0,b.jsxs)(p.CardContent,{className:"p-5 text-center",children:[(0,b.jsx)(r.Badge,{variant:"warning",className:"mb-3",children:x?"قيد المراجعة":"Pending Review"}),(0,b.jsx)("p",{className:"text-sm text-[var(--ink-soft)] mb-4",children:x?"وافق على التصميم لبدء توليد التفاصيل":"Approve design to start generating detailed output"}),(0,b.jsx)(q.Button,{className:"w-full",children:x?"الموافقة على التصميم":"Approve Design"})]})})]})]})]})}a.s(["default",()=>x],72882)}];

//# sourceMappingURL=_a8da9a08._.js.map