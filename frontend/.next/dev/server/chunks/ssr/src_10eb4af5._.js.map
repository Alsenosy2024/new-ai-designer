{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/ModelViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport { Suspense, useRef, useState, useEffect } from \"react\";\nimport { Canvas, useThree, useFrame, invalidate } from \"@react-three/fiber\";\nimport { OrbitControls, Grid, useGLTF, Environment, Center } from \"@react-three/drei\";\nimport { Loader2, Box, RotateCcw, ZoomIn, ZoomOut } from \"lucide-react\";\nimport * as THREE from \"three\";\n\n// Performance constants\nconst TARGET_FPS = 30;\nconst MAX_PIXEL_RATIO = 1.5;\n\ninterface ModelProps {\n  url: string;\n  onLoad?: () => void;\n  onError?: (error: Error) => void;\n}\n\nfunction Model({ url, onLoad, onError }: ModelProps) {\n  const { scene } = useGLTF(url, true, true, (loader) => {\n    loader.manager.onLoad = () => onLoad?.();\n    loader.manager.onError = (url) => onError?.(new Error(`Failed to load: ${url}`));\n  });\n\n  useEffect(() => {\n    if (scene) {\n      // Center and scale the model\n      const box = new THREE.Box3().setFromObject(scene);\n      const center = box.getCenter(new THREE.Vector3());\n      const size = box.getSize(new THREE.Vector3());\n\n      // Move model to origin\n      scene.position.sub(center);\n\n      // Scale to fit\n      const maxDim = Math.max(size.x, size.y, size.z);\n      if (maxDim > 50) {\n        const scale = 50 / maxDim;\n        scene.scale.setScalar(scale);\n      }\n    }\n  }, [scene]);\n\n  return <primitive object={scene} />;\n}\n\nfunction CameraController() {\n  const { camera } = useThree();\n\n  useEffect(() => {\n    camera.position.set(60, 40, 60);\n    camera.lookAt(0, 0, 0);\n  }, [camera]);\n\n  return null;\n}\n\n// Frame rate limiter for performance optimization\nfunction FrameLimiter() {\n  const lastFrameTime = useRef(0);\n  const frameInterval = 1000 / TARGET_FPS;\n\n  useFrame((state) => {\n    const currentTime = state.clock.elapsedTime * 1000;\n    if (currentTime - lastFrameTime.current >= frameInterval) {\n      lastFrameTime.current = currentTime;\n      invalidate(); // Request next frame\n    }\n  });\n\n  return null;\n}\n\nfunction LoadingFallback() {\n  const meshRef = useRef<THREE.Mesh>(null);\n\n  useFrame((state) => {\n    if (meshRef.current) {\n      meshRef.current.rotation.y = state.clock.elapsedTime * 0.5;\n    }\n  });\n\n  return (\n    <mesh ref={meshRef}>\n      <boxGeometry args={[10, 10, 10]} />\n      <meshStandardMaterial color=\"#c7b8a8\" wireframe />\n    </mesh>\n  );\n}\n\ninterface ModelViewerProps {\n  modelUrl: string;\n  className?: string;\n}\n\nexport function ModelViewer({ modelUrl, className = \"\" }: ModelViewerProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  const controlsRef = useRef<any>(null);\n\n  const handleLoad = () => {\n    setLoading(false);\n    setError(null);\n  };\n\n  const handleError = (err: Error) => {\n    setLoading(false);\n    setError(err.message);\n  };\n\n  const resetCamera = () => {\n    if (controlsRef.current) {\n      controlsRef.current.reset();\n    }\n  };\n\n  // Pause rendering when tab is not visible\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      setIsVisible(!document.hidden);\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n  }, []);\n\n  if (!modelUrl) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-gradient-to-b from-[#e8e4dc] to-[#d4d0c8] ${className}`}>\n        <div className=\"text-center text-[var(--ink-faint)]\">\n          <Box className=\"w-16 h-16 mx-auto mb-4 opacity-30\" />\n          <p className=\"text-lg font-medium\">No model available</p>\n          <p className=\"text-sm mt-2\">Generate a project to view the 3D model</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative w-full h-full ${className}`}>\n      <Canvas\n        camera={{ position: [60, 40, 60], fov: 45 }}\n        style={{ background: \"linear-gradient(to bottom, #e8e4dc, #d4d0c8)\" }}\n        frameloop={isVisible ? \"demand\" : \"never\"} // Pause when tab hidden\n        dpr={[1, MAX_PIXEL_RATIO]} // Cap pixel ratio for performance\n        gl={{\n          antialias: false, // Disable expensive AA\n          alpha: true,\n          powerPreference: \"high-performance\",\n          stencil: false,\n          depth: true,\n        }}\n        performance={{ min: 0.5 }} // Allow quality reduction under load\n      >\n        <FrameLimiter />\n        <CameraController />\n\n        {/* Lighting */}\n        <ambientLight intensity={0.4} />\n        <directionalLight\n          position={[50, 50, 25]}\n          intensity={0.8}\n          castShadow\n          shadow-mapSize={[1024, 1024]}\n        />\n        <directionalLight position={[-30, 30, -25]} intensity={0.3} />\n\n        {/* Model */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Center>\n            <Model url={modelUrl} onLoad={handleLoad} onError={handleError} />\n          </Center>\n        </Suspense>\n\n        {/* Ground Grid - Optimized for performance */}\n        <Grid\n          args={[100, 100]}  // Reduced from 200x200 for better performance\n          position={[0, -0.1, 0]}\n          cellSize={10}  // Larger cells = fewer lines\n          cellThickness={0.5}\n          cellColor=\"#c9c0b5\"\n          sectionSize={50}\n          sectionThickness={1}\n          sectionColor=\"#b5aa9d\"\n          fadeDistance={80}  // Fade closer for performance\n          fadeStrength={1.5}\n          followCamera={false}\n        />\n\n        {/* Controls */}\n        <OrbitControls\n          ref={controlsRef}\n          enableDamping\n          dampingFactor={0.05}\n          minDistance={10}\n          maxDistance={300}\n          maxPolarAngle={Math.PI / 2}\n          target={[0, 0, 0]}\n        />\n      </Canvas>\n\n      {/* Loading Overlay */}\n      {loading && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-sm\">\n          <div className=\"text-center\">\n            <Loader2 className=\"w-10 h-10 mx-auto mb-3 animate-spin text-[var(--accent)]\" />\n            <p className=\"text-sm text-[var(--ink-soft)]\">Loading 3D model...</p>\n          </div>\n        </div>\n      )}\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"absolute top-4 left-4 right-4 bg-red-50 border border-red-200 rounded-lg p-3\">\n          <p className=\"text-sm text-red-600\">{error}</p>\n        </div>\n      )}\n\n      {/* Controls Overlay */}\n      <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-[var(--surface)] rounded-full px-4 py-2 shadow-lg border border-[var(--line)]\">\n        <button\n          onClick={resetCamera}\n          className=\"p-2 rounded-full hover:bg-[var(--bg-2)] text-[var(--ink-soft)] transition-colors\"\n          title=\"Reset view\"\n        >\n          <RotateCcw className=\"w-5 h-5\" />\n        </button>\n        <span className=\"text-xs text-[var(--ink-faint)] px-2\">\n          Drag to rotate | Scroll to zoom\n        </span>\n      </div>\n\n      {/* Model info */}\n      <div className=\"absolute top-4 right-4 bg-[var(--surface)] rounded-[var(--radius-sm)] px-3 py-1.5 shadow border border-[var(--line)]\">\n        <span className=\"text-xs text-[var(--ink-soft)] font-mono\">\n          glTF 2.0\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default ModelViewer;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/index.ts"],"sourcesContent":["export { ModelViewer } from \"./ModelViewer\";\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 454, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/lib/api-client.ts"],"sourcesContent":["import type {\n  StateResponse,\n  StatePayload,\n  RunEvent,\n  Artifact,\n  Project,\n  Run,\n} from \"@/types\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8001\";\n\n// Demo mode flag - set to true when backend is unavailable\nlet demoMode = false;\n\nclass ApiError extends Error {\n  constructor(\n    public status: number,\n    message: string\n  ) {\n    super(message);\n    this.name = \"ApiError\";\n  }\n}\n\nasync function handleResponse<T>(response: Response): Promise<T> {\n  if (!response.ok) {\n    const message = await response.text().catch(() => \"Unknown error\");\n    throw new ApiError(response.status, message);\n  }\n  return response.json();\n}\n\n// Demo data for when backend is unavailable\nconst demoProjects: Project[] = [\n  {\n    id: 1,\n    name: \"KAFD Tower Complex\",\n    region: \"saudi_arabia\",\n    building_type: \"office\",\n    phase: \"design_development\",\n    gfa: 45000,\n    floors: 32,\n    status: \"In progress\",\n  },\n  {\n    id: 2,\n    name: \"Al Maryah Residences\",\n    region: \"uae\",\n    building_type: \"residential\",\n    phase: \"schematic\",\n    gfa: 28000,\n    floors: 18,\n    status: \"Review\",\n  },\n  {\n    id: 3,\n    name: \"Qatar Innovation Hub\",\n    region: \"qatar\",\n    building_type: \"mixed_use\",\n    phase: \"construction_documents\",\n    gfa: 62000,\n    floors: 24,\n    status: \"Completed\",\n  },\n];\n\nlet nextProjectId = 100;\n\nexport const apiClient = {\n  // Check if backend is available\n  async checkBackend(): Promise<boolean> {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\n      const response = await fetch(`${API_BASE}/api/state`, {\n        signal: controller.signal,\n        method: \"GET\",\n      });\n      clearTimeout(timeoutId);\n      demoMode = !response.ok;\n      return response.ok;\n    } catch {\n      demoMode = true;\n      console.warn(\"Backend not available, using demo mode\");\n      return false;\n    }\n  },\n\n  isDemoMode(): boolean {\n    return demoMode;\n  },\n\n  // Check if backend is connected and return status info\n  getBackendStatus(): { available: boolean; message: string } {\n    if (demoMode) {\n      return {\n        available: false,\n        message: \"Backend server is not connected. Start the backend to view generated content.\",\n      };\n    }\n    return { available: true, message: \"\" };\n  },\n\n  // Retry backend connection\n  async retryConnection(): Promise<boolean> {\n    const wasDemo = demoMode;\n    const isAvailable = await this.checkBackend();\n    if (wasDemo && isAvailable) {\n      console.info(\"Backend connection restored\");\n    }\n    return isAvailable;\n  },\n\n  // State Management\n  async getState(): Promise<StateResponse> {\n    try {\n      const response = await fetch(`${API_BASE}/api/state`);\n      return handleResponse<StateResponse>(response);\n    } catch {\n      demoMode = true;\n      return { project: null, run: null, outputs: null };\n    }\n  },\n\n  async updateState(payload: StatePayload): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate project creation\n      const newProject: Project = {\n        id: nextProjectId++,\n        name: payload.project.name || \"New Project\",\n        region: payload.project.region || \"saudi_arabia\",\n        building_type: payload.project.building_type || \"office\",\n        phase: payload.project.phase || \"schematic\",\n        gfa: payload.project.gfa || 10000,\n        floors: payload.project.floors || 10,\n        status: \"Draft\",\n        ...payload.project,\n      };\n      demoProjects.unshift(newProject);\n      return { project: newProject, run: null, outputs: null };\n    }\n\n    const response = await fetch(`${API_BASE}/api/state`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    return handleResponse<StateResponse>(response);\n  },\n\n  // Project Operations\n  async createProject(project: Partial<Project>): Promise<StateResponse> {\n    return this.updateState({ project });\n  },\n\n  async getProject(id: string | number): Promise<Project | null> {\n    if (demoMode) {\n      const numericId = typeof id === \"number\" ? id : Number(id);\n      if (!Number.isFinite(numericId)) return null;\n      return demoProjects.find((p) => p.id === numericId) || null;\n    }\n    const state = await this.getState();\n    return state.project;\n  },\n\n  getProjects(): Project[] {\n    return demoProjects;\n  },\n\n  // Run Operations\n  async startRun(\n    projectId: string | number,\n    stage: \"architectural\" | \"full\" = \"full\"\n  ): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate run creation\n      const project = demoProjects.find((p) => p.id === projectId);\n      if (project) {\n        project.status = \"In progress\";\n      }\n      return {\n        project: project || null,\n        run: {\n          id: Date.now(),\n          project_id: projectId,\n          status: \"In progress\",\n          conflicts: 0,\n          started_at: new Date().toISOString(),\n        },\n        outputs: null,\n      };\n    }\n\n    const response = await fetch(\n      `${API_BASE}/api/runs/start?project_id=${projectId}&stage=${stage}`,\n      { method: \"POST\" }\n    );\n    return handleResponse<StateResponse>(response);\n  },\n\n  async getRunEvents(runId: string | number): Promise<RunEvent[]> {\n    if (demoMode) {\n      // Demo mode: return sample events\n      return [\n        { id: 1, run_id: runId, message: \"Starting design generation...\", level: \"info\", step: \"init\", created_at: new Date().toISOString() },\n        { id: 2, run_id: runId, message: \"Analyzing site context\", level: \"info\", step: \"analysis\", created_at: new Date().toISOString() },\n        { id: 3, run_id: runId, message: \"Generating floor plans\", level: \"info\", step: \"architectural\", created_at: new Date().toISOString() },\n      ];\n    }\n\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/events`);\n    return handleResponse<RunEvent[]>(response);\n  },\n\n  async getRunArtifacts(runId: string | number): Promise<Artifact[]> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Artifacts not available - backend connection required\");\n      return [];\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/runs/${runId}/artifacts`);\n      return handleResponse<Artifact[]>(response);\n    } catch (error) {\n      console.error(\"Failed to fetch artifacts:\", error);\n      return [];\n    }\n  },\n\n  // Get the latest run for a specific project\n  async getLatestRunForProject(projectId: string | number): Promise<Run | null> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Runs not available - backend connection required\");\n      return null;\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/projects/${projectId}/runs/latest`);\n      const data = await handleResponse<{ run: Run | null }>(response);\n      return data.run;\n    } catch {\n      return null;\n    }\n  },\n\n  // Plan Operations\n  async getPlanRevision(runId: string | number): Promise<Record<string, unknown>> {\n    if (demoMode) {\n      return {};\n    }\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/plan`);\n    return handleResponse<Record<string, unknown>>(response);\n  },\n\n  async savePlanRevision(\n    runId: string | number,\n    payload: Record<string, unknown>\n  ): Promise<void> {\n    if (demoMode) {\n      console.log(\"Demo mode: Plan saved locally\", payload);\n      return;\n    }\n    await fetch(`${API_BASE}/api/runs/${runId}/plan`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ payload }),\n    });\n  },\n\n  // File URLs\n  getFileUrl(projectId: string | number, runId: string | number, fileName: string): string {\n    return `${API_BASE}/files/${projectId}/${runId}/${fileName}`;\n  },\n\n  // Generic file fetch\n  async fetchFile(url: string): Promise<string> {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to fetch file\");\n    }\n    return response.text();\n  },\n\n  // Get run outputs with file URLs\n  async getRunOutputs(\n    projectId: string | number,\n    runId: string | number\n  ): Promise<{\n    plan_svg?: string;\n    gltf?: string;\n    ifc?: string;\n    dxf?: string;\n    schedule?: string;\n    energy_report?: string;\n    structural_report?: string;\n    structural_plan?: string;\n    mep_layout?: string;\n    review_package?: string;\n  }> {\n    const artifacts = await this.getRunArtifacts(runId);\n    const outputs: Record<string, string> = {};\n\n    for (const artifact of artifacts) {\n      const url = this.getFileUrl(projectId, runId, artifact.file_name);\n      outputs[artifact.kind] = url;\n    }\n\n    return outputs;\n  },\n\n  // Download a file by triggering browser download\n  async downloadFile(\n    projectId: string | number,\n    runId: string | number,\n    fileName: string\n  ): Promise<void> {\n    const url = this.getFileUrl(projectId, runId, fileName);\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to download file\");\n    }\n\n    const blob = await response.blob();\n    const downloadUrl = URL.createObjectURL(blob);\n\n    const a = document.createElement(\"a\");\n    a.href = downloadUrl;\n    a.download = fileName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(downloadUrl);\n  },\n};\n\nexport { ApiError };\n\n// Artifact kind constants for robust artifact finding\nexport const ARTIFACT_KINDS = {\n  PLAN_SVG: [\"plan\", \"plan_svg\"],\n  GLTF: [\"gltf\", \"model\", \"3d\"],\n  DXF: [\"dxf\", \"cad\"],\n  IFC: [\"ifc\", \"bim\"],\n  SCHEDULE: [\"schedule\", \"mep_schedule\"],\n  ENERGY_REPORT: [\"energy\", \"energy_report\"],\n  STRUCTURAL_REPORT: [\"structural\", \"structural_report\"],\n  STRUCTURAL_PLAN: [\"structural_plan\"],\n  MEP_LAYOUT: [\"mep\", \"mep_layout\"],\n  REVIEW_PACKAGE: [\"package\", \"review_package\"],\n} as const;\n\n// Helper to find artifact by kind with fallback to file extensions\nexport function findArtifactByKind(\n  artifacts: Artifact[],\n  kinds: readonly string[],\n  fileExtensions?: string[]\n): Artifact | undefined {\n  return artifacts.find((a) => {\n    // Check kind match\n    if (kinds.includes(a.kind)) return true;\n    // Check file extension match\n    if (fileExtensions?.some((ext) => a.file_name?.endsWith(ext))) return true;\n    return false;\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 825, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/app/project/%5Bid%5D/3d-view/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useParams } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport { Box, RotateCcw, ZoomIn, ZoomOut, Maximize, Layers } from \"lucide-react\";\nimport { Card, CardContent, Button } from \"@/components/ui\";\nimport { ModelViewer } from \"@/components/viewer\";\nimport { apiClient } from \"@/lib/api-client\";\nimport { useUIStore } from \"@/stores/ui-store\";\nimport { useProjectStore } from \"@/stores/project-store\";\n\nexport default function ThreeDViewPage() {\n  const params = useParams();\n  const { language } = useUIStore();\n  const { project, run, setProject, setRun } = useProjectStore();\n  const isRtl = language === \"ar\";\n  const projectIdParam = Array.isArray(params.id) ? params.id[0] : params.id;\n  const projectId = projectIdParam ?? \"\";\n  const [modelUrl, setModelUrl] = useState<string | null>(null);\n  const [selectedFloor, setSelectedFloor] = useState<number | null>(null);\n  const [backendStatus, setBackendStatus] = useState({ available: true, message: \"\" });\n\n  useEffect(() => {\n    const loadProjectAndRun = async () => {\n      // Check backend status first\n      const status = apiClient.getBackendStatus();\n      setBackendStatus(status);\n\n      const found = await apiClient.getProject(projectId);\n      if (found) {\n        setProject(found);\n        // Also load the latest run for this project\n        const latestRun = await apiClient.getLatestRunForProject(projectId);\n        if (latestRun) {\n          setRun(latestRun);\n        }\n      }\n    };\n    loadProjectAndRun();\n  }, [projectId, setProject, setRun]);\n\n  const handleRetryConnection = async () => {\n    const connected = await apiClient.retryConnection();\n    if (connected) {\n      window.location.reload();\n    } else {\n      setBackendStatus(apiClient.getBackendStatus());\n    }\n  };\n\n  // Load glTF model from artifacts\n  useEffect(() => {\n    const loadModel = async () => {\n      if (!run?.id || !project?.id) return;\n      try {\n        setModelUrl(null);\n        const artifacts = await apiClient.getRunArtifacts(run.id);\n        const gltfArtifact = artifacts.find(\n          (a) => a.kind === \"gltf\" || a.file_name?.endsWith(\".glb\") || a.file_name?.endsWith(\".gltf\")\n        );\n        if (gltfArtifact) {\n          const url = apiClient.getFileUrl(project.id, run.id, gltfArtifact.file_name);\n          setModelUrl(url);\n          return;\n        }\n\n        const state = await apiClient.getState().catch(() => null);\n        const outputFile = state?.outputs?.gltf_file;\n        const stateRunId = state?.run?.id ? String(state.run.id) : \"\";\n        const stateProjectId = state?.project?.id ? String(state.project.id) : \"\";\n        if (\n          outputFile &&\n          stateRunId &&\n          stateProjectId &&\n          stateRunId === String(run.id) &&\n          stateProjectId === String(project.id)\n        ) {\n          setModelUrl(apiClient.getFileUrl(project.id, run.id, outputFile));\n        }\n      } catch (error) {\n        console.error(\"Failed to load model:\", error);\n      }\n    };\n    loadModel();\n  }, [run?.id, project?.id]);\n\n  return (\n    <div className=\"space-y-4 animate-fade-in\">\n      {/* Page Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <p className=\"text-xs font-bold uppercase tracking-[3px] text-[var(--accent-2)] mb-1\">\n            {project?.name || (isRtl ? \"المشروع\" : \"Project\")}\n          </p>\n          <h1 className=\"text-2xl font-bold text-[var(--ink)]\">\n            {isRtl ? \"العرض ثلاثي الأبعاد\" : \"3D View\"}\n          </h1>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\">\n            <Layers className=\"w-4 h-4 mr-2\" />\n            {isRtl ? \"الطوابق\" : \"Floors\"}\n          </Button>\n          <Button variant=\"outline\" size=\"sm\">\n            <Maximize className=\"w-4 h-4 mr-2\" />\n            {isRtl ? \"ملء الشاشة\" : \"Fullscreen\"}\n          </Button>\n        </div>\n      </div>\n\n      {/* 3D Viewer */}\n      <Card className=\"min-h-[600px]\">\n        <CardContent className=\"p-0 relative\">\n          {modelUrl ? (\n            <ModelViewer\n              modelUrl={modelUrl}\n              className=\"w-full h-[600px] rounded-[var(--radius-lg)]\"\n            />\n          ) : (\n            <div className=\"w-full h-[600px] bg-gradient-to-b from-[#e8e4dc] to-[#d4d0c8] rounded-[var(--radius-lg)] flex items-center justify-center\">\n              <div className=\"text-center text-[var(--ink-faint)] max-w-md px-4\">\n                <Box className=\"w-20 h-20 mx-auto mb-4 opacity-30\" />\n                {!backendStatus.available ? (\n                  <>\n                    <p className=\"text-lg font-medium text-amber-600\">\n                      {isRtl ? \"الخادم غير متصل\" : \"Backend Not Connected\"}\n                    </p>\n                    <p className=\"text-sm mt-2\">\n                      {isRtl\n                        ? \"قم بتشغيل الخادم لعرض النماذج ثلاثية الأبعاد\"\n                        : \"Start the backend server to view 3D models\"}\n                    </p>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"mt-4\"\n                      onClick={handleRetryConnection}\n                    >\n                      {isRtl ? \"إعادة المحاولة\" : \"Retry Connection\"}\n                    </Button>\n                  </>\n                ) : !run?.id ? (\n                  <>\n                    <p className=\"text-lg font-medium\">\n                      {isRtl ? \"لا يوجد تشغيل نشط\" : \"No Active Run\"}\n                    </p>\n                    <p className=\"text-sm mt-2\">\n                      {isRtl\n                        ? \"انتقل إلى المنظم لبدء التوليد\"\n                        : \"Go to Orchestrator to start generation\"}\n                    </p>\n                  </>\n                ) : (\n                  <>\n                    <p className=\"text-lg font-medium\">\n                      {isRtl ? \"جاري تحميل النموذج...\" : \"Loading model...\"}\n                    </p>\n                    <p className=\"text-sm mt-2\">\n                      {isRtl\n                        ? \"يرجى الانتظار أثناء تحميل الملفات\"\n                        : \"Please wait while files are loading\"}\n                    </p>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Floor Selector */}\n          <div className=\"absolute right-4 top-1/2 -translate-y-1/2 bg-[var(--surface)] rounded-[var(--radius-md)] p-2 shadow-lg border border-[var(--line)]\">\n            <div className=\"space-y-1\">\n              {Array.from({ length: Math.min(project?.floors || 5, 10) }, (_, i) => {\n                const floorNum = (project?.floors || 5) - i;\n                return (\n                  <button\n                    key={i}\n                    onClick={() => setSelectedFloor(floorNum)}\n                    className={`w-8 h-8 rounded text-xs font-medium transition-colors ${\n                      selectedFloor === floorNum\n                        ? \"bg-[var(--accent)] text-white\"\n                        : \"hover:bg-[var(--bg-2)] text-[var(--ink-soft)]\"\n                    }`}\n                  >\n                    {floorNum}\n                  </button>\n                );\n              }).slice(0, 5)}\n              {(project?.floors || 0) > 5 && (\n                <span className=\"block text-center text-xs text-[var(--ink-faint)]\">...</span>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}