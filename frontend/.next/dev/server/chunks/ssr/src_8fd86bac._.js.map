{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/lib/api-client.ts"],"sourcesContent":["import type {\n  StateResponse,\n  StatePayload,\n  RunEvent,\n  Artifact,\n  Project,\n  Run,\n} from \"@/types\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000\";\n\n// Demo mode flag - set to true when backend is unavailable\nlet demoMode = false;\n\nclass ApiError extends Error {\n  constructor(\n    public status: number,\n    message: string\n  ) {\n    super(message);\n    this.name = \"ApiError\";\n  }\n}\n\nasync function handleResponse<T>(response: Response): Promise<T> {\n  if (!response.ok) {\n    const message = await response.text().catch(() => \"Unknown error\");\n    throw new ApiError(response.status, message);\n  }\n  return response.json();\n}\n\n// Demo data for when backend is unavailable\nconst demoProjects: Project[] = [\n  {\n    id: 1,\n    name: \"KAFD Tower Complex\",\n    region: \"saudi_arabia\",\n    building_type: \"office\",\n    phase: \"design_development\",\n    gfa: 45000,\n    floors: 32,\n    status: \"In progress\",\n  },\n  {\n    id: 2,\n    name: \"Al Maryah Residences\",\n    region: \"uae\",\n    building_type: \"residential\",\n    phase: \"schematic\",\n    gfa: 28000,\n    floors: 18,\n    status: \"Review\",\n  },\n  {\n    id: 3,\n    name: \"Qatar Innovation Hub\",\n    region: \"qatar\",\n    building_type: \"mixed_use\",\n    phase: \"construction_documents\",\n    gfa: 62000,\n    floors: 24,\n    status: \"Completed\",\n  },\n];\n\nlet nextProjectId = 100;\n\nexport const apiClient = {\n  // Check if backend is available\n  async checkBackend(): Promise<boolean> {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\n      const response = await fetch(`${API_BASE}/api/state`, {\n        signal: controller.signal,\n        method: \"GET\",\n      });\n      clearTimeout(timeoutId);\n      demoMode = !response.ok;\n      return response.ok;\n    } catch {\n      demoMode = true;\n      console.warn(\"Backend not available, using demo mode\");\n      return false;\n    }\n  },\n\n  isDemoMode(): boolean {\n    return demoMode;\n  },\n\n  // Check if backend is connected and return status info\n  getBackendStatus(): { available: boolean; message: string } {\n    if (demoMode) {\n      return {\n        available: false,\n        message: \"Backend server is not connected. Start the backend to view generated content.\",\n      };\n    }\n    return { available: true, message: \"\" };\n  },\n\n  // Retry backend connection\n  async retryConnection(): Promise<boolean> {\n    const wasDemo = demoMode;\n    const isAvailable = await this.checkBackend();\n    if (wasDemo && isAvailable) {\n      console.info(\"Backend connection restored\");\n    }\n    return isAvailable;\n  },\n\n  // State Management\n  async getState(): Promise<StateResponse> {\n    try {\n      const response = await fetch(`${API_BASE}/api/state`);\n      return handleResponse<StateResponse>(response);\n    } catch {\n      demoMode = true;\n      return { project: null, run: null, outputs: null };\n    }\n  },\n\n  async updateState(payload: StatePayload): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate project creation\n      const newProject: Project = {\n        id: nextProjectId++,\n        name: payload.project.name || \"New Project\",\n        region: payload.project.region || \"saudi_arabia\",\n        building_type: payload.project.building_type || \"office\",\n        phase: payload.project.phase || \"schematic\",\n        gfa: payload.project.gfa || 10000,\n        floors: payload.project.floors || 10,\n        status: \"Draft\",\n        ...payload.project,\n      };\n      demoProjects.unshift(newProject);\n      return { project: newProject, run: null, outputs: null };\n    }\n\n    const response = await fetch(`${API_BASE}/api/state`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    return handleResponse<StateResponse>(response);\n  },\n\n  // Project Operations\n  async createProject(project: Partial<Project>): Promise<StateResponse> {\n    return this.updateState({ project });\n  },\n\n  async getProject(id: string | number): Promise<Project | null> {\n    if (demoMode) {\n      const numericId = typeof id === \"number\" ? id : Number(id);\n      if (!Number.isFinite(numericId)) return null;\n      return demoProjects.find((p) => p.id === numericId) || null;\n    }\n    const state = await this.getState();\n    return state.project;\n  },\n\n  getProjects(): Project[] {\n    return demoProjects;\n  },\n\n  // Run Operations\n  async startRun(\n    projectId: string | number,\n    stage: \"architectural\" | \"full\" = \"full\"\n  ): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate run creation\n      const project = demoProjects.find((p) => p.id === projectId);\n      if (project) {\n        project.status = \"In progress\";\n      }\n      return {\n        project: project || null,\n        run: {\n          id: Date.now(),\n          project_id: projectId,\n          status: \"In progress\",\n          conflicts: 0,\n          started_at: new Date().toISOString(),\n        },\n        outputs: null,\n      };\n    }\n\n    const response = await fetch(\n      `${API_BASE}/api/runs/start?project_id=${projectId}&stage=${stage}`,\n      { method: \"POST\" }\n    );\n    return handleResponse<StateResponse>(response);\n  },\n\n  async getRunEvents(runId: string | number): Promise<RunEvent[]> {\n    if (demoMode) {\n      // Demo mode: return sample events\n      return [\n        { id: 1, run_id: runId, message: \"Starting design generation...\", level: \"info\", step: \"init\", created_at: new Date().toISOString() },\n        { id: 2, run_id: runId, message: \"Analyzing site context\", level: \"info\", step: \"analysis\", created_at: new Date().toISOString() },\n        { id: 3, run_id: runId, message: \"Generating floor plans\", level: \"info\", step: \"architectural\", created_at: new Date().toISOString() },\n      ];\n    }\n\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/events`);\n    return handleResponse<RunEvent[]>(response);\n  },\n\n  async getRunArtifacts(runId: string | number): Promise<Artifact[]> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Artifacts not available - backend connection required\");\n      return [];\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/runs/${runId}/artifacts`);\n      return handleResponse<Artifact[]>(response);\n    } catch (error) {\n      console.error(\"Failed to fetch artifacts:\", error);\n      return [];\n    }\n  },\n\n  // Get the latest run for a specific project\n  async getLatestRunForProject(projectId: string | number): Promise<Run | null> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Runs not available - backend connection required\");\n      return null;\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/projects/${projectId}/runs/latest`);\n      const data = await handleResponse<{ run: Run | null }>(response);\n      return data.run;\n    } catch {\n      return null;\n    }\n  },\n\n  // Plan Operations\n  async getPlanRevision(runId: string | number): Promise<Record<string, unknown>> {\n    if (demoMode) {\n      return {};\n    }\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/plan`);\n    return handleResponse<Record<string, unknown>>(response);\n  },\n\n  async savePlanRevision(\n    runId: string | number,\n    payload: Record<string, unknown>\n  ): Promise<void> {\n    if (demoMode) {\n      console.log(\"Demo mode: Plan saved locally\", payload);\n      return;\n    }\n    await fetch(`${API_BASE}/api/runs/${runId}/plan`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ payload }),\n    });\n  },\n\n  // File URLs\n  getFileUrl(projectId: string | number, runId: string | number, fileName: string): string {\n    return `${API_BASE}/files/${projectId}/${runId}/${fileName}`;\n  },\n\n  // Generic file fetch\n  async fetchFile(url: string): Promise<string> {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to fetch file\");\n    }\n    return response.text();\n  },\n\n  // Get run outputs with file URLs\n  async getRunOutputs(\n    projectId: string | number,\n    runId: string | number\n  ): Promise<{\n    plan_svg?: string;\n    gltf?: string;\n    ifc?: string;\n    dxf?: string;\n    schedule?: string;\n    energy_report?: string;\n    structural_report?: string;\n    structural_plan?: string;\n    mep_layout?: string;\n    review_package?: string;\n  }> {\n    const artifacts = await this.getRunArtifacts(runId);\n    const outputs: Record<string, string> = {};\n\n    for (const artifact of artifacts) {\n      const url = this.getFileUrl(projectId, runId, artifact.file_name);\n      outputs[artifact.kind] = url;\n    }\n\n    return outputs;\n  },\n\n  // Download a file by triggering browser download\n  async downloadFile(\n    projectId: string | number,\n    runId: string | number,\n    fileName: string\n  ): Promise<void> {\n    const url = this.getFileUrl(projectId, runId, fileName);\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to download file\");\n    }\n\n    const blob = await response.blob();\n    const downloadUrl = URL.createObjectURL(blob);\n\n    const a = document.createElement(\"a\");\n    a.href = downloadUrl;\n    a.download = fileName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(downloadUrl);\n  },\n};\n\nexport { ApiError };\n\n// Artifact kind constants for robust artifact finding\nexport const ARTIFACT_KINDS = {\n  PLAN_SVG: [\"plan\", \"plan_svg\"],\n  GLTF: [\"gltf\", \"model\", \"3d\"],\n  DXF: [\"dxf\", \"cad\"],\n  IFC: [\"ifc\", \"bim\"],\n  SCHEDULE: [\"schedule\", \"mep_schedule\"],\n  ENERGY_REPORT: [\"energy\", \"energy_report\"],\n  STRUCTURAL_REPORT: [\"structural\", \"structural_report\"],\n  STRUCTURAL_PLAN: [\"structural_plan\"],\n  MEP_LAYOUT: [\"mep\", \"mep_layout\"],\n  REVIEW_PACKAGE: [\"package\", \"review_package\"],\n} as const;\n\n// Helper to find artifact by kind with fallback to file extensions\nexport function findArtifactByKind(\n  artifacts: Artifact[],\n  kinds: readonly string[],\n  fileExtensions?: string[]\n): Artifact | undefined {\n  return artifacts.find((a) => {\n    // Check kind match\n    if (kinds.includes(a.kind)) return true;\n    // Check file extension match\n    if (fileExtensions?.some((ext) => a.file_name?.endsWith(ext))) return true;\n    return false;\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/plan-editor/SvgCanvas.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState, useCallback, useMemo } from \"react\";\nimport { Loader2, ZoomIn, ZoomOut, RotateCcw, Move } from \"lucide-react\";\nimport { apiClient } from \"@/lib/api-client\";\n\ninterface SvgCanvasProps {\n  projectId: string | number;\n  runId: string | number;\n  fileName: string;\n  className?: string;\n}\n\nexport function SvgCanvas({ projectId, runId, fileName, className = \"\" }: SvgCanvasProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [svgContent, setSvgContent] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [scale, setScale] = useState(1);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n\n  // RAF throttling refs for smooth panning\n  const rafRef = useRef<number | null>(null);\n  const pendingPositionRef = useRef<{ x: number; y: number } | null>(null);\n\n  // Load SVG content from backend\n  useEffect(() => {\n    const loadSvg = async () => {\n      if (!fileName || !projectId || !runId) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        setLoading(true);\n        setError(null);\n        const url = apiClient.getFileUrl(projectId, runId, fileName);\n        const response = await fetch(url);\n\n        if (!response.ok) {\n          throw new Error(`Failed to load SVG: ${response.status}`);\n        }\n\n        const svg = await response.text();\n\n        // Validate SVG content\n        if (!svg.includes(\"<svg\") || !svg.includes(\"</svg>\")) {\n          throw new Error(\"Invalid SVG content\");\n        }\n\n        setSvgContent(svg);\n      } catch (err) {\n        console.error(\"Error loading SVG:\", err);\n        setError(err instanceof Error ? err.message : \"Failed to load plan\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadSvg();\n  }, [projectId, runId, fileName]);\n\n  // Handle mouse wheel zoom\n  const handleWheel = useCallback((e: React.WheelEvent) => {\n    e.preventDefault();\n    const delta = e.deltaY > 0 ? 0.9 : 1.1;\n    setScale(prev => Math.max(0.1, Math.min(10, prev * delta)));\n  }, []);\n\n  // Handle pan start\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    if (e.button === 0) {\n      setIsDragging(true);\n      setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });\n    }\n  }, [position]);\n\n  // Handle pan move with RAF throttling for smooth performance\n  const handleMouseMove = useCallback((e: React.MouseEvent) => {\n    if (!isDragging) return;\n\n    // Store pending position\n    pendingPositionRef.current = {\n      x: e.clientX - dragStart.x,\n      y: e.clientY - dragStart.y,\n    };\n\n    // Throttle with RAF - only update on animation frame\n    if (rafRef.current) return;\n\n    rafRef.current = requestAnimationFrame(() => {\n      rafRef.current = null;\n      if (pendingPositionRef.current) {\n        setPosition(pendingPositionRef.current);\n      }\n    });\n  }, [isDragging, dragStart]);\n\n  // Handle pan end\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n    // Cancel any pending RAF\n    if (rafRef.current) {\n      cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    }\n  }, []);\n\n  // Cleanup RAF on unmount\n  useEffect(() => {\n    return () => {\n      if (rafRef.current) {\n        cancelAnimationFrame(rafRef.current);\n      }\n    };\n  }, []);\n\n  // Memoize transform style for GPU acceleration\n  const transformStyle = useMemo(() => ({\n    transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`,\n    transformOrigin: \"center\",\n    transition: isDragging ? \"none\" : \"transform 0.1s ease-out\",\n    willChange: isDragging ? \"transform\" : \"auto\", // GPU hint during drag\n  }), [position.x, position.y, scale, isDragging]);\n\n  // Zoom controls\n  const zoomIn = () => setScale(prev => Math.min(10, prev * 1.2));\n  const zoomOut = () => setScale(prev => Math.max(0.1, prev / 1.2));\n  const resetView = () => {\n    setScale(1);\n    setPosition({ x: 0, y: 0 });\n  };\n\n  if (loading) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-[#f8f6f1] ${className}`}>\n        <div className=\"text-center text-[var(--ink-soft)]\">\n          <Loader2 className=\"w-10 h-10 mx-auto mb-3 animate-spin opacity-50\" />\n          <p className=\"text-sm\">Loading plan...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-[#f8f6f1] ${className}`}>\n        <div className=\"text-center text-[var(--ink-soft)]\">\n          <p className=\"text-sm text-red-500\">{error}</p>\n          <p className=\"text-xs mt-2\">Check that the project has been generated.</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!svgContent) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-[#f8f6f1] ${className}`}>\n        <div className=\"text-center text-[var(--ink-soft)]\">\n          <Move className=\"w-12 h-12 mx-auto mb-3 opacity-30\" />\n          <p className=\"text-sm\">No plan available</p>\n          <p className=\"text-xs mt-1\">Generate a project to view the floor plan</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative w-full h-full overflow-hidden ${className}`}>\n      {/* SVG Canvas */}\n      <div\n        ref={containerRef}\n        className=\"w-full h-full bg-[#f8f6f1] cursor-grab active:cursor-grabbing\"\n        onWheel={handleWheel}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        style={{\n          backgroundImage: `\n            linear-gradient(0deg, rgba(100,110,125,0.08) 1px, transparent 1px),\n            linear-gradient(90deg, rgba(100,110,125,0.08) 1px, transparent 1px)\n          `,\n          backgroundSize: \"24px 24px\",\n        }}\n      >\n        <div\n          className=\"w-full h-full flex items-center justify-center\"\n          style={transformStyle}\n        >\n          <div\n            className=\"svg-container\"\n            dangerouslySetInnerHTML={{ __html: svgContent }}\n            style={{\n              maxWidth: \"100%\",\n              maxHeight: \"100%\",\n            }}\n          />\n        </div>\n      </div>\n\n      {/* Zoom Controls */}\n      <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-[var(--surface)] rounded-full px-3 py-2 shadow-lg border border-[var(--line)]\">\n        <button\n          onClick={zoomOut}\n          className=\"p-2 rounded-full hover:bg-[var(--bg-2)] text-[var(--ink-soft)] transition-colors\"\n          title=\"Zoom out\"\n        >\n          <ZoomOut className=\"w-5 h-5\" />\n        </button>\n        <span className=\"text-sm text-[var(--ink-soft)] min-w-[48px] text-center\">\n          {Math.round(scale * 100)}%\n        </span>\n        <button\n          onClick={zoomIn}\n          className=\"p-2 rounded-full hover:bg-[var(--bg-2)] text-[var(--ink-soft)] transition-colors\"\n          title=\"Zoom in\"\n        >\n          <ZoomIn className=\"w-5 h-5\" />\n        </button>\n        <div className=\"w-px h-6 bg-[var(--line)]\" />\n        <button\n          onClick={resetView}\n          className=\"p-2 rounded-full hover:bg-[var(--bg-2)] text-[var(--ink-soft)] transition-colors\"\n          title=\"Reset view\"\n        >\n          <RotateCcw className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Scale indicator */}\n      <div className=\"absolute top-4 right-4 bg-[var(--surface)] rounded-[var(--radius-sm)] px-3 py-1.5 shadow border border-[var(--line)]\">\n        <span className=\"text-xs text-[var(--ink-soft)] font-mono\">\n          Scale: {scale.toFixed(2)}x\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default SvgCanvas;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 782, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/stores/viewer-store.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport type {\n  CADElement,\n  CADLayer,\n  Point2D,\n  Point3D,\n  ViewTransform,\n  ClippingPlane,\n  LayerDefinition,\n} from \"@/types/cad\";\nimport type { ToolType } from \"@/types\";\n\n// =============================================================================\n// Viewer Store Types\n// =============================================================================\n\ninterface LayerState {\n  visible: boolean;\n  locked: boolean;\n  opacity: number;\n}\n\ninterface ViewerState {\n  // -------------------------------------------------------------------------\n  // 2D Viewer State\n  // -------------------------------------------------------------------------\n\n  // Active tool\n  activeTool: ToolType;\n\n  // Layer visibility and state\n  layers: Record<CADLayer, LayerState>;\n\n  // Selection\n  selectedElementIds: string[];\n  hoveredElementId: string | null;\n\n  // View transform\n  viewTransform: ViewTransform;\n\n  // Canvas settings\n  backgroundColor: \"dark\" | \"light\";\n  showGrid: boolean;\n  gridSize: number;\n  snapToGrid: boolean;\n  snapTolerance: number;\n\n  // Measurement mode\n  measurementActive: boolean;\n  measurementPoints: Point2D[];\n  measurementUnit: \"m\" | \"mm\" | \"ft\";\n\n  // -------------------------------------------------------------------------\n  // 3D Viewer State\n  // -------------------------------------------------------------------------\n\n  // Floor visibility\n  totalFloors: number;\n  visibleFloors: number[];\n  floorOpacity: Record<number, number>;\n  explodedView: boolean;\n  explodeDistance: number;\n\n  // Section planes\n  clippingPlanes: ClippingPlane[];\n  activeClippingPlaneId: string | null;\n\n  // Camera\n  cameraMode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\";\n  cameraPosition: Point3D;\n  cameraTarget: Point3D;\n\n  // 3D Selection\n  selectedObjectIds: string[];\n  hoveredObjectId: string | null;\n\n  // Render quality\n  renderQuality: \"low\" | \"medium\" | \"high\";\n  showShadows: boolean;\n  showAmbientOcclusion: boolean;\n  antialiasing: boolean;\n\n  // 3D Measurement\n  measurement3DActive: boolean;\n  measurement3DPoints: Point3D[];\n\n  // -------------------------------------------------------------------------\n  // 2D Actions\n  // -------------------------------------------------------------------------\n\n  setActiveTool: (tool: ToolType) => void;\n\n  setLayerVisibility: (layer: CADLayer, visible: boolean) => void;\n  setLayerLocked: (layer: CADLayer, locked: boolean) => void;\n  setLayerOpacity: (layer: CADLayer, opacity: number) => void;\n  toggleLayerVisibility: (layer: CADLayer) => void;\n  showAllLayers: () => void;\n  hideAllLayers: () => void;\n\n  selectElement: (id: string, addToSelection?: boolean) => void;\n  selectElements: (ids: string[]) => void;\n  deselectElement: (id: string) => void;\n  clearSelection: () => void;\n  setHoveredElement: (id: string | null) => void;\n\n  setViewTransform: (transform: Partial<ViewTransform>) => void;\n  resetViewTransform: () => void;\n  zoomIn: () => void;\n  zoomOut: () => void;\n  zoomToFit: () => void;\n  rotateView: (degrees: number) => void;\n\n  setBackgroundColor: (color: \"dark\" | \"light\") => void;\n  toggleGrid: () => void;\n  setGridSize: (size: number) => void;\n  toggleSnapToGrid: () => void;\n\n  startMeasurement: () => void;\n  addMeasurementPoint: (point: Point2D) => void;\n  clearMeasurement: () => void;\n  setMeasurementUnit: (unit: \"m\" | \"mm\" | \"ft\") => void;\n\n  // -------------------------------------------------------------------------\n  // 3D Actions\n  // -------------------------------------------------------------------------\n\n  setTotalFloors: (count: number) => void;\n  toggleFloorVisibility: (floor: number) => void;\n  showFloor: (floor: number) => void;\n  hideFloor: (floor: number) => void;\n  showAllFloors: () => void;\n  hideAllFloors: () => void;\n  isolateFloor: (floor: number) => void;\n  setFloorOpacity: (floor: number, opacity: number) => void;\n  toggleExplodedView: () => void;\n  setExplodeDistance: (distance: number) => void;\n\n  addClippingPlane: (plane: ClippingPlane) => void;\n  removeClippingPlane: (id: string) => void;\n  updateClippingPlane: (id: string, updates: Partial<ClippingPlane>) => void;\n  toggleClippingPlane: (id: string) => void;\n  setActiveClippingPlane: (id: string | null) => void;\n  clearAllClippingPlanes: () => void;\n\n  setCameraMode: (mode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\") => void;\n  setCameraPosition: (position: Point3D) => void;\n  setCameraTarget: (target: Point3D) => void;\n  resetCamera: () => void;\n\n  selectObject: (id: string, addToSelection?: boolean) => void;\n  selectObjects: (ids: string[]) => void;\n  deselectObject: (id: string) => void;\n  clearObjectSelection: () => void;\n  setHoveredObject: (id: string | null) => void;\n\n  setRenderQuality: (quality: \"low\" | \"medium\" | \"high\") => void;\n  toggleShadows: () => void;\n  toggleAmbientOcclusion: () => void;\n  toggleAntialiasing: () => void;\n\n  startMeasurement3D: () => void;\n  addMeasurement3DPoint: (point: Point3D) => void;\n  clearMeasurement3D: () => void;\n}\n\n// =============================================================================\n// Default Values\n// =============================================================================\n\nconst defaultLayers: Record<CADLayer, LayerState> = {\n  architectural: { visible: true, locked: false, opacity: 1 },\n  structural: { visible: true, locked: false, opacity: 1 },\n  \"mep-hvac\": { visible: true, locked: false, opacity: 1 },\n  \"mep-electrical\": { visible: true, locked: false, opacity: 1 },\n  \"mep-plumbing\": { visible: true, locked: false, opacity: 1 },\n  annotations: { visible: true, locked: false, opacity: 1 },\n  grid: { visible: true, locked: true, opacity: 0.5 },\n  dimensions: { visible: true, locked: false, opacity: 1 },\n  furniture: { visible: true, locked: false, opacity: 1 },\n};\n\nconst defaultViewTransform: ViewTransform = {\n  panX: 0,\n  panY: 0,\n  zoom: 1,\n  rotation: 0,\n};\n\nconst defaultCameraPosition: Point3D = { x: 60, y: 40, z: 60 };\nconst defaultCameraTarget: Point3D = { x: 0, y: 0, z: 0 };\n\n// =============================================================================\n// Store Implementation\n// =============================================================================\n\nexport const useViewerStore = create<ViewerState>()(\n  persist(\n    (set, get) => ({\n      // -----------------------------------------------------------------------\n      // 2D Initial State\n      // -----------------------------------------------------------------------\n      activeTool: \"select\",\n      layers: { ...defaultLayers },\n      selectedElementIds: [],\n      hoveredElementId: null,\n      viewTransform: { ...defaultViewTransform },\n      backgroundColor: \"dark\",\n      showGrid: true,\n      gridSize: 1.2, // 1.2m architectural module\n      snapToGrid: true,\n      snapTolerance: 0.1,\n      measurementActive: false,\n      measurementPoints: [],\n      measurementUnit: \"m\",\n\n      // -----------------------------------------------------------------------\n      // 3D Initial State\n      // -----------------------------------------------------------------------\n      totalFloors: 1,\n      visibleFloors: [0],\n      floorOpacity: { 0: 1 },\n      explodedView: false,\n      explodeDistance: 5,\n      clippingPlanes: [],\n      activeClippingPlaneId: null,\n      cameraMode: \"orbit\",\n      cameraPosition: { ...defaultCameraPosition },\n      cameraTarget: { ...defaultCameraTarget },\n      selectedObjectIds: [],\n      hoveredObjectId: null,\n      renderQuality: \"medium\",\n      showShadows: true,\n      showAmbientOcclusion: false,\n      antialiasing: true,\n      measurement3DActive: false,\n      measurement3DPoints: [],\n\n      // -----------------------------------------------------------------------\n      // 2D Actions\n      // -----------------------------------------------------------------------\n\n      setActiveTool: (tool) => set({ activeTool: tool }),\n\n      setLayerVisibility: (layer, visible) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], visible },\n          },\n        })),\n\n      setLayerLocked: (layer, locked) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], locked },\n          },\n        })),\n\n      setLayerOpacity: (layer, opacity) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], opacity },\n          },\n        })),\n\n      toggleLayerVisibility: (layer) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], visible: !state.layers[layer].visible },\n          },\n        })),\n\n      showAllLayers: () =>\n        set((state) => {\n          const newLayers = { ...state.layers };\n          Object.keys(newLayers).forEach((key) => {\n            newLayers[key as CADLayer].visible = true;\n          });\n          return { layers: newLayers };\n        }),\n\n      hideAllLayers: () =>\n        set((state) => {\n          const newLayers = { ...state.layers };\n          Object.keys(newLayers).forEach((key) => {\n            newLayers[key as CADLayer].visible = false;\n          });\n          return { layers: newLayers };\n        }),\n\n      selectElement: (id, addToSelection = false) =>\n        set((state) => ({\n          selectedElementIds: addToSelection\n            ? [...state.selectedElementIds, id]\n            : [id],\n        })),\n\n      selectElements: (ids) => set({ selectedElementIds: ids }),\n\n      deselectElement: (id) =>\n        set((state) => ({\n          selectedElementIds: state.selectedElementIds.filter((eid) => eid !== id),\n        })),\n\n      clearSelection: () => set({ selectedElementIds: [], hoveredElementId: null }),\n\n      setHoveredElement: (id) => set({ hoveredElementId: id }),\n\n      setViewTransform: (transform) =>\n        set((state) => ({\n          viewTransform: { ...state.viewTransform, ...transform },\n        })),\n\n      resetViewTransform: () => set({ viewTransform: { ...defaultViewTransform } }),\n\n      zoomIn: () =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            zoom: Math.min(state.viewTransform.zoom * 1.2, 50),\n          },\n        })),\n\n      zoomOut: () =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            zoom: Math.max(state.viewTransform.zoom / 1.2, 0.1),\n          },\n        })),\n\n      zoomToFit: () =>\n        set({\n          viewTransform: { panX: 0, panY: 0, zoom: 1, rotation: 0 },\n        }),\n\n      rotateView: (degrees) =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            rotation: (state.viewTransform.rotation + degrees) % 360,\n          },\n        })),\n\n      setBackgroundColor: (color) => set({ backgroundColor: color }),\n\n      toggleGrid: () => set((state) => ({ showGrid: !state.showGrid })),\n\n      setGridSize: (size) => set({ gridSize: size }),\n\n      toggleSnapToGrid: () => set((state) => ({ snapToGrid: !state.snapToGrid })),\n\n      startMeasurement: () =>\n        set({\n          measurementActive: true,\n          measurementPoints: [],\n          activeTool: \"select\",\n        }),\n\n      addMeasurementPoint: (point) =>\n        set((state) => ({\n          measurementPoints: [...state.measurementPoints, point],\n        })),\n\n      clearMeasurement: () =>\n        set({ measurementActive: false, measurementPoints: [] }),\n\n      setMeasurementUnit: (unit) => set({ measurementUnit: unit }),\n\n      // -----------------------------------------------------------------------\n      // 3D Actions\n      // -----------------------------------------------------------------------\n\n      setTotalFloors: (count) => {\n        const floors = Array.from({ length: count }, (_, i) => i);\n        const opacities: Record<number, number> = {};\n        floors.forEach((f) => (opacities[f] = 1));\n        set({ totalFloors: count, visibleFloors: floors, floorOpacity: opacities });\n      },\n\n      toggleFloorVisibility: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.includes(floor)\n            ? state.visibleFloors.filter((f) => f !== floor)\n            : [...state.visibleFloors, floor].sort((a, b) => a - b),\n        })),\n\n      showFloor: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.includes(floor)\n            ? state.visibleFloors\n            : [...state.visibleFloors, floor].sort((a, b) => a - b),\n        })),\n\n      hideFloor: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.filter((f) => f !== floor),\n        })),\n\n      showAllFloors: () =>\n        set((state) => ({\n          visibleFloors: Array.from({ length: state.totalFloors }, (_, i) => i),\n        })),\n\n      hideAllFloors: () => set({ visibleFloors: [] }),\n\n      isolateFloor: (floor) => set({ visibleFloors: [floor] }),\n\n      setFloorOpacity: (floor, opacity) =>\n        set((state) => ({\n          floorOpacity: { ...state.floorOpacity, [floor]: opacity },\n        })),\n\n      toggleExplodedView: () =>\n        set((state) => ({ explodedView: !state.explodedView })),\n\n      setExplodeDistance: (distance) => set({ explodeDistance: distance }),\n\n      addClippingPlane: (plane) =>\n        set((state) => ({\n          clippingPlanes: [...state.clippingPlanes, plane],\n        })),\n\n      removeClippingPlane: (id) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.filter((p) => p.id !== id),\n          activeClippingPlaneId:\n            state.activeClippingPlaneId === id ? null : state.activeClippingPlaneId,\n        })),\n\n      updateClippingPlane: (id, updates) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.map((p) =>\n            p.id === id ? { ...p, ...updates } : p\n          ),\n        })),\n\n      toggleClippingPlane: (id) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.map((p) =>\n            p.id === id ? { ...p, enabled: !p.enabled } : p\n          ),\n        })),\n\n      setActiveClippingPlane: (id) => set({ activeClippingPlaneId: id }),\n\n      clearAllClippingPlanes: () =>\n        set({ clippingPlanes: [], activeClippingPlaneId: null }),\n\n      setCameraMode: (mode) => set({ cameraMode: mode }),\n\n      setCameraPosition: (position) => set({ cameraPosition: position }),\n\n      setCameraTarget: (target) => set({ cameraTarget: target }),\n\n      resetCamera: () =>\n        set({\n          cameraPosition: { ...defaultCameraPosition },\n          cameraTarget: { ...defaultCameraTarget },\n          cameraMode: \"orbit\",\n        }),\n\n      selectObject: (id, addToSelection = false) =>\n        set((state) => ({\n          selectedObjectIds: addToSelection\n            ? [...state.selectedObjectIds, id]\n            : [id],\n        })),\n\n      selectObjects: (ids) => set({ selectedObjectIds: ids }),\n\n      deselectObject: (id) =>\n        set((state) => ({\n          selectedObjectIds: state.selectedObjectIds.filter((oid) => oid !== id),\n        })),\n\n      clearObjectSelection: () =>\n        set({ selectedObjectIds: [], hoveredObjectId: null }),\n\n      setHoveredObject: (id) => set({ hoveredObjectId: id }),\n\n      setRenderQuality: (quality) => set({ renderQuality: quality }),\n\n      toggleShadows: () => set((state) => ({ showShadows: !state.showShadows })),\n\n      toggleAmbientOcclusion: () =>\n        set((state) => ({ showAmbientOcclusion: !state.showAmbientOcclusion })),\n\n      toggleAntialiasing: () =>\n        set((state) => ({ antialiasing: !state.antialiasing })),\n\n      startMeasurement3D: () =>\n        set({ measurement3DActive: true, measurement3DPoints: [] }),\n\n      addMeasurement3DPoint: (point) =>\n        set((state) => ({\n          measurement3DPoints: [...state.measurement3DPoints, point],\n        })),\n\n      clearMeasurement3D: () =>\n        set({ measurement3DActive: false, measurement3DPoints: [] }),\n    }),\n    {\n      name: \"ai-designer-viewer\",\n      partialize: (state) => ({\n        // Persist user preferences\n        backgroundColor: state.backgroundColor,\n        showGrid: state.showGrid,\n        gridSize: state.gridSize,\n        snapToGrid: state.snapToGrid,\n        measurementUnit: state.measurementUnit,\n        renderQuality: state.renderQuality,\n        showShadows: state.showShadows,\n        antialiasing: state.antialiasing,\n        cameraMode: state.cameraMode,\n      }),\n    }\n  )\n);\n\n// =============================================================================\n// Selector Hooks for Common Operations\n// =============================================================================\n\nexport const useActiveTool = () => useViewerStore((state) => state.activeTool);\nexport const useSelectedElements = () => useViewerStore((state) => state.selectedElementIds);\nexport const useViewTransform = () => useViewerStore((state) => state.viewTransform);\nexport const useLayers = () => useViewerStore((state) => state.layers);\nexport const useBackgroundColor = () => useViewerStore((state) => state.backgroundColor);\n\nexport const useVisibleFloors = () => useViewerStore((state) => state.visibleFloors);\nexport const useClippingPlanes = () => useViewerStore((state) => state.clippingPlanes);\nexport const useCameraMode = () => useViewerStore((state) => state.cameraMode);\nexport const useSelectedObjects = () => useViewerStore((state) => state.selectedObjectIds);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1253, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/plan-editor/utils/svg-parser.ts"],"sourcesContent":["/**\n * SVG Parser Utility\n *\n * Parses backend-generated SVG floor plans into structured CAD elements\n * for rendering with Konva.js\n */\n\nimport type {\n  CADElement,\n  CADElementType,\n  CADLayer,\n  Point2D,\n  WallElement,\n  DoorElement,\n  WindowElement,\n  SpaceElement,\n  ColumnElement,\n  DimensionElement,\n  GridLineElement,\n  FloorPlanDocument,\n  CAD_COLORS,\n  CAD_LINE_WEIGHTS,\n} from \"@/types/cad\";\n\n// =============================================================================\n// Parser Types\n// =============================================================================\n\ninterface ParsedSVG {\n  width: number;\n  height: number;\n  viewBox: { x: number; y: number; width: number; height: number } | null;\n  elements: CADElement[];\n  gridX: number[];\n  gridY: number[];\n  gridLabelsX: string[];\n  gridLabelsY: string[];\n}\n\ninterface SVGPathData {\n  commands: Array<{\n    type: string;\n    x?: number;\n    y?: number;\n    x1?: number;\n    y1?: number;\n    x2?: number;\n    y2?: number;\n  }>;\n}\n\n// =============================================================================\n// Layer Detection\n// =============================================================================\n\nfunction detectLayer(element: Element): CADLayer {\n  const className = element.getAttribute(\"class\") || \"\";\n  const id = element.getAttribute(\"id\") || \"\";\n  const stroke = element.getAttribute(\"stroke\") || \"\";\n  const dataLayer = element.getAttribute(\"data-layer\");\n\n  if (dataLayer) {\n    return dataLayer as CADLayer;\n  }\n\n  // Check class names\n  if (className.includes(\"wall\") || className.includes(\"outline\")) {\n    return \"architectural\";\n  }\n  if (className.includes(\"column\") || className.includes(\"beam\") || className.includes(\"structural\")) {\n    return \"structural\";\n  }\n  if (className.includes(\"hvac\") || className.includes(\"duct\")) {\n    return \"mep-hvac\";\n  }\n  if (className.includes(\"electrical\") || className.includes(\"panel\")) {\n    return \"mep-electrical\";\n  }\n  if (className.includes(\"plumbing\") || className.includes(\"pipe\") || className.includes(\"riser\")) {\n    return \"mep-plumbing\";\n  }\n  if (className.includes(\"grid\") || className.includes(\"axis\")) {\n    return \"grid\";\n  }\n  if (className.includes(\"dimension\") || className.includes(\"dim\")) {\n    return \"dimensions\";\n  }\n  if (className.includes(\"annotation\") || className.includes(\"label\") || className.includes(\"text\")) {\n    return \"annotations\";\n  }\n  if (className.includes(\"furniture\") || className.includes(\"equipment\")) {\n    return \"furniture\";\n  }\n\n  // Check stroke colors\n  if (stroke.includes(\"#FF0000\") || stroke.includes(\"red\")) {\n    return \"structural\";\n  }\n  if (stroke.includes(\"#00FFFF\") || stroke.includes(\"cyan\")) {\n    return \"mep-hvac\";\n  }\n  if (stroke.includes(\"#FF00FF\") || stroke.includes(\"magenta\")) {\n    return \"mep-electrical\";\n  }\n  if (stroke.includes(\"#0000FF\") || stroke.includes(\"blue\")) {\n    return \"mep-plumbing\";\n  }\n\n  return \"architectural\";\n}\n\n// =============================================================================\n// Element Type Detection\n// =============================================================================\n\nfunction detectElementType(element: Element): CADElementType {\n  const className = element.getAttribute(\"class\") || \"\";\n  const id = element.getAttribute(\"id\") || \"\";\n  const dataType = element.getAttribute(\"data-type\");\n\n  if (dataType) {\n    return dataType as CADElementType;\n  }\n\n  const lowerClass = className.toLowerCase();\n  const lowerId = id.toLowerCase();\n\n  if (lowerClass.includes(\"wall\") || lowerId.includes(\"wall\")) return \"wall\";\n  if (lowerClass.includes(\"door\") || lowerId.includes(\"door\")) return \"door\";\n  if (lowerClass.includes(\"window\") || lowerId.includes(\"window\")) return \"window\";\n  if (lowerClass.includes(\"column\") || lowerId.includes(\"column\")) return \"column\";\n  if (lowerClass.includes(\"beam\") || lowerId.includes(\"beam\")) return \"beam\";\n  if (lowerClass.includes(\"space\") || lowerId.includes(\"space\")) return \"space\";\n  if (lowerClass.includes(\"core\") || lowerId.includes(\"core\")) return \"core\";\n  if (lowerClass.includes(\"stair\") || lowerId.includes(\"stair\")) return \"stairs\";\n  if (lowerClass.includes(\"elevator\") || lowerId.includes(\"elevator\")) return \"elevator\";\n  if (lowerClass.includes(\"duct\") || lowerId.includes(\"duct\")) return \"duct\";\n  if (lowerClass.includes(\"pipe\") || lowerId.includes(\"pipe\")) return \"pipe\";\n  if (lowerClass.includes(\"grid\") || lowerId.includes(\"grid\")) return \"grid-line\";\n  if (lowerClass.includes(\"dimension\") || lowerId.includes(\"dim\")) return \"dimension\";\n  if (lowerClass.includes(\"text\") || lowerId.includes(\"text\") || lowerId.includes(\"label\")) return \"text\";\n\n  // Default based on element type\n  const tagName = element.tagName.toLowerCase();\n  if (tagName === \"text\" || tagName === \"tspan\") return \"text\";\n  if (tagName === \"rect\") return \"space\";\n  if (tagName === \"line\" || tagName === \"polyline\" || tagName === \"path\") return \"wall\";\n\n  return \"wall\";\n}\n\n// =============================================================================\n// Coordinate Parsing\n// =============================================================================\n\nfunction parsePoints(pointsAttr: string): Point2D[] {\n  const points: Point2D[] = [];\n  const pairs = pointsAttr.trim().split(/\\s+/);\n\n  for (const pair of pairs) {\n    const [x, y] = pair.split(\",\").map(Number);\n    if (!isNaN(x) && !isNaN(y)) {\n      points.push({ x, y });\n    }\n  }\n\n  return points;\n}\n\nfunction parseTransform(transformAttr: string): { translateX: number; translateY: number; scale: number; rotate: number } {\n  const result = { translateX: 0, translateY: 0, scale: 1, rotate: 0 };\n\n  if (!transformAttr) return result;\n\n  // Parse translate\n  const translateMatch = transformAttr.match(/translate\\(\\s*([^,\\s]+)\\s*,?\\s*([^)]*)\\s*\\)/);\n  if (translateMatch) {\n    result.translateX = parseFloat(translateMatch[1]) || 0;\n    result.translateY = parseFloat(translateMatch[2]) || 0;\n  }\n\n  // Parse scale\n  const scaleMatch = transformAttr.match(/scale\\(\\s*([^,\\s]+)\\s*,?\\s*([^)]*)\\s*\\)/);\n  if (scaleMatch) {\n    result.scale = parseFloat(scaleMatch[1]) || 1;\n  }\n\n  // Parse rotate\n  const rotateMatch = transformAttr.match(/rotate\\(\\s*([^)]+)\\s*\\)/);\n  if (rotateMatch) {\n    result.rotate = parseFloat(rotateMatch[1]) || 0;\n  }\n\n  return result;\n}\n\n// =============================================================================\n// Element Parsers\n// =============================================================================\n\nfunction parseLine(element: Element, index: number): CADElement | null {\n  const x1 = parseFloat(element.getAttribute(\"x1\") || \"0\");\n  const y1 = parseFloat(element.getAttribute(\"y1\") || \"0\");\n  const x2 = parseFloat(element.getAttribute(\"x2\") || \"0\");\n  const y2 = parseFloat(element.getAttribute(\"y2\") || \"0\");\n\n  if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  return {\n    id: element.getAttribute(\"id\") || `line-${index}`,\n    type,\n    layer,\n    points: [{ x: x1, y: y1 }, { x: x2, y: y2 }],\n    bounds: {\n      minX: Math.min(x1, x2),\n      minY: Math.min(y1, y2),\n      maxX: Math.max(x1, x2),\n      maxY: Math.max(y1, y2),\n    },\n    properties: {\n      stroke: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n}\n\nfunction parseRect(element: Element, index: number): CADElement | null {\n  const x = parseFloat(element.getAttribute(\"x\") || \"0\");\n  const y = parseFloat(element.getAttribute(\"y\") || \"0\");\n  const width = parseFloat(element.getAttribute(\"width\") || \"0\");\n  const height = parseFloat(element.getAttribute(\"height\") || \"0\");\n\n  if (isNaN(x) || isNaN(y) || isNaN(width) || isNaN(height)) return null;\n  if (width === 0 || height === 0) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  const baseElement: CADElement = {\n    id: element.getAttribute(\"id\") || `rect-${index}`,\n    type,\n    layer,\n    points: [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height },\n    ],\n    bounds: {\n      minX: x,\n      minY: y,\n      maxX: x + width,\n      maxY: y + height,\n    },\n    properties: {\n      width,\n      height,\n      fill: element.getAttribute(\"fill\"),\n      stroke: element.getAttribute(\"stroke\"),\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    fillColor: element.getAttribute(\"fill\") || \"transparent\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n\n  // Handle space elements specially\n  if (type === \"space\" || type === \"core\") {\n    const spaceElement: SpaceElement = {\n      ...baseElement,\n      type: \"space\",\n      name: element.getAttribute(\"data-name\") || element.getAttribute(\"id\") || `Space ${index}`,\n      area: width * height,\n      spaceType: element.getAttribute(\"data-space-type\") || \"general\",\n      requiresDaylight: element.getAttribute(\"data-daylight\") === \"true\",\n    };\n    return spaceElement;\n  }\n\n  return baseElement;\n}\n\nfunction parsePolyline(element: Element, index: number): CADElement | null {\n  const pointsAttr = element.getAttribute(\"points\");\n  if (!pointsAttr) return null;\n\n  const points = parsePoints(pointsAttr);\n  if (points.length < 2) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  const xs = points.map((p) => p.x);\n  const ys = points.map((p) => p.y);\n\n  return {\n    id: element.getAttribute(\"id\") || `polyline-${index}`,\n    type,\n    layer,\n    points,\n    bounds: {\n      minX: Math.min(...xs),\n      minY: Math.min(...ys),\n      maxX: Math.max(...xs),\n      maxY: Math.max(...ys),\n    },\n    properties: {\n      stroke: element.getAttribute(\"stroke\"),\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n      fill: element.getAttribute(\"fill\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    fillColor: element.getAttribute(\"fill\") || \"none\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n}\n\nfunction parsePolygon(element: Element, index: number): CADElement | null {\n  const pointsAttr = element.getAttribute(\"points\");\n  if (!pointsAttr) return null;\n\n  const points = parsePoints(pointsAttr);\n  if (points.length < 3) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  const xs = points.map((p) => p.x);\n  const ys = points.map((p) => p.y);\n\n  return {\n    id: element.getAttribute(\"id\") || `polygon-${index}`,\n    type,\n    layer,\n    points,\n    bounds: {\n      minX: Math.min(...xs),\n      minY: Math.min(...ys),\n      maxX: Math.max(...xs),\n      maxY: Math.max(...ys),\n    },\n    properties: {\n      stroke: element.getAttribute(\"stroke\"),\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n      fill: element.getAttribute(\"fill\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    fillColor: element.getAttribute(\"fill\") || \"none\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n}\n\nfunction parseCircle(element: Element, index: number): CADElement | null {\n  const cx = parseFloat(element.getAttribute(\"cx\") || \"0\");\n  const cy = parseFloat(element.getAttribute(\"cy\") || \"0\");\n  const r = parseFloat(element.getAttribute(\"r\") || \"0\");\n\n  if (isNaN(cx) || isNaN(cy) || isNaN(r) || r === 0) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  return {\n    id: element.getAttribute(\"id\") || `circle-${index}`,\n    type,\n    layer,\n    points: [{ x: cx, y: cy }],\n    bounds: {\n      minX: cx - r,\n      minY: cy - r,\n      maxX: cx + r,\n      maxY: cy + r,\n    },\n    properties: {\n      cx,\n      cy,\n      radius: r,\n      stroke: element.getAttribute(\"stroke\"),\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n      fill: element.getAttribute(\"fill\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    fillColor: element.getAttribute(\"fill\") || \"none\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n}\n\nfunction parseText(element: Element, index: number): CADElement | null {\n  const x = parseFloat(element.getAttribute(\"x\") || \"0\");\n  const y = parseFloat(element.getAttribute(\"y\") || \"0\");\n  const text = element.textContent || \"\";\n\n  if (!text.trim()) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n  const fontSize = parseFloat(element.getAttribute(\"font-size\") || \"12\");\n\n  return {\n    id: element.getAttribute(\"id\") || `text-${index}`,\n    type: \"text\",\n    layer,\n    points: [{ x, y }],\n    properties: {\n      text: text.trim(),\n      fontSize,\n      fontFamily: element.getAttribute(\"font-family\") || \"Arial\",\n      textAnchor: element.getAttribute(\"text-anchor\") || \"start\",\n      fill: element.getAttribute(\"fill\") || \"#FFFFFF\",\n    },\n    strokeColor: \"transparent\",\n    fillColor: element.getAttribute(\"fill\") || \"#FFFFFF\",\n  };\n}\n\nfunction parsePath(element: Element, index: number): CADElement | null {\n  const d = element.getAttribute(\"d\");\n  if (!d) return null;\n\n  // Simple path parsing - extract key points\n  const points: Point2D[] = [];\n  const regex = /([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/gi;\n  let match;\n  let currentX = 0;\n  let currentY = 0;\n\n  while ((match = regex.exec(d)) !== null) {\n    const cmd = match[1].toUpperCase();\n    const args = match[2].trim().split(/[\\s,]+/).map(Number);\n\n    switch (cmd) {\n      case \"M\":\n      case \"L\":\n        if (args.length >= 2) {\n          currentX = args[0];\n          currentY = args[1];\n          points.push({ x: currentX, y: currentY });\n        }\n        break;\n      case \"H\":\n        if (args.length >= 1) {\n          currentX = args[0];\n          points.push({ x: currentX, y: currentY });\n        }\n        break;\n      case \"V\":\n        if (args.length >= 1) {\n          currentY = args[0];\n          points.push({ x: currentX, y: currentY });\n        }\n        break;\n      case \"Z\":\n        // Close path - no new point needed\n        break;\n    }\n  }\n\n  if (points.length < 2) return null;\n\n  const type = detectElementType(element);\n  const layer = detectLayer(element);\n\n  const xs = points.map((p) => p.x);\n  const ys = points.map((p) => p.y);\n\n  return {\n    id: element.getAttribute(\"id\") || `path-${index}`,\n    type,\n    layer,\n    points,\n    bounds: {\n      minX: Math.min(...xs),\n      minY: Math.min(...ys),\n      maxX: Math.max(...xs),\n      maxY: Math.max(...ys),\n    },\n    properties: {\n      d,\n      stroke: element.getAttribute(\"stroke\"),\n      strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n      fill: element.getAttribute(\"fill\"),\n    },\n    strokeColor: element.getAttribute(\"stroke\") || \"#FFFFFF\",\n    fillColor: element.getAttribute(\"fill\") || \"none\",\n    strokeWidth: parseFloat(element.getAttribute(\"stroke-width\") || \"1\"),\n  };\n}\n\n// =============================================================================\n// Grid Data Extraction\n// =============================================================================\n\nfunction extractGridData(svgElement: Element): { gridX: number[]; gridY: number[]; labelsX: string[]; labelsY: string[] } {\n  const result = { gridX: [] as number[], gridY: [] as number[], labelsX: [] as string[], labelsY: [] as string[] };\n\n  // Try data attributes first\n  const dataGridX = svgElement.getAttribute(\"data-grid-x\");\n  const dataGridY = svgElement.getAttribute(\"data-grid-y\");\n\n  if (dataGridX) {\n    try {\n      result.gridX = JSON.parse(dataGridX);\n    } catch {\n      // ignore\n    }\n  }\n\n  if (dataGridY) {\n    try {\n      result.gridY = JSON.parse(dataGridY);\n    } catch {\n      // ignore\n    }\n  }\n\n  // Extract from grid lines if not in attributes\n  if (result.gridX.length === 0 || result.gridY.length === 0) {\n    const lines = svgElement.querySelectorAll('line[class*=\"grid\"], line[class*=\"axis\"]');\n    lines.forEach((line) => {\n      const x1 = parseFloat(line.getAttribute(\"x1\") || \"0\");\n      const y1 = parseFloat(line.getAttribute(\"y1\") || \"0\");\n      const x2 = parseFloat(line.getAttribute(\"x2\") || \"0\");\n      const y2 = parseFloat(line.getAttribute(\"y2\") || \"0\");\n\n      // Vertical line = X grid\n      if (Math.abs(x1 - x2) < 0.1) {\n        if (!result.gridX.includes(x1)) {\n          result.gridX.push(x1);\n        }\n      }\n      // Horizontal line = Y grid\n      if (Math.abs(y1 - y2) < 0.1) {\n        if (!result.gridY.includes(y1)) {\n          result.gridY.push(y1);\n        }\n      }\n    });\n  }\n\n  // Sort grids\n  result.gridX.sort((a, b) => a - b);\n  result.gridY.sort((a, b) => a - b);\n\n  // Generate labels (A, B, C... for X; 1, 2, 3... for Y)\n  result.labelsX = result.gridX.map((_, i) => String.fromCharCode(65 + i));\n  result.labelsY = result.gridY.map((_, i) => String(i + 1));\n\n  return result;\n}\n\n// =============================================================================\n// Main Parser Function\n// =============================================================================\n\nexport function parseSVG(svgString: string): ParsedSVG {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(svgString, \"image/svg+xml\");\n  const svgElement = doc.querySelector(\"svg\");\n\n  if (!svgElement) {\n    throw new Error(\"Invalid SVG: No SVG element found\");\n  }\n\n  // Parse dimensions\n  const width = parseFloat(svgElement.getAttribute(\"width\") || \"800\");\n  const height = parseFloat(svgElement.getAttribute(\"height\") || \"600\");\n\n  // Parse viewBox\n  let viewBox: ParsedSVG[\"viewBox\"] = null;\n  const viewBoxAttr = svgElement.getAttribute(\"viewBox\");\n  if (viewBoxAttr) {\n    const parts = viewBoxAttr.split(/\\s+/).map(Number);\n    if (parts.length === 4) {\n      viewBox = { x: parts[0], y: parts[1], width: parts[2], height: parts[3] };\n    }\n  }\n\n  // Extract grid data\n  const gridData = extractGridData(svgElement);\n\n  // Parse all elements\n  const elements: CADElement[] = [];\n  let elementIndex = 0;\n\n  // Parse lines\n  svgElement.querySelectorAll(\"line\").forEach((el) => {\n    const parsed = parseLine(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse rectangles\n  svgElement.querySelectorAll(\"rect\").forEach((el) => {\n    const parsed = parseRect(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse polylines\n  svgElement.querySelectorAll(\"polyline\").forEach((el) => {\n    const parsed = parsePolyline(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse polygons\n  svgElement.querySelectorAll(\"polygon\").forEach((el) => {\n    const parsed = parsePolygon(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse circles\n  svgElement.querySelectorAll(\"circle\").forEach((el) => {\n    const parsed = parseCircle(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse paths\n  svgElement.querySelectorAll(\"path\").forEach((el) => {\n    const parsed = parsePath(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  // Parse text\n  svgElement.querySelectorAll(\"text\").forEach((el) => {\n    const parsed = parseText(el, elementIndex++);\n    if (parsed) elements.push(parsed);\n  });\n\n  return {\n    width: viewBox?.width || width,\n    height: viewBox?.height || height,\n    viewBox,\n    elements,\n    gridX: gridData.gridX,\n    gridY: gridData.gridY,\n    gridLabelsX: gridData.labelsX,\n    gridLabelsY: gridData.labelsY,\n  };\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\nexport function getElementsByLayer(elements: CADElement[], layer: CADLayer): CADElement[] {\n  return elements.filter((el) => el.layer === layer);\n}\n\nexport function getElementsByType(elements: CADElement[], type: CADElementType): CADElement[] {\n  return elements.filter((el) => el.type === type);\n}\n\nexport function calculateBounds(elements: CADElement[]): { minX: number; minY: number; maxX: number; maxY: number } | null {\n  if (elements.length === 0) return null;\n\n  let minX = Infinity;\n  let minY = Infinity;\n  let maxX = -Infinity;\n  let maxY = -Infinity;\n\n  elements.forEach((el) => {\n    if (el.bounds) {\n      minX = Math.min(minX, el.bounds.minX);\n      minY = Math.min(minY, el.bounds.minY);\n      maxX = Math.max(maxX, el.bounds.maxX);\n      maxY = Math.max(maxY, el.bounds.maxY);\n    }\n  });\n\n  return { minX, minY, maxX, maxY };\n}\n\nexport function findElementAtPoint(elements: CADElement[], point: Point2D, tolerance: number = 5): CADElement | null {\n  // Search in reverse order (top elements first)\n  for (let i = elements.length - 1; i >= 0; i--) {\n    const el = elements[i];\n    if (!el.bounds) continue;\n\n    const { minX, minY, maxX, maxY } = el.bounds;\n    if (\n      point.x >= minX - tolerance &&\n      point.x <= maxX + tolerance &&\n      point.y >= minY - tolerance &&\n      point.y <= maxY + tolerance\n    ) {\n      return el;\n    }\n  }\n  return null;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1874, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/types/cad.ts"],"sourcesContent":["// =============================================================================\n// CAD Element Type Definitions for Professional 2D/3D Viewers\n// =============================================================================\n\n// -----------------------------------------------------------------------------\n// Basic Geometry Types\n// -----------------------------------------------------------------------------\n\nexport interface Point2D {\n  x: number;\n  y: number;\n}\n\nexport interface Point3D {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface BoundingBox2D {\n  minX: number;\n  minY: number;\n  maxX: number;\n  maxY: number;\n}\n\nexport interface BoundingBox3D {\n  minX: number;\n  minY: number;\n  minZ: number;\n  maxX: number;\n  maxY: number;\n  maxZ: number;\n}\n\n// -----------------------------------------------------------------------------\n// CAD Element Types\n// -----------------------------------------------------------------------------\n\nexport type CADElementType =\n  | \"wall\"\n  | \"door\"\n  | \"window\"\n  | \"column\"\n  | \"beam\"\n  | \"space\"\n  | \"dimension\"\n  | \"text\"\n  | \"annotation\"\n  | \"grid-line\"\n  | \"duct\"\n  | \"pipe\"\n  | \"panel\"\n  | \"diffuser\"\n  | \"riser\"\n  | \"core\"\n  | \"stairs\"\n  | \"elevator\"\n  | \"furniture\";\n\nexport type CADLayer =\n  | \"architectural\"\n  | \"structural\"\n  | \"mep-hvac\"\n  | \"mep-electrical\"\n  | \"mep-plumbing\"\n  | \"annotations\"\n  | \"grid\"\n  | \"dimensions\"\n  | \"furniture\";\n\n// -----------------------------------------------------------------------------\n// Base CAD Element\n// -----------------------------------------------------------------------------\n\nexport interface CADElement {\n  id: string;\n  type: CADElementType;\n  layer: CADLayer;\n  points: Point2D[];\n  bounds?: BoundingBox2D;\n  rotation?: number; // degrees\n  properties: Record<string, unknown>;\n  selected?: boolean;\n  hovered?: boolean;\n  locked?: boolean;\n  visible?: boolean;\n  strokeColor?: string;\n  fillColor?: string;\n  strokeWidth?: number;\n  opacity?: number;\n}\n\n// -----------------------------------------------------------------------------\n// Specific Element Types\n// -----------------------------------------------------------------------------\n\nexport interface WallElement extends CADElement {\n  type: \"wall\";\n  thickness: number;\n  height: number;\n  material?: string;\n  isExterior?: boolean;\n  openings?: string[]; // IDs of doors/windows in this wall\n}\n\nexport interface DoorElement extends CADElement {\n  type: \"door\";\n  width: number;\n  height: number;\n  swingDirection: \"left\" | \"right\" | \"double\" | \"sliding\";\n  swingAngle: number; // degrees, for display\n  parentWallId?: string;\n}\n\nexport interface WindowElement extends CADElement {\n  type: \"window\";\n  width: number;\n  height: number;\n  sillHeight: number;\n  parentWallId?: string;\n  glazingType?: \"single\" | \"double\" | \"triple\";\n}\n\nexport interface ColumnElement extends CADElement {\n  type: \"column\";\n  width: number;\n  depth: number;\n  shape: \"rectangular\" | \"circular\" | \"steel-h\" | \"steel-i\";\n}\n\nexport interface SpaceElement extends CADElement {\n  type: \"space\";\n  name: string;\n  area: number;\n  spaceType: string;\n  requiresDaylight?: boolean;\n  occupancy?: number;\n}\n\nexport interface DimensionElement extends CADElement {\n  type: \"dimension\";\n  value: number;\n  unit: \"m\" | \"mm\" | \"ft\" | \"in\";\n  startPoint: Point2D;\n  endPoint: Point2D;\n  offsetDistance: number;\n  textPosition?: Point2D;\n  precision?: number;\n}\n\nexport interface TextElement extends CADElement {\n  type: \"text\";\n  text: string;\n  fontSize: number;\n  fontFamily?: string;\n  textAlign?: \"left\" | \"center\" | \"right\";\n  verticalAlign?: \"top\" | \"middle\" | \"bottom\";\n}\n\nexport interface GridLineElement extends CADElement {\n  type: \"grid-line\";\n  axis: \"x\" | \"y\";\n  label: string;\n  position: number;\n}\n\n// -----------------------------------------------------------------------------\n// Floor Plan Document\n// -----------------------------------------------------------------------------\n\nexport interface FloorPlanDocument {\n  id: string;\n  projectId: string | number;\n  runId: string | number;\n  floorLevel: number;\n  width: number;\n  depth: number;\n  elements: CADElement[];\n  gridX: number[];\n  gridY: number[];\n  gridLabelsX?: string[];\n  gridLabelsY?: string[];\n  scale: number; // e.g., 100 for 1:100\n  unit: \"m\" | \"mm\" | \"ft\";\n  origin: Point2D;\n}\n\n// -----------------------------------------------------------------------------\n// View State Types\n// -----------------------------------------------------------------------------\n\nexport interface ViewTransform {\n  panX: number;\n  panY: number;\n  zoom: number;\n  rotation: number; // degrees\n}\n\nexport interface ViewportState {\n  width: number;\n  height: number;\n  transform: ViewTransform;\n  backgroundColor: \"dark\" | \"light\";\n  showGrid: boolean;\n  gridSize: number;\n  snapToGrid: boolean;\n  snapTolerance: number;\n}\n\n// -----------------------------------------------------------------------------\n// Selection and Interaction\n// -----------------------------------------------------------------------------\n\nexport interface SelectionState {\n  selectedIds: string[];\n  hoveredId: string | null;\n  selectionBox: BoundingBox2D | null;\n  isMultiSelect: boolean;\n}\n\nexport interface MeasurementState {\n  active: boolean;\n  points: Point2D[];\n  currentDistance: number | null;\n  unit: \"m\" | \"mm\" | \"ft\";\n}\n\n// -----------------------------------------------------------------------------\n// 3D Model Types\n// -----------------------------------------------------------------------------\n\nexport interface BuildingFloor {\n  level: number;\n  elevation: number; // Z height from ground\n  height: number; // floor-to-floor\n  visible: boolean;\n  opacity: number;\n  elements: Model3DElement[];\n}\n\nexport interface Model3DElement {\n  id: string;\n  type: CADElementType;\n  floorLevel: number;\n  geometry: {\n    type: \"box\" | \"extrusion\" | \"cylinder\" | \"mesh\";\n    position: Point3D;\n    dimensions?: Point3D;\n    rotation?: Point3D;\n    vertices?: number[];\n    indices?: number[];\n  };\n  material: {\n    color: string;\n    opacity: number;\n    metalness?: number;\n    roughness?: number;\n    transparent?: boolean;\n  };\n  properties: Record<string, unknown>;\n  selected?: boolean;\n  visible?: boolean;\n}\n\nexport interface ClippingPlane {\n  id: string;\n  name: string;\n  normal: Point3D;\n  constant: number;\n  enabled: boolean;\n  color?: string;\n}\n\nexport interface CameraState {\n  position: Point3D;\n  target: Point3D;\n  up: Point3D;\n  fov: number;\n  near: number;\n  far: number;\n  mode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\";\n}\n\nexport interface Building3DModel {\n  id: string;\n  projectId: string | number;\n  floors: BuildingFloor[];\n  clippingPlanes: ClippingPlane[];\n  camera: CameraState;\n  showGrid: boolean;\n  showAxes: boolean;\n  ambientOcclusion: boolean;\n  shadows: boolean;\n}\n\n// -----------------------------------------------------------------------------\n// CAD Color Constants (matching AutoCAD ACI colors)\n// -----------------------------------------------------------------------------\n\nexport const CAD_COLORS = {\n  // Layer colors\n  wall: \"#FFFFFF\",\n  wallExterior: \"#00FFFF\",\n  door: \"#FF8000\",\n  window: \"#00BFFF\",\n  column: \"#FF0000\",\n  beam: \"#FF0000\",\n  space: \"#E6E6E6\",\n  grid: \"#808080\",\n  dimension: \"#FFFF00\",\n  text: \"#FFFFFF\",\n  annotation: \"#00FF00\",\n  core: \"#C0C0C0\",\n  mepHvac: \"#00FFFF\",\n  mepElectrical: \"#FF00FF\",\n  mepPlumbing: \"#0000FF\",\n\n  // UI colors\n  selection: \"#00FF00\",\n  hover: \"#FFFF00\",\n  snap: \"#FF00FF\",\n  measurementLine: \"#00FFFF\",\n} as const;\n\n// -----------------------------------------------------------------------------\n// CAD Line Weights (in pixels at 1:1 scale)\n// -----------------------------------------------------------------------------\n\nexport const CAD_LINE_WEIGHTS = {\n  wall: 2.0,\n  wallExterior: 2.5,\n  partition: 1.5,\n  door: 1.0,\n  window: 1.0,\n  column: 1.5,\n  beam: 1.5,\n  grid: 0.5,\n  dimension: 0.5,\n  dimensionExtension: 0.25,\n  text: 0.5,\n  annotation: 0.5,\n  space: 0.25,\n  furniture: 0.5,\n  mep: 1.0,\n} as const;\n\n// -----------------------------------------------------------------------------\n// Layer Definitions\n// -----------------------------------------------------------------------------\n\nexport interface LayerDefinition {\n  id: CADLayer;\n  name: string;\n  color: string;\n  lineWeight: number;\n  visible: boolean;\n  locked: boolean;\n  printable: boolean;\n}\n\nexport const DEFAULT_LAYERS: LayerDefinition[] = [\n  {\n    id: \"architectural\",\n    name: \"Architectural\",\n    color: CAD_COLORS.wall,\n    lineWeight: CAD_LINE_WEIGHTS.wall,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"structural\",\n    name: \"Structural\",\n    color: CAD_COLORS.column,\n    lineWeight: CAD_LINE_WEIGHTS.column,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"mep-hvac\",\n    name: \"MEP - HVAC\",\n    color: CAD_COLORS.mepHvac,\n    lineWeight: CAD_LINE_WEIGHTS.mep,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"mep-electrical\",\n    name: \"MEP - Electrical\",\n    color: CAD_COLORS.mepElectrical,\n    lineWeight: CAD_LINE_WEIGHTS.mep,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"mep-plumbing\",\n    name: \"MEP - Plumbing\",\n    color: CAD_COLORS.mepPlumbing,\n    lineWeight: CAD_LINE_WEIGHTS.mep,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"annotations\",\n    name: \"Annotations\",\n    color: CAD_COLORS.annotation,\n    lineWeight: CAD_LINE_WEIGHTS.annotation,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"grid\",\n    name: \"Grid\",\n    color: CAD_COLORS.grid,\n    lineWeight: CAD_LINE_WEIGHTS.grid,\n    visible: true,\n    locked: true,\n    printable: true,\n  },\n  {\n    id: \"dimensions\",\n    name: \"Dimensions\",\n    color: CAD_COLORS.dimension,\n    lineWeight: CAD_LINE_WEIGHTS.dimension,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n  {\n    id: \"furniture\",\n    name: \"Furniture\",\n    color: \"#A0A0A0\",\n    lineWeight: CAD_LINE_WEIGHTS.furniture,\n    visible: true,\n    locked: false,\n    printable: true,\n  },\n];\n"],"names":[],"mappings":"AAAA,gFAAgF;AAChF,8DAA8D;AAC9D,gFAAgF;AAEhF,gFAAgF;AAChF,uBAAuB;AACvB,gFAAgF;;;;;;;;;AAsSzE,MAAM,aAAa;IACxB,eAAe;IACf,MAAM;IACN,cAAc;IACd,MAAM;IACN,QAAQ;IACR,QAAQ;IACR,MAAM;IACN,OAAO;IACP,MAAM;IACN,WAAW;IACX,MAAM;IACN,YAAY;IACZ,MAAM;IACN,SAAS;IACT,eAAe;IACf,aAAa;IAEb,YAAY;IACZ,WAAW;IACX,OAAO;IACP,MAAM;IACN,iBAAiB;AACnB;AAMO,MAAM,mBAAmB;IAC9B,MAAM;IACN,cAAc;IACd,WAAW;IACX,MAAM;IACN,QAAQ;IACR,QAAQ;IACR,MAAM;IACN,MAAM;IACN,WAAW;IACX,oBAAoB;IACpB,MAAM;IACN,YAAY;IACZ,OAAO;IACP,WAAW;IACX,KAAK;AACP;AAgBO,MAAM,iBAAoC;IAC/C;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,IAAI;QACtB,YAAY,iBAAiB,IAAI;QACjC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,MAAM;QACxB,YAAY,iBAAiB,MAAM;QACnC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,OAAO;QACzB,YAAY,iBAAiB,GAAG;QAChC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,aAAa;QAC/B,YAAY,iBAAiB,GAAG;QAChC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,WAAW;QAC7B,YAAY,iBAAiB,GAAG;QAChC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,UAAU;QAC5B,YAAY,iBAAiB,UAAU;QACvC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,IAAI;QACtB,YAAY,iBAAiB,IAAI;QACjC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO,WAAW,SAAS;QAC3B,YAAY,iBAAiB,SAAS;QACtC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,YAAY,iBAAiB,SAAS;QACtC,SAAS;QACT,QAAQ;QACR,WAAW;IACb;CACD"}},
    {"offset": {"line": 2015, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/plan-editor/CADCanvas.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * CADCanvas - Professional 2D CAD Viewer Component\n *\n * A full-featured 2D floor plan viewer built with Konva.js,\n * providing AutoCAD/Revit-like functionality including:\n * - Pan, zoom, and rotate controls\n * - Layer visibility management\n * - Element selection\n * - Grid display\n * - Measurement tools\n */\n\nimport React, { useEffect, useRef, useState, useCallback, useMemo } from \"react\";\nimport { Stage, Layer, Line, Rect, Circle, Text, Group } from \"react-konva\";\nimport type { KonvaEventObject } from \"konva/lib/Node\";\nimport type Konva from \"konva\";\nimport { useViewerStore } from \"@/stores/viewer-store\";\nimport { parseSVG, getElementsByLayer } from \"./utils/svg-parser\";\nimport { apiClient } from \"@/lib/api-client\";\nimport type { CADElement, CADLayer, Point2D } from \"@/types/cad\";\nimport { CAD_COLORS } from \"@/types/cad\";\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface CADCanvasProps {\n  projectId: string | number;\n  runId: string | number;\n  fileName: string;\n  className?: string;\n}\n\ninterface CanvasSize {\n  width: number;\n  height: number;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst MIN_ZOOM = 0.1;\nconst MAX_ZOOM = 50;\nconst ZOOM_SENSITIVITY = 1.1;\nconst GRID_SIZE_BASE = 1.2; // 1.2m architectural module\n\n// =============================================================================\n// CADCanvas Component\n// =============================================================================\n\nexport function CADCanvas({ projectId, runId, fileName, className }: CADCanvasProps) {\n  // Refs\n  const containerRef = useRef<HTMLDivElement>(null);\n  const stageRef = useRef<Konva.Stage>(null);\n\n  // Local state\n  const [canvasSize, setCanvasSize] = useState<CanvasSize>({ width: 800, height: 600 });\n  const [elements, setElements] = useState<CADElement[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [documentSize, setDocumentSize] = useState({ width: 100, height: 100 });\n  const [gridData, setGridData] = useState<{ gridX: number[]; gridY: number[] }>({ gridX: [], gridY: [] });\n\n  // Store state\n  const {\n    viewTransform,\n    setViewTransform,\n    backgroundColor,\n    showGrid,\n    layers,\n    selectedElementIds,\n    selectElement,\n    clearSelection,\n    setHoveredElement,\n    hoveredElementId,\n    measurementActive,\n    measurementPoints,\n    addMeasurementPoint,\n  } = useViewerStore();\n\n  // ==========================================================================\n  // Responsive sizing\n  // ==========================================================================\n\n  useEffect(() => {\n    const updateSize = () => {\n      if (containerRef.current) {\n        const rect = containerRef.current.getBoundingClientRect();\n        setCanvasSize({\n          width: rect.width || 800,\n          height: rect.height || 600,\n        });\n      }\n    };\n\n    updateSize();\n    window.addEventListener(\"resize\", updateSize);\n    return () => window.removeEventListener(\"resize\", updateSize);\n  }, []);\n\n  // ==========================================================================\n  // Load SVG data\n  // ==========================================================================\n\n  useEffect(() => {\n    const loadSVG = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const url = apiClient.getFileUrl(projectId, runId, fileName);\n        const response = await fetch(url);\n\n        if (!response.ok) {\n          throw new Error(`Failed to fetch plan: ${response.statusText}`);\n        }\n\n        const svgText = await response.text();\n\n        if (!svgText.includes(\"<svg\")) {\n          throw new Error(\"Invalid SVG content\");\n        }\n\n        const parsed = parseSVG(svgText);\n        setElements(parsed.elements);\n        setDocumentSize({ width: parsed.width, height: parsed.height });\n        setGridData({ gridX: parsed.gridX, gridY: parsed.gridY });\n\n        // Auto-fit view\n        if (containerRef.current && parsed.width > 0 && parsed.height > 0) {\n          const containerWidth = containerRef.current.clientWidth;\n          const containerHeight = containerRef.current.clientHeight;\n          const scaleX = containerWidth / parsed.width;\n          const scaleY = containerHeight / parsed.height;\n          const fitScale = Math.min(scaleX, scaleY) * 0.9;\n\n          setViewTransform({\n            zoom: fitScale,\n            panX: (containerWidth - parsed.width * fitScale) / 2,\n            panY: (containerHeight - parsed.height * fitScale) / 2,\n          });\n        }\n      } catch (err) {\n        console.error(\"Failed to load plan:\", err);\n        setError(err instanceof Error ? err.message : \"Failed to load plan\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (projectId && runId && fileName) {\n      loadSVG();\n    }\n  }, [projectId, runId, fileName, setViewTransform]);\n\n  // ==========================================================================\n  // Event Handlers\n  // ==========================================================================\n\n  const handleWheel = useCallback(\n    (e: KonvaEventObject<WheelEvent>) => {\n      e.evt.preventDefault();\n\n      const stage = stageRef.current;\n      if (!stage) return;\n\n      const oldScale = viewTransform.zoom;\n      const pointer = stage.getPointerPosition();\n      if (!pointer) return;\n\n      const mousePointTo = {\n        x: (pointer.x - viewTransform.panX) / oldScale,\n        y: (pointer.y - viewTransform.panY) / oldScale,\n      };\n\n      const direction = e.evt.deltaY > 0 ? -1 : 1;\n      const newScale = direction > 0 ? oldScale * ZOOM_SENSITIVITY : oldScale / ZOOM_SENSITIVITY;\n      const clampedScale = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, newScale));\n\n      setViewTransform({\n        zoom: clampedScale,\n        panX: pointer.x - mousePointTo.x * clampedScale,\n        panY: pointer.y - mousePointTo.y * clampedScale,\n      });\n    },\n    [viewTransform, setViewTransform]\n  );\n\n  const handleDragEnd = useCallback(\n    (e: KonvaEventObject<DragEvent>) => {\n      if (e.target === stageRef.current) {\n        setViewTransform({\n          panX: e.target.x(),\n          panY: e.target.y(),\n        });\n      }\n    },\n    [setViewTransform]\n  );\n\n  const handleStageClick = useCallback(\n    (e: KonvaEventObject<MouseEvent>) => {\n      // If clicking on stage background, clear selection\n      if (e.target === stageRef.current) {\n        if (measurementActive) {\n          const stage = stageRef.current;\n          if (stage) {\n            const pointer = stage.getPointerPosition();\n            if (pointer) {\n              const point: Point2D = {\n                x: (pointer.x - viewTransform.panX) / viewTransform.zoom,\n                y: (pointer.y - viewTransform.panY) / viewTransform.zoom,\n              };\n              addMeasurementPoint(point);\n            }\n          }\n        } else {\n          clearSelection();\n        }\n      }\n    },\n    [measurementActive, viewTransform, addMeasurementPoint, clearSelection]\n  );\n\n  const handleElementClick = useCallback(\n    (elementId: string, e: KonvaEventObject<MouseEvent>) => {\n      e.cancelBubble = true;\n      const isMultiSelect = e.evt.shiftKey || e.evt.ctrlKey || e.evt.metaKey;\n      selectElement(elementId, isMultiSelect);\n    },\n    [selectElement]\n  );\n\n  const handleElementMouseEnter = useCallback(\n    (elementId: string) => {\n      setHoveredElement(elementId);\n    },\n    [setHoveredElement]\n  );\n\n  const handleElementMouseLeave = useCallback(() => {\n    setHoveredElement(null);\n  }, [setHoveredElement]);\n\n  // ==========================================================================\n  // Filter elements by layer visibility\n  // ==========================================================================\n\n  const visibleElements = useMemo(() => {\n    return elements.filter((el) => {\n      const layerState = layers[el.layer];\n      return layerState?.visible !== false;\n    });\n  }, [elements, layers]);\n\n  // ==========================================================================\n  // Render Grid\n  // ==========================================================================\n\n  const renderGrid = useCallback(() => {\n    if (!showGrid) return null;\n\n    const lines: React.ReactNode[] = [];\n    const gridColor = backgroundColor === \"dark\" ? \"#333333\" : \"#CCCCCC\";\n    const gridStep = GRID_SIZE_BASE * 10; // 12m major grid\n\n    // Calculate grid bounds\n    const startX = Math.floor(-100 / gridStep) * gridStep;\n    const endX = Math.ceil((documentSize.width + 100) / gridStep) * gridStep;\n    const startY = Math.floor(-100 / gridStep) * gridStep;\n    const endY = Math.ceil((documentSize.height + 100) / gridStep) * gridStep;\n\n    // Vertical lines\n    for (let x = startX; x <= endX; x += gridStep) {\n      lines.push(\n        <Line\n          key={`grid-v-${x}`}\n          points={[x, startY, x, endY]}\n          stroke={gridColor}\n          strokeWidth={0.5 / viewTransform.zoom}\n          opacity={0.3}\n        />\n      );\n    }\n\n    // Horizontal lines\n    for (let y = startY; y <= endY; y += gridStep) {\n      lines.push(\n        <Line\n          key={`grid-h-${y}`}\n          points={[startX, y, endX, y]}\n          stroke={gridColor}\n          strokeWidth={0.5 / viewTransform.zoom}\n          opacity={0.3}\n        />\n      );\n    }\n\n    // Structural grid from document\n    gridData.gridX.forEach((x, i) => {\n      lines.push(\n        <Line\n          key={`struct-grid-x-${i}`}\n          points={[x, -50, x, documentSize.height + 50]}\n          stroke={CAD_COLORS.grid}\n          strokeWidth={0.3 / viewTransform.zoom}\n          dash={[10 / viewTransform.zoom, 5 / viewTransform.zoom]}\n          opacity={0.5}\n        />\n      );\n    });\n\n    gridData.gridY.forEach((y, i) => {\n      lines.push(\n        <Line\n          key={`struct-grid-y-${i}`}\n          points={[-50, y, documentSize.width + 50, y]}\n          stroke={CAD_COLORS.grid}\n          strokeWidth={0.3 / viewTransform.zoom}\n          dash={[10 / viewTransform.zoom, 5 / viewTransform.zoom]}\n          opacity={0.5}\n        />\n      );\n    });\n\n    return <Group>{lines}</Group>;\n  }, [showGrid, backgroundColor, documentSize, gridData, viewTransform.zoom]);\n\n  // ==========================================================================\n  // Render Element\n  // ==========================================================================\n\n  const renderElement = useCallback(\n    (element: CADElement) => {\n      const isSelected = selectedElementIds.includes(element.id);\n      const isHovered = hoveredElementId === element.id;\n\n      const strokeColor = isSelected\n        ? CAD_COLORS.selection\n        : isHovered\n          ? CAD_COLORS.hover\n          : element.strokeColor || \"#FFFFFF\";\n\n      const strokeWidth =\n        ((element.strokeWidth || 1) / viewTransform.zoom) * (isSelected ? 1.5 : 1);\n\n      const commonProps = {\n        key: element.id,\n        onClick: (e: KonvaEventObject<MouseEvent>) => handleElementClick(element.id, e),\n        onMouseEnter: () => handleElementMouseEnter(element.id),\n        onMouseLeave: handleElementMouseLeave,\n      };\n\n      // Render based on element type and geometry\n      if (element.points.length === 1) {\n        // Single point - render as circle (column, etc.)\n        const radius = (element.properties as { radius?: number }).radius || 2;\n        return (\n          <Circle\n            {...commonProps}\n            x={element.points[0].x}\n            y={element.points[0].y}\n            radius={radius}\n            stroke={strokeColor}\n            strokeWidth={strokeWidth}\n            fill={element.fillColor || \"transparent\"}\n          />\n        );\n      }\n\n      if (element.points.length === 2) {\n        // Two points - render as line\n        return (\n          <Line\n            {...commonProps}\n            points={[\n              element.points[0].x,\n              element.points[0].y,\n              element.points[1].x,\n              element.points[1].y,\n            ]}\n            stroke={strokeColor}\n            strokeWidth={strokeWidth}\n            hitStrokeWidth={Math.max(strokeWidth * 3, 5 / viewTransform.zoom)}\n          />\n        );\n      }\n\n      if (element.points.length === 4 && element.type === \"space\") {\n        // Rectangle (space)\n        const minX = Math.min(...element.points.map((p) => p.x));\n        const minY = Math.min(...element.points.map((p) => p.y));\n        const maxX = Math.max(...element.points.map((p) => p.x));\n        const maxY = Math.max(...element.points.map((p) => p.y));\n\n        const spaceColor =\n          backgroundColor === \"dark\"\n            ? \"rgba(100, 100, 150, 0.1)\"\n            : \"rgba(200, 200, 220, 0.2)\";\n\n        return (\n          <Group key={element.id}>\n            <Rect\n              {...commonProps}\n              x={minX}\n              y={minY}\n              width={maxX - minX}\n              height={maxY - minY}\n              stroke={strokeColor}\n              strokeWidth={strokeWidth}\n              fill={isSelected ? \"rgba(0, 255, 0, 0.1)\" : spaceColor}\n            />\n            {/* Space label */}\n            <Text\n              x={minX + 5}\n              y={minY + 5}\n              text={(element.properties as { name?: string }).name || element.id}\n              fontSize={Math.max(8 / viewTransform.zoom, 10)}\n              fill={backgroundColor === \"dark\" ? \"#AAAAAA\" : \"#666666\"}\n            />\n          </Group>\n        );\n      }\n\n      // Polyline/polygon\n      const flatPoints = element.points.flatMap((p) => [p.x, p.y]);\n      const isClosed =\n        element.type === \"space\" ||\n        element.type === \"core\" ||\n        element.fillColor !== \"none\";\n\n      return (\n        <Line\n          {...commonProps}\n          points={flatPoints}\n          stroke={strokeColor}\n          strokeWidth={strokeWidth}\n          fill={isClosed ? element.fillColor || \"transparent\" : undefined}\n          closed={isClosed}\n          hitStrokeWidth={Math.max(strokeWidth * 3, 5 / viewTransform.zoom)}\n        />\n      );\n    },\n    [\n      selectedElementIds,\n      hoveredElementId,\n      viewTransform.zoom,\n      backgroundColor,\n      handleElementClick,\n      handleElementMouseEnter,\n      handleElementMouseLeave,\n    ]\n  );\n\n  // ==========================================================================\n  // Render Measurement\n  // ==========================================================================\n\n  const renderMeasurement = useCallback(() => {\n    if (!measurementActive || measurementPoints.length === 0) return null;\n\n    const lines: React.ReactNode[] = [];\n    const points = measurementPoints;\n\n    for (let i = 0; i < points.length - 1; i++) {\n      const p1 = points[i];\n      const p2 = points[i + 1];\n      const dx = p2.x - p1.x;\n      const dy = p2.y - p1.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      const midX = (p1.x + p2.x) / 2;\n      const midY = (p1.y + p2.y) / 2;\n\n      lines.push(\n        <Group key={`measure-${i}`}>\n          <Line\n            points={[p1.x, p1.y, p2.x, p2.y]}\n            stroke={CAD_COLORS.measurementLine}\n            strokeWidth={2 / viewTransform.zoom}\n          />\n          <Circle\n            x={p1.x}\n            y={p1.y}\n            radius={4 / viewTransform.zoom}\n            fill={CAD_COLORS.measurementLine}\n          />\n          <Circle\n            x={p2.x}\n            y={p2.y}\n            radius={4 / viewTransform.zoom}\n            fill={CAD_COLORS.measurementLine}\n          />\n          <Text\n            x={midX}\n            y={midY - 15 / viewTransform.zoom}\n            text={`${distance.toFixed(2)} m`}\n            fontSize={14 / viewTransform.zoom}\n            fill={CAD_COLORS.dimension}\n            align=\"center\"\n          />\n        </Group>\n      );\n    }\n\n    // Show last point marker\n    if (points.length > 0) {\n      const lastPoint = points[points.length - 1];\n      lines.push(\n        <Circle\n          key=\"measure-last\"\n          x={lastPoint.x}\n          y={lastPoint.y}\n          radius={4 / viewTransform.zoom}\n          fill={CAD_COLORS.measurementLine}\n        />\n      );\n    }\n\n    return <Group>{lines}</Group>;\n  }, [measurementActive, measurementPoints, viewTransform.zoom]);\n\n  // ==========================================================================\n  // Loading and Error States\n  // ==========================================================================\n\n  if (loading) {\n    return (\n      <div className={`flex items-center justify-center h-full ${className}`}>\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n          <span className=\"text-gray-400\">Loading floor plan...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`flex items-center justify-center h-full ${className}`}>\n        <div className=\"flex flex-col items-center gap-4 text-center max-w-md\">\n          <div className=\"text-red-500 text-5xl\">!</div>\n          <h3 className=\"text-xl font-semibold text-red-400\">Failed to load plan</h3>\n          <p className=\"text-gray-400\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  // ==========================================================================\n  // Render\n  // ==========================================================================\n\n  const bgColor = backgroundColor === \"dark\" ? \"#1a1a2e\" : \"#f5f5f5\";\n\n  return (\n    <div\n      ref={containerRef}\n      className={`relative w-full h-full overflow-hidden ${className}`}\n      style={{ backgroundColor: bgColor }}\n    >\n      <Stage\n        ref={stageRef}\n        width={canvasSize.width}\n        height={canvasSize.height}\n        x={viewTransform.panX}\n        y={viewTransform.panY}\n        scaleX={viewTransform.zoom}\n        scaleY={viewTransform.zoom}\n        rotation={viewTransform.rotation}\n        draggable\n        onWheel={handleWheel}\n        onDragEnd={handleDragEnd}\n        onClick={handleStageClick}\n        style={{ cursor: measurementActive ? \"crosshair\" : \"grab\" }}\n      >\n        {/* Grid Layer */}\n        <Layer>{renderGrid()}</Layer>\n\n        {/* Elements Layer */}\n        <Layer>{visibleElements.map(renderElement)}</Layer>\n\n        {/* Measurement Layer */}\n        <Layer>{renderMeasurement()}</Layer>\n      </Stage>\n\n      {/* Zoom indicator */}\n      <div className=\"absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded text-sm\">\n        {(viewTransform.zoom * 100).toFixed(0)}%\n      </div>\n\n      {/* Coordinates display */}\n      <div className=\"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded text-xs font-mono\">\n        {documentSize.width.toFixed(1)}  {documentSize.height.toFixed(1)} m\n      </div>\n    </div>\n  );\n}\n\nexport default CADCanvas;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2730, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/plan-editor/index.ts"],"sourcesContent":["export { SvgCanvas } from \"./SvgCanvas\";\nexport { CADCanvas } from \"./CADCanvas\";\n"],"names":[],"mappings":";AAAA;AACA"}},
    {"offset": {"line": 2739, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/app/project/%5Bid%5D/plan-editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useParams } from \"next/navigation\";\nimport { useEffect, useState, useCallback } from \"react\";\nimport {\n  Layout,\n  Move,\n  Square,\n  DoorOpen,\n  Maximize2,\n  Type,\n  Eraser,\n  Grid,\n  Layers,\n  ZoomIn,\n  ZoomOut,\n  RotateCcw,\n  Ruler,\n  Sun,\n  Moon,\n  Eye,\n  EyeOff,\n  Lock,\n  Unlock,\n  Home,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Card, CardContent, Button } from \"@/components/ui\";\nimport { CADCanvas, SvgCanvas } from \"@/components/plan-editor\";\nimport { apiClient } from \"@/lib/api-client\";\nimport { useUIStore } from \"@/stores/ui-store\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { useViewerStore } from \"@/stores/viewer-store\";\nimport type { ToolType } from \"@/types\";\nimport type { CADLayer } from \"@/types/cad\";\n\n// Feature flag for new viewer\nconst USE_NEW_VIEWER = process.env.NEXT_PUBLIC_USE_NEW_VIEWERS !== \"false\";\n\nconst tools: Array<{ id: ToolType; icon: typeof Move; label: string; labelAr: string }> = [\n  { id: \"select\", icon: Move, label: \"Select\", labelAr: \"\" },\n  { id: \"pan\", icon: Layout, label: \"Pan\", labelAr: \"\" },\n  { id: \"wall\", icon: Square, label: \"Wall\", labelAr: \"\" },\n  { id: \"door\", icon: DoorOpen, label: \"Door\", labelAr: \"\" },\n  { id: \"window\", icon: Maximize2, label: \"Window\", labelAr: \"\" },\n  { id: \"dimension\", icon: Ruler, label: \"Dimension\", labelAr: \"\" },\n  { id: \"text\", icon: Type, label: \"Text\", labelAr: \"\" },\n  { id: \"erase\", icon: Eraser, label: \"Erase\", labelAr: \"\" },\n];\n\nconst layerDefinitions: Array<{\n  id: CADLayer;\n  label: string;\n  labelAr: string;\n  color: string;\n}> = [\n  { id: \"architectural\", label: \"Architectural\", labelAr: \"\", color: \"#FFFFFF\" },\n  { id: \"structural\", label: \"Structural\", labelAr: \"\", color: \"#FF0000\" },\n  { id: \"mep-hvac\", label: \"MEP - HVAC\", labelAr: \"\", color: \"#00FFFF\" },\n  { id: \"mep-electrical\", label: \"MEP - Electrical\", labelAr: \"\", color: \"#FF00FF\" },\n  { id: \"mep-plumbing\", label: \"MEP - Plumbing\", labelAr: \"\", color: \"#0000FF\" },\n  { id: \"annotations\", label: \"Annotations\", labelAr: \"\", color: \"#00FF00\" },\n  { id: \"grid\", label: \"Grid\", labelAr: \"\", color: \"#808080\" },\n  { id: \"dimensions\", label: \"Dimensions\", labelAr: \"\", color: \"#FFFF00\" },\n];\n\nexport default function PlanEditorPage() {\n  const params = useParams();\n  const { language } = useUIStore();\n  const { project, run, setProject, setRun } = useProjectStore();\n  const {\n    activeTool,\n    setActiveTool,\n    layers,\n    toggleLayerVisibility,\n    setLayerLocked,\n    backgroundColor,\n    setBackgroundColor,\n    showGrid,\n    toggleGrid,\n    viewTransform,\n    zoomIn,\n    zoomOut,\n    zoomToFit,\n    rotateView,\n    measurementActive,\n    startMeasurement,\n    clearMeasurement,\n    selectedElementIds,\n  } = useViewerStore();\n\n  const isRtl = language === \"ar\";\n  const projectIdParam = Array.isArray(params.id) ? params.id[0] : params.id;\n  const projectId = projectIdParam ?? \"\";\n  const [planFile, setPlanFile] = useState<string | null>(null);\n  const [backendStatus, setBackendStatus] = useState({ available: true, message: \"\" });\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Don't trigger shortcuts when typing in inputs\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      switch (e.key.toLowerCase()) {\n        case \"escape\":\n          clearMeasurement();\n          break;\n        case \"v\":\n        case \"1\":\n          setActiveTool(\"select\");\n          break;\n        case \"h\":\n        case \"2\":\n          setActiveTool(\"pan\");\n          break;\n        case \"m\":\n          if (measurementActive) {\n            clearMeasurement();\n          } else {\n            startMeasurement();\n          }\n          break;\n        case \"g\":\n          toggleGrid();\n          break;\n        case \"r\":\n          rotateView(90);\n          break;\n        case \"f\":\n          zoomToFit();\n          break;\n        case \"+\":\n        case \"=\":\n          zoomIn();\n          break;\n        case \"-\":\n          zoomOut();\n          break;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [\n    measurementActive,\n    setActiveTool,\n    toggleGrid,\n    rotateView,\n    zoomToFit,\n    zoomIn,\n    zoomOut,\n    startMeasurement,\n    clearMeasurement,\n  ]);\n\n  useEffect(() => {\n    const loadProjectAndRun = async () => {\n      const status = apiClient.getBackendStatus();\n      setBackendStatus(status);\n\n      const found = await apiClient.getProject(projectId);\n      if (found) {\n        setProject(found);\n        const latestRun = await apiClient.getLatestRunForProject(projectId);\n        if (latestRun) {\n          setRun(latestRun);\n        }\n      }\n    };\n    loadProjectAndRun();\n  }, [projectId, setProject, setRun]);\n\n  const handleRetryConnection = async () => {\n    const connected = await apiClient.retryConnection();\n    if (connected) {\n      window.location.reload();\n    } else {\n      setBackendStatus(apiClient.getBackendStatus());\n    }\n  };\n\n  useEffect(() => {\n    const loadArtifacts = async () => {\n      if (!run?.id) return;\n      try {\n        setPlanFile(null);\n        const artifacts = await apiClient.getRunArtifacts(run.id);\n        const planArtifact = artifacts.find(\n          (a) =>\n            a.kind === \"plan\" || a.kind === \"plan_svg\" || a.file_name?.endsWith(\"_plan.svg\")\n        );\n        if (planArtifact) {\n          setPlanFile(planArtifact.file_name);\n          return;\n        }\n\n        const state = await apiClient.getState().catch(() => null);\n        const outputFile = state?.outputs?.plan_svg_file;\n        const stateRunId = state?.run?.id ? String(state.run.id) : \"\";\n        const stateProjectId = state?.project?.id ? String(state.project.id) : \"\";\n        if (\n          outputFile &&\n          stateRunId &&\n          stateProjectId &&\n          stateRunId === String(run.id) &&\n          stateProjectId === String(project?.id)\n        ) {\n          setPlanFile(outputFile);\n        }\n      } catch (error) {\n        console.error(\"Failed to load artifacts:\", error);\n      }\n    };\n    loadArtifacts();\n  }, [run?.id, project?.id]);\n\n  const handleMeasureToggle = useCallback(() => {\n    if (measurementActive) {\n      clearMeasurement();\n    } else {\n      startMeasurement();\n    }\n  }, [measurementActive, startMeasurement, clearMeasurement]);\n\n  return (\n    <div className=\"space-y-4 animate-fade-in\">\n      {/* Page Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <p className=\"text-xs font-bold uppercase tracking-[3px] text-[var(--accent-2)] mb-1\">\n            {project?.name || (isRtl ? \"\" : \"Project\")}\n          </p>\n          <h1 className=\"text-2xl font-bold text-[var(--ink)]\">\n            {isRtl ? \" \" : \"Plan Editor\"}\n          </h1>\n        </div>\n\n        {/* View Controls */}\n        <div className=\"flex items-center gap-2\">\n          {/* Zoom Controls */}\n          <div className=\"flex items-center gap-1 bg-[var(--surface-2)] rounded-lg p-1 border border-[var(--line)]\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={zoomOut} title=\"Zoom Out (-)\">\n              <ZoomOut className=\"w-4 h-4\" />\n            </Button>\n            <span className=\"text-xs text-[var(--ink-soft)] min-w-[50px] text-center\">\n              {(viewTransform.zoom * 100).toFixed(0)}%\n            </span>\n            <Button variant=\"ghost\" size=\"sm\" onClick={zoomIn} title=\"Zoom In (+)\">\n              <ZoomIn className=\"w-4 h-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"sm\" onClick={zoomToFit} title=\"Fit View (F)\">\n              <Home className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Rotate */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => rotateView(90)}\n            title=\"Rotate 90 (R)\"\n          >\n            <RotateCcw className=\"w-4 h-4\" />\n          </Button>\n\n          {/* Grid Toggle */}\n          <Button\n            variant={showGrid ? \"primary\" : \"outline\"}\n            size=\"sm\"\n            onClick={toggleGrid}\n            title=\"Toggle Grid (G)\"\n          >\n            <Grid className=\"w-4 h-4\" />\n          </Button>\n\n          {/* Measure Tool */}\n          <Button\n            variant={measurementActive ? \"primary\" : \"outline\"}\n            size=\"sm\"\n            onClick={handleMeasureToggle}\n            title=\"Measure Tool (M)\"\n          >\n            <Ruler className=\"w-4 h-4\" />\n          </Button>\n\n          {/* Background Toggle */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setBackgroundColor(backgroundColor === \"dark\" ? \"light\" : \"dark\")}\n            title=\"Toggle Background\"\n          >\n            {backgroundColor === \"dark\" ? (\n              <Sun className=\"w-4 h-4\" />\n            ) : (\n              <Moon className=\"w-4 h-4\" />\n            )}\n          </Button>\n        </div>\n      </div>\n\n      {/* CAD Workspace */}\n      <div className=\"grid grid-cols-[72px_1fr_280px] gap-4\">\n        {/* Tools Palette */}\n        <Card className=\"h-fit\">\n          <CardContent className=\"p-2\">\n            <div className=\"space-y-2\">\n              {tools.map((tool) => {\n                const Icon = tool.icon;\n                const isActive = tool.id === activeTool;\n                return (\n                  <button\n                    key={tool.id}\n                    onClick={() => setActiveTool(tool.id)}\n                    className={cn(\n                      \"w-12 h-12 rounded-[var(--radius-sm)] border flex items-center justify-center transition-all\",\n                      isActive\n                        ? \"bg-[rgba(15,76,129,0.12)] border-[var(--accent)] text-[var(--accent)]\"\n                        : \"bg-[var(--surface-2)] border-[var(--line)] text-[var(--ink-soft)] hover:border-[var(--accent)]\"\n                    )}\n                    title={`${isRtl ? tool.labelAr : tool.label}`}\n                  >\n                    <Icon className=\"w-5 h-5\" />\n                  </button>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Canvas */}\n        <Card className=\"min-h-[600px] overflow-hidden\">\n          <CardContent className=\"p-0 h-full\">\n            {planFile && project?.id && run?.id ? (\n              USE_NEW_VIEWER ? (\n                <CADCanvas\n                  projectId={project.id}\n                  runId={run.id}\n                  fileName={planFile}\n                  className=\"w-full h-[600px]\"\n                />\n              ) : (\n                <SvgCanvas\n                  projectId={project.id}\n                  runId={run.id}\n                  fileName={planFile}\n                  className=\"w-full h-[600px] rounded-[var(--radius-md)]\"\n                />\n              )\n            ) : (\n              <div\n                className={cn(\n                  \"w-full h-[600px] rounded-[var(--radius-md)] border border-[var(--line)] relative overflow-hidden\",\n                  backgroundColor === \"dark\" ? \"bg-[#1a1a2e]\" : \"bg-[#f8f6f1]\"\n                )}\n                style={{\n                  backgroundImage:\n                    showGrid\n                      ? `\n                      linear-gradient(0deg, rgba(100,110,125,0.14) 1px, transparent 1px),\n                      linear-gradient(90deg, rgba(100,110,125,0.14) 1px, transparent 1px)\n                    `\n                      : undefined,\n                  backgroundSize: \"24px 24px\",\n                }}\n              >\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                  <div className=\"text-center text-[var(--ink-faint)] max-w-md px-4\">\n                    <Layout className=\"w-16 h-16 mx-auto mb-4 opacity-30\" />\n                    {!backendStatus.available ? (\n                      <>\n                        <p className=\"text-lg font-medium text-amber-600\">\n                          {isRtl ? \"  \" : \"Backend Not Connected\"}\n                        </p>\n                        <p className=\"text-sm mt-2\">\n                          {isRtl\n                            ? \"     \"\n                            : \"Start the backend server to view generated plans\"}\n                        </p>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"mt-4\"\n                          onClick={handleRetryConnection}\n                        >\n                          {isRtl ? \" \" : \"Retry Connection\"}\n                        </Button>\n                      </>\n                    ) : !run?.id ? (\n                      <>\n                        <p className=\"text-lg font-medium\">\n                          {isRtl ? \"   \" : \"No Active Run\"}\n                        </p>\n                        <p className=\"text-sm mt-2\">\n                          {isRtl\n                            ? \"    \"\n                            : \"Go to Orchestrator to start generation\"}\n                        </p>\n                      </>\n                    ) : (\n                      <>\n                        <p className=\"text-lg font-medium\">\n                          {isRtl ? \"  ...\" : \"Loading plan...\"}\n                        </p>\n                        <p className=\"text-sm mt-2\">\n                          {isRtl\n                            ? \"    \"\n                            : \"Please wait while files are loading\"}\n                        </p>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Properties Panel */}\n        <div className=\"space-y-4\">\n          {/* Layers */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"font-semibold text-[var(--ink)]\">\n                  {isRtl ? \"\" : \"Layers\"}\n                </h3>\n                <Layers className=\"w-4 h-4 text-[var(--ink-soft)]\" />\n              </div>\n              <div className=\"space-y-2 max-h-[300px] overflow-y-auto\">\n                {layerDefinitions.map((layer) => {\n                  const layerState = layers[layer.id];\n                  const isVisible = layerState?.visible !== false;\n                  const isLocked = layerState?.locked === true;\n\n                  return (\n                    <div\n                      key={layer.id}\n                      className={cn(\n                        \"flex items-center gap-2 p-2 rounded-[var(--radius-sm)] border transition-all\",\n                        isVisible\n                          ? \"bg-[var(--surface-2)] border-[var(--line)]\"\n                          : \"bg-[var(--bg-2)] border-transparent opacity-60\"\n                      )}\n                    >\n                      {/* Visibility Toggle */}\n                      <button\n                        onClick={() => toggleLayerVisibility(layer.id)}\n                        className=\"p-1 hover:bg-[var(--bg-2)] rounded\"\n                        title={isVisible ? \"Hide Layer\" : \"Show Layer\"}\n                      >\n                        {isVisible ? (\n                          <Eye className=\"w-4 h-4 text-[var(--ink-soft)]\" />\n                        ) : (\n                          <EyeOff className=\"w-4 h-4 text-[var(--ink-faint)]\" />\n                        )}\n                      </button>\n\n                      {/* Lock Toggle */}\n                      <button\n                        onClick={() => setLayerLocked(layer.id, !isLocked)}\n                        className=\"p-1 hover:bg-[var(--bg-2)] rounded\"\n                        title={isLocked ? \"Unlock Layer\" : \"Lock Layer\"}\n                      >\n                        {isLocked ? (\n                          <Lock className=\"w-4 h-4 text-amber-500\" />\n                        ) : (\n                          <Unlock className=\"w-4 h-4 text-[var(--ink-faint)]\" />\n                        )}\n                      </button>\n\n                      {/* Color indicator */}\n                      <span\n                        className=\"w-3 h-3 rounded-full border border-white/20\"\n                        style={{ backgroundColor: layer.color }}\n                      />\n\n                      {/* Layer name */}\n                      <span className=\"text-sm text-[var(--ink)] flex-1\">\n                        {isRtl ? layer.labelAr : layer.label}\n                      </span>\n                    </div>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Selection Info / Properties */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <h3 className=\"font-semibold text-[var(--ink)] mb-3\">\n                {isRtl ? \"\" : \"Properties\"}\n              </h3>\n              {selectedElementIds.length > 0 ? (\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm text-[var(--accent)]\">\n                    {selectedElementIds.length}{\" \"}\n                    {isRtl\n                      ? ` `\n                      : `element${selectedElementIds.length > 1 ? \"s\" : \"\"} selected`}\n                  </p>\n                  <div className=\"text-xs text-[var(--ink-soft)] space-y-1\">\n                    {selectedElementIds.slice(0, 5).map((id) => (\n                      <div key={id} className=\"truncate\">\n                        {id}\n                      </div>\n                    ))}\n                    {selectedElementIds.length > 5 && (\n                      <div className=\"text-[var(--ink-faint)]\">\n                        +{selectedElementIds.length - 5} more...\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ) : (\n                <p className=\"text-sm text-[var(--ink-soft)]\">\n                  {isRtl\n                    ? \"    \"\n                    : \"Click an element to view properties\"}\n                </p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Keyboard Shortcuts */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <h3 className=\"font-semibold text-[var(--ink)] mb-3 text-sm\">\n                {isRtl ? \"  \" : \"Keyboard Shortcuts\"}\n              </h3>\n              <div className=\"text-xs text-[var(--ink-soft)] space-y-1\">\n                <div className=\"flex justify-between\">\n                  <span>V / 1</span>\n                  <span>{isRtl ? \"\" : \"Select\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>M</span>\n                  <span>{isRtl ? \"\" : \"Measure\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>G</span>\n                  <span>{isRtl ? \"\" : \"Grid\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>R</span>\n                  <span>{isRtl ? \"\" : \"Rotate\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>F</span>\n                  <span>{isRtl ? \"\" : \"Fit\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>+/-</span>\n                  <span>{isRtl ? \"\" : \"Zoom\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Esc</span>\n                  <span>{isRtl ? \"\" : \"Cancel\"}</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}