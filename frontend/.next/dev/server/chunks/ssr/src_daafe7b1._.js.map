{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/ModelViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport { Suspense, useRef, useState, useEffect } from \"react\";\nimport { Canvas, useThree, useFrame, invalidate } from \"@react-three/fiber\";\nimport { OrbitControls, Grid, useGLTF, Center } from \"@react-three/drei\";\nimport { Loader2, Box, RotateCcw } from \"lucide-react\";\nimport * as THREE from \"three\";\nimport type { OrbitControls as OrbitControlsImpl } from \"three-stdlib\";\n\n// Performance constants\nconst TARGET_FPS = 30;\nconst MAX_PIXEL_RATIO = 1.5;\n\ninterface ModelProps {\n  url: string;\n  onLoad?: () => void;\n  onError?: (error: Error) => void;\n}\n\nfunction Model({ url, onLoad, onError }: ModelProps) {\n  const { scene } = useGLTF(url, true, true, (loader) => {\n    loader.manager.onLoad = () => onLoad?.();\n    loader.manager.onError = (url) => onError?.(new Error(`Failed to load: ${url}`));\n  });\n\n  useEffect(() => {\n    if (scene) {\n      // Center and scale the model\n      const box = new THREE.Box3().setFromObject(scene);\n      const center = box.getCenter(new THREE.Vector3());\n      const size = box.getSize(new THREE.Vector3());\n\n      // Move model to origin\n      scene.position.sub(center);\n\n      // Scale to fit\n      const maxDim = Math.max(size.x, size.y, size.z);\n      if (maxDim > 50) {\n        const scale = 50 / maxDim;\n        scene.scale.setScalar(scale);\n      }\n    }\n  }, [scene]);\n\n  return <primitive object={scene} />;\n}\n\nfunction CameraController() {\n  const { camera } = useThree();\n\n  useEffect(() => {\n    camera.position.set(60, 40, 60);\n    camera.lookAt(0, 0, 0);\n  }, [camera]);\n\n  return null;\n}\n\n// Frame rate limiter for performance optimization\nfunction FrameLimiter() {\n  const lastFrameTime = useRef(0);\n  const frameInterval = 1000 / TARGET_FPS;\n\n  useFrame((state) => {\n    const currentTime = state.clock.elapsedTime * 1000;\n    if (currentTime - lastFrameTime.current >= frameInterval) {\n      lastFrameTime.current = currentTime;\n      invalidate(); // Request next frame\n    }\n  });\n\n  return null;\n}\n\nfunction LoadingFallback() {\n  const meshRef = useRef<THREE.Mesh>(null);\n\n  useFrame((state) => {\n    if (meshRef.current) {\n      meshRef.current.rotation.y = state.clock.elapsedTime * 0.5;\n    }\n  });\n\n  return (\n    <mesh ref={meshRef}>\n      <boxGeometry args={[10, 10, 10]} />\n      <meshStandardMaterial color=\"#c7b8a8\" wireframe />\n    </mesh>\n  );\n}\n\ninterface ModelViewerProps {\n  modelUrl: string;\n  className?: string;\n}\n\nexport function ModelViewer({ modelUrl, className = \"\" }: ModelViewerProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  const controlsRef = useRef<OrbitControlsImpl | null>(null);\n\n  const handleLoad = () => {\n    setLoading(false);\n    setError(null);\n  };\n\n  const handleError = (err: Error) => {\n    setLoading(false);\n    setError(err.message);\n  };\n\n  const resetCamera = () => {\n    if (controlsRef.current) {\n      controlsRef.current.reset();\n    }\n  };\n\n  // Pause rendering when tab is not visible\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      setIsVisible(!document.hidden);\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n  }, []);\n\n  if (!modelUrl) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-gradient-to-b from-[#e8e4dc] to-[#d4d0c8] ${className}`}>\n        <div className=\"text-center text-[var(--ink-faint)]\">\n          <Box className=\"w-16 h-16 mx-auto mb-4 opacity-30\" />\n          <p className=\"text-lg font-medium\">No model available</p>\n          <p className=\"text-sm mt-2\">Generate a project to view the 3D model</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative w-full h-full ${className}`}>\n      <Canvas\n        camera={{ position: [60, 40, 60], fov: 45 }}\n        style={{ background: \"linear-gradient(to bottom, #e8e4dc, #d4d0c8)\" }}\n        frameloop={isVisible ? \"demand\" : \"never\"} // Pause when tab hidden\n        dpr={[1, MAX_PIXEL_RATIO]} // Cap pixel ratio for performance\n        gl={{\n          antialias: false, // Disable expensive AA\n          alpha: true,\n          powerPreference: \"high-performance\",\n          stencil: false,\n          depth: true,\n        }}\n        performance={{ min: 0.5 }} // Allow quality reduction under load\n      >\n        <FrameLimiter />\n        <CameraController />\n\n        {/* Lighting */}\n        <ambientLight intensity={0.4} />\n        <directionalLight\n          position={[50, 50, 25]}\n          intensity={0.8}\n          castShadow\n          shadow-mapSize={[1024, 1024]}\n        />\n        <directionalLight position={[-30, 30, -25]} intensity={0.3} />\n\n        {/* Model */}\n        <Suspense fallback={<LoadingFallback />}>\n          <Center>\n            <Model url={modelUrl} onLoad={handleLoad} onError={handleError} />\n          </Center>\n        </Suspense>\n\n        {/* Ground Grid - Optimized for performance */}\n        <Grid\n          args={[100, 100]}  // Reduced from 200x200 for better performance\n          position={[0, -0.1, 0]}\n          cellSize={10}  // Larger cells = fewer lines\n          cellThickness={0.5}\n          cellColor=\"#c9c0b5\"\n          sectionSize={50}\n          sectionThickness={1}\n          sectionColor=\"#b5aa9d\"\n          fadeDistance={80}  // Fade closer for performance\n          fadeStrength={1.5}\n          followCamera={false}\n        />\n\n        {/* Controls */}\n        <OrbitControls\n          ref={controlsRef}\n          enableDamping\n          dampingFactor={0.05}\n          minDistance={10}\n          maxDistance={300}\n          maxPolarAngle={Math.PI / 2}\n          target={[0, 0, 0]}\n        />\n      </Canvas>\n\n      {/* Loading Overlay */}\n      {loading && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-sm\">\n          <div className=\"text-center\">\n            <Loader2 className=\"w-10 h-10 mx-auto mb-3 animate-spin text-[var(--accent)]\" />\n            <p className=\"text-sm text-[var(--ink-soft)]\">Loading 3D model...</p>\n          </div>\n        </div>\n      )}\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"absolute top-4 left-4 right-4 bg-red-50 border border-red-200 rounded-lg p-3\">\n          <p className=\"text-sm text-red-600\">{error}</p>\n        </div>\n      )}\n\n      {/* Controls Overlay */}\n      <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-[var(--surface)] rounded-full px-4 py-2 shadow-lg border border-[var(--line)]\">\n        <button\n          onClick={resetCamera}\n          className=\"p-2 rounded-full hover:bg-[var(--bg-2)] text-[var(--ink-soft)] transition-colors\"\n          title=\"Reset view\"\n        >\n          <RotateCcw className=\"w-5 h-5\" />\n        </button>\n        <span className=\"text-xs text-[var(--ink-faint)] px-2\">\n          Drag to rotate | Scroll to zoom\n        </span>\n      </div>\n\n      {/* Model info */}\n      <div className=\"absolute top-4 right-4 bg-[var(--surface)] rounded-[var(--radius-sm)] px-3 py-1.5 shadow border border-[var(--line)]\">\n        <span className=\"text-xs text-[var(--ink-soft)] font-mono\">\n          glTF 2.0\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default ModelViewer;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/stores/viewer-store.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport type {\n  CADLayer,\n  Point2D,\n  Point3D,\n  ViewTransform,\n  ClippingPlane,\n} from \"@/types/cad\";\nimport type { ToolType } from \"@/types\";\n\n// =============================================================================\n// Viewer Store Types\n// =============================================================================\n\ninterface LayerState {\n  visible: boolean;\n  locked: boolean;\n  opacity: number;\n}\n\ninterface ViewerState {\n  // -------------------------------------------------------------------------\n  // 2D Viewer State\n  // -------------------------------------------------------------------------\n\n  // Active tool\n  activeTool: ToolType;\n\n  // Layer visibility and state\n  layers: Record<CADLayer, LayerState>;\n\n  // Selection\n  selectedElementIds: string[];\n  hoveredElementId: string | null;\n\n  // View transform\n  viewTransform: ViewTransform;\n\n  // Canvas settings\n  backgroundColor: \"dark\" | \"light\";\n  showGrid: boolean;\n  gridSize: number;\n  snapToGrid: boolean;\n  snapTolerance: number;\n\n  // Measurement mode\n  measurementActive: boolean;\n  measurementPoints: Point2D[];\n  measurementUnit: \"m\" | \"mm\" | \"ft\";\n\n  // -------------------------------------------------------------------------\n  // 3D Viewer State\n  // -------------------------------------------------------------------------\n\n  // Floor visibility\n  totalFloors: number;\n  visibleFloors: number[];\n  floorOpacity: Record<number, number>;\n  explodedView: boolean;\n  explodeDistance: number;\n\n  // Section planes\n  clippingPlanes: ClippingPlane[];\n  activeClippingPlaneId: string | null;\n\n  // Camera\n  cameraMode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\";\n  cameraPosition: Point3D;\n  cameraTarget: Point3D;\n\n  // 3D Selection\n  selectedObjectIds: string[];\n  hoveredObjectId: string | null;\n\n  // Render quality\n  renderQuality: \"low\" | \"medium\" | \"high\";\n  showShadows: boolean;\n  showAmbientOcclusion: boolean;\n  antialiasing: boolean;\n\n  // 3D Measurement\n  measurement3DActive: boolean;\n  measurement3DPoints: Point3D[];\n\n  // -------------------------------------------------------------------------\n  // 2D Actions\n  // -------------------------------------------------------------------------\n\n  setActiveTool: (tool: ToolType) => void;\n\n  setLayerVisibility: (layer: CADLayer, visible: boolean) => void;\n  setLayerLocked: (layer: CADLayer, locked: boolean) => void;\n  setLayerOpacity: (layer: CADLayer, opacity: number) => void;\n  toggleLayerVisibility: (layer: CADLayer) => void;\n  showAllLayers: () => void;\n  hideAllLayers: () => void;\n\n  selectElement: (id: string, addToSelection?: boolean) => void;\n  selectElements: (ids: string[]) => void;\n  deselectElement: (id: string) => void;\n  clearSelection: () => void;\n  setHoveredElement: (id: string | null) => void;\n\n  setViewTransform: (transform: Partial<ViewTransform>) => void;\n  resetViewTransform: () => void;\n  zoomIn: () => void;\n  zoomOut: () => void;\n  zoomToFit: () => void;\n  rotateView: (degrees: number) => void;\n\n  setBackgroundColor: (color: \"dark\" | \"light\") => void;\n  toggleGrid: () => void;\n  setGridSize: (size: number) => void;\n  toggleSnapToGrid: () => void;\n\n  startMeasurement: () => void;\n  addMeasurementPoint: (point: Point2D) => void;\n  clearMeasurement: () => void;\n  setMeasurementUnit: (unit: \"m\" | \"mm\" | \"ft\") => void;\n\n  // -------------------------------------------------------------------------\n  // 3D Actions\n  // -------------------------------------------------------------------------\n\n  setTotalFloors: (count: number) => void;\n  toggleFloorVisibility: (floor: number) => void;\n  showFloor: (floor: number) => void;\n  hideFloor: (floor: number) => void;\n  showAllFloors: () => void;\n  hideAllFloors: () => void;\n  isolateFloor: (floor: number) => void;\n  setFloorOpacity: (floor: number, opacity: number) => void;\n  toggleExplodedView: () => void;\n  setExplodeDistance: (distance: number) => void;\n\n  addClippingPlane: (plane: ClippingPlane) => void;\n  removeClippingPlane: (id: string) => void;\n  updateClippingPlane: (id: string, updates: Partial<ClippingPlane>) => void;\n  toggleClippingPlane: (id: string) => void;\n  setActiveClippingPlane: (id: string | null) => void;\n  clearAllClippingPlanes: () => void;\n\n  setCameraMode: (mode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\") => void;\n  setCameraPosition: (position: Point3D) => void;\n  setCameraTarget: (target: Point3D) => void;\n  resetCamera: () => void;\n\n  selectObject: (id: string, addToSelection?: boolean) => void;\n  selectObjects: (ids: string[]) => void;\n  deselectObject: (id: string) => void;\n  clearObjectSelection: () => void;\n  setHoveredObject: (id: string | null) => void;\n\n  setRenderQuality: (quality: \"low\" | \"medium\" | \"high\") => void;\n  toggleShadows: () => void;\n  toggleAmbientOcclusion: () => void;\n  toggleAntialiasing: () => void;\n\n  startMeasurement3D: () => void;\n  addMeasurement3DPoint: (point: Point3D) => void;\n  clearMeasurement3D: () => void;\n}\n\n// =============================================================================\n// Default Values\n// =============================================================================\n\nconst defaultLayers: Record<CADLayer, LayerState> = {\n  architectural: { visible: true, locked: false, opacity: 1 },\n  structural: { visible: true, locked: false, opacity: 1 },\n  \"mep-hvac\": { visible: true, locked: false, opacity: 1 },\n  \"mep-electrical\": { visible: true, locked: false, opacity: 1 },\n  \"mep-plumbing\": { visible: true, locked: false, opacity: 1 },\n  annotations: { visible: true, locked: false, opacity: 1 },\n  grid: { visible: true, locked: true, opacity: 0.5 },\n  dimensions: { visible: true, locked: false, opacity: 1 },\n  furniture: { visible: true, locked: false, opacity: 1 },\n};\n\nconst defaultViewTransform: ViewTransform = {\n  panX: 0,\n  panY: 0,\n  zoom: 1,\n  rotation: 0,\n};\n\nconst defaultCameraPosition: Point3D = { x: 60, y: 40, z: 60 };\nconst defaultCameraTarget: Point3D = { x: 0, y: 0, z: 0 };\n\n// =============================================================================\n// Store Implementation\n// =============================================================================\n\nexport const useViewerStore = create<ViewerState>()(\n  persist(\n    (set) => ({\n      // -----------------------------------------------------------------------\n      // 2D Initial State\n      // -----------------------------------------------------------------------\n      activeTool: \"select\",\n      layers: { ...defaultLayers },\n      selectedElementIds: [],\n      hoveredElementId: null,\n      viewTransform: { ...defaultViewTransform },\n      backgroundColor: \"dark\",\n      showGrid: true,\n      gridSize: 1.2, // 1.2m architectural module\n      snapToGrid: true,\n      snapTolerance: 0.1,\n      measurementActive: false,\n      measurementPoints: [],\n      measurementUnit: \"m\",\n\n      // -----------------------------------------------------------------------\n      // 3D Initial State\n      // -----------------------------------------------------------------------\n      totalFloors: 1,\n      visibleFloors: [0],\n      floorOpacity: { 0: 1 },\n      explodedView: false,\n      explodeDistance: 5,\n      clippingPlanes: [],\n      activeClippingPlaneId: null,\n      cameraMode: \"orbit\",\n      cameraPosition: { ...defaultCameraPosition },\n      cameraTarget: { ...defaultCameraTarget },\n      selectedObjectIds: [],\n      hoveredObjectId: null,\n      renderQuality: \"medium\",\n      showShadows: true,\n      showAmbientOcclusion: false,\n      antialiasing: true,\n      measurement3DActive: false,\n      measurement3DPoints: [],\n\n      // -----------------------------------------------------------------------\n      // 2D Actions\n      // -----------------------------------------------------------------------\n\n      setActiveTool: (tool) => set({ activeTool: tool }),\n\n      setLayerVisibility: (layer, visible) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], visible },\n          },\n        })),\n\n      setLayerLocked: (layer, locked) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], locked },\n          },\n        })),\n\n      setLayerOpacity: (layer, opacity) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], opacity },\n          },\n        })),\n\n      toggleLayerVisibility: (layer) =>\n        set((state) => ({\n          layers: {\n            ...state.layers,\n            [layer]: { ...state.layers[layer], visible: !state.layers[layer].visible },\n          },\n        })),\n\n      showAllLayers: () =>\n        set((state) => {\n          const newLayers = { ...state.layers };\n          Object.keys(newLayers).forEach((key) => {\n            newLayers[key as CADLayer].visible = true;\n          });\n          return { layers: newLayers };\n        }),\n\n      hideAllLayers: () =>\n        set((state) => {\n          const newLayers = { ...state.layers };\n          Object.keys(newLayers).forEach((key) => {\n            newLayers[key as CADLayer].visible = false;\n          });\n          return { layers: newLayers };\n        }),\n\n      selectElement: (id, addToSelection = false) =>\n        set((state) => ({\n          selectedElementIds: addToSelection\n            ? [...state.selectedElementIds, id]\n            : [id],\n        })),\n\n      selectElements: (ids) => set({ selectedElementIds: ids }),\n\n      deselectElement: (id) =>\n        set((state) => ({\n          selectedElementIds: state.selectedElementIds.filter((eid) => eid !== id),\n        })),\n\n      clearSelection: () => set({ selectedElementIds: [], hoveredElementId: null }),\n\n      setHoveredElement: (id) => set({ hoveredElementId: id }),\n\n      setViewTransform: (transform) =>\n        set((state) => ({\n          viewTransform: { ...state.viewTransform, ...transform },\n        })),\n\n      resetViewTransform: () => set({ viewTransform: { ...defaultViewTransform } }),\n\n      zoomIn: () =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            zoom: Math.min(state.viewTransform.zoom * 1.2, 50),\n          },\n        })),\n\n      zoomOut: () =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            zoom: Math.max(state.viewTransform.zoom / 1.2, 0.1),\n          },\n        })),\n\n      zoomToFit: () =>\n        set({\n          viewTransform: { panX: 0, panY: 0, zoom: 1, rotation: 0 },\n        }),\n\n      rotateView: (degrees) =>\n        set((state) => ({\n          viewTransform: {\n            ...state.viewTransform,\n            rotation: (state.viewTransform.rotation + degrees) % 360,\n          },\n        })),\n\n      setBackgroundColor: (color) => set({ backgroundColor: color }),\n\n      toggleGrid: () => set((state) => ({ showGrid: !state.showGrid })),\n\n      setGridSize: (size) => set({ gridSize: size }),\n\n      toggleSnapToGrid: () => set((state) => ({ snapToGrid: !state.snapToGrid })),\n\n      startMeasurement: () =>\n        set({\n          measurementActive: true,\n          measurementPoints: [],\n          activeTool: \"select\",\n        }),\n\n      addMeasurementPoint: (point) =>\n        set((state) => ({\n          measurementPoints: [...state.measurementPoints, point],\n        })),\n\n      clearMeasurement: () =>\n        set({ measurementActive: false, measurementPoints: [] }),\n\n      setMeasurementUnit: (unit) => set({ measurementUnit: unit }),\n\n      // -----------------------------------------------------------------------\n      // 3D Actions\n      // -----------------------------------------------------------------------\n\n      setTotalFloors: (count) => {\n        const floors = Array.from({ length: count }, (_, i) => i);\n        const opacities: Record<number, number> = {};\n        floors.forEach((f) => (opacities[f] = 1));\n        set({ totalFloors: count, visibleFloors: floors, floorOpacity: opacities });\n      },\n\n      toggleFloorVisibility: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.includes(floor)\n            ? state.visibleFloors.filter((f) => f !== floor)\n            : [...state.visibleFloors, floor].sort((a, b) => a - b),\n        })),\n\n      showFloor: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.includes(floor)\n            ? state.visibleFloors\n            : [...state.visibleFloors, floor].sort((a, b) => a - b),\n        })),\n\n      hideFloor: (floor) =>\n        set((state) => ({\n          visibleFloors: state.visibleFloors.filter((f) => f !== floor),\n        })),\n\n      showAllFloors: () =>\n        set((state) => ({\n          visibleFloors: Array.from({ length: state.totalFloors }, (_, i) => i),\n        })),\n\n      hideAllFloors: () => set({ visibleFloors: [] }),\n\n      isolateFloor: (floor) => set({ visibleFloors: [floor] }),\n\n      setFloorOpacity: (floor, opacity) =>\n        set((state) => ({\n          floorOpacity: { ...state.floorOpacity, [floor]: opacity },\n        })),\n\n      toggleExplodedView: () =>\n        set((state) => ({ explodedView: !state.explodedView })),\n\n      setExplodeDistance: (distance) => set({ explodeDistance: distance }),\n\n      addClippingPlane: (plane) =>\n        set((state) => ({\n          clippingPlanes: [...state.clippingPlanes, plane],\n        })),\n\n      removeClippingPlane: (id) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.filter((p) => p.id !== id),\n          activeClippingPlaneId:\n            state.activeClippingPlaneId === id ? null : state.activeClippingPlaneId,\n        })),\n\n      updateClippingPlane: (id, updates) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.map((p) =>\n            p.id === id ? { ...p, ...updates } : p\n          ),\n        })),\n\n      toggleClippingPlane: (id) =>\n        set((state) => ({\n          clippingPlanes: state.clippingPlanes.map((p) =>\n            p.id === id ? { ...p, enabled: !p.enabled } : p\n          ),\n        })),\n\n      setActiveClippingPlane: (id) => set({ activeClippingPlaneId: id }),\n\n      clearAllClippingPlanes: () =>\n        set({ clippingPlanes: [], activeClippingPlaneId: null }),\n\n      setCameraMode: (mode) => set({ cameraMode: mode }),\n\n      setCameraPosition: (position) => set({ cameraPosition: position }),\n\n      setCameraTarget: (target) => set({ cameraTarget: target }),\n\n      resetCamera: () =>\n        set({\n          cameraPosition: { ...defaultCameraPosition },\n          cameraTarget: { ...defaultCameraTarget },\n          cameraMode: \"orbit\",\n        }),\n\n      selectObject: (id, addToSelection = false) =>\n        set((state) => ({\n          selectedObjectIds: addToSelection\n            ? [...state.selectedObjectIds, id]\n            : [id],\n        })),\n\n      selectObjects: (ids) => set({ selectedObjectIds: ids }),\n\n      deselectObject: (id) =>\n        set((state) => ({\n          selectedObjectIds: state.selectedObjectIds.filter((oid) => oid !== id),\n        })),\n\n      clearObjectSelection: () =>\n        set({ selectedObjectIds: [], hoveredObjectId: null }),\n\n      setHoveredObject: (id) => set({ hoveredObjectId: id }),\n\n      setRenderQuality: (quality) => set({ renderQuality: quality }),\n\n      toggleShadows: () => set((state) => ({ showShadows: !state.showShadows })),\n\n      toggleAmbientOcclusion: () =>\n        set((state) => ({ showAmbientOcclusion: !state.showAmbientOcclusion })),\n\n      toggleAntialiasing: () =>\n        set((state) => ({ antialiasing: !state.antialiasing })),\n\n      startMeasurement3D: () =>\n        set({ measurement3DActive: true, measurement3DPoints: [] }),\n\n      addMeasurement3DPoint: (point) =>\n        set((state) => ({\n          measurement3DPoints: [...state.measurement3DPoints, point],\n        })),\n\n      clearMeasurement3D: () =>\n        set({ measurement3DActive: false, measurement3DPoints: [] }),\n    }),\n    {\n      name: \"ai-designer-viewer\",\n      partialize: (state) => ({\n        // Persist user preferences\n        backgroundColor: state.backgroundColor,\n        showGrid: state.showGrid,\n        gridSize: state.gridSize,\n        snapToGrid: state.snapToGrid,\n        measurementUnit: state.measurementUnit,\n        renderQuality: state.renderQuality,\n        showShadows: state.showShadows,\n        antialiasing: state.antialiasing,\n        cameraMode: state.cameraMode,\n      }),\n    }\n  )\n);\n\n// =============================================================================\n// Selector Hooks for Common Operations\n// =============================================================================\n\nexport const useActiveTool = () => useViewerStore((state) => state.activeTool);\nexport const useSelectedElements = () => useViewerStore((state) => state.selectedElementIds);\nexport const useViewTransform = () => useViewerStore((state) => state.viewTransform);\nexport const useLayers = () => useViewerStore((state) => state.layers);\nexport const useBackgroundColor = () => useViewerStore((state) => state.backgroundColor);\n\nexport const useVisibleFloors = () => useViewerStore((state) => state.visibleFloors);\nexport const useClippingPlanes = () => useViewerStore((state) => state.clippingPlanes);\nexport const useCameraMode = () => useViewerStore((state) => state.cameraMode);\nexport const useSelectedObjects = () => useViewerStore((state) => state.selectedObjectIds);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 918, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/ModelViewer3D.tsx"],"sourcesContent":["\"use client\";\n\nimport { Suspense, useRef, useState, useEffect, useCallback, useMemo } from \"react\";\nimport type { RefObject } from \"react\";\nimport { Canvas, useThree, useFrame, invalidate } from \"@react-three/fiber\";\nimport {\n  OrbitControls,\n  Grid,\n  useGLTF,\n  Center,\n  PointerLockControls,\n  Edges,\n  Html,\n  Line,\n} from \"@react-three/drei\";\nimport * as THREE from \"three\";\nimport type {\n  OrbitControls as OrbitControlsImpl,\n  PointerLockControls as PointerLockControlsImpl,\n} from \"three-stdlib\";\nimport { useViewerStore } from \"@/stores/viewer-store\";\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst TARGET_FPS = 60;\nconst RENDER_QUALITY_SETTINGS = {\n  low: { shadowMapSize: 512, antialias: false, pixelRatio: 1 },\n  medium: { shadowMapSize: 1024, antialias: true, pixelRatio: 1.5 },\n  high: { shadowMapSize: 2048, antialias: true, pixelRatio: 2 },\n};\n\n// =============================================================================\n// Types\n// =============================================================================\n\ninterface ModelViewer3DProps {\n  modelUrl: string;\n  className?: string;\n  onLoad?: () => void;\n  onError?: (error: Error) => void;\n}\n\ninterface FloorData {\n  index: number;\n  meshes: THREE.Mesh[];\n  minY: number;\n  maxY: number;\n}\n\n// =============================================================================\n// Helper Components\n// =============================================================================\n\nfunction FrameLimiter() {\n  const lastFrameTime = useRef(0);\n  const frameInterval = 1000 / TARGET_FPS;\n\n  useFrame((state) => {\n    const currentTime = state.clock.elapsedTime * 1000;\n    if (currentTime - lastFrameTime.current >= frameInterval) {\n      lastFrameTime.current = currentTime;\n      invalidate();\n    }\n  });\n\n  return null;\n}\n\n// Loading spinner for 3D view\nfunction LoadingSpinner() {\n  const meshRef = useRef<THREE.Mesh>(null);\n\n  useFrame((state) => {\n    if (meshRef.current) {\n      meshRef.current.rotation.y = state.clock.elapsedTime * 0.5;\n    }\n  });\n\n  return (\n    <mesh ref={meshRef}>\n      <boxGeometry args={[8, 8, 8]} />\n      <meshStandardMaterial color=\"#c7b8a8\" wireframe />\n    </mesh>\n  );\n}\n\n// =============================================================================\n// Clipping Planes Component\n// =============================================================================\n\ninterface ClippingPlanesManagerProps {\n  enabled: boolean;\n}\n\nfunction ClippingPlanesManager({ enabled }: ClippingPlanesManagerProps) {\n  const { gl } = useThree();\n  const { clippingPlanes } = useViewerStore();\n  const rendererRef = useRef<THREE.WebGLRenderer | null>(null);\n\n  useEffect(() => {\n    rendererRef.current = gl;\n  }, [gl]);\n\n  useEffect(() => {\n    const renderer = rendererRef.current;\n    if (!renderer) return;\n\n    if (!enabled || clippingPlanes.length === 0) {\n      renderer.clippingPlanes = [];\n      renderer.localClippingEnabled = false;\n      return;\n    }\n\n    const planes = clippingPlanes\n      .filter((p) => p.enabled)\n      .map((p) => {\n        const normal = new THREE.Vector3(p.normal.x, p.normal.y, p.normal.z);\n        return new THREE.Plane(normal, p.constant);\n      });\n\n    renderer.clippingPlanes = planes;\n    renderer.localClippingEnabled = true;\n\n    return () => {\n      const current = rendererRef.current;\n      if (current) {\n        current.clippingPlanes = [];\n      }\n    };\n  }, [clippingPlanes, enabled]);\n\n  return null;\n}\n\n// =============================================================================\n// Selection Outline Component\n// =============================================================================\n\ninterface SelectionOutlineProps {\n  objects: THREE.Object3D[];\n}\n\nfunction SelectionOutline({ objects }: SelectionOutlineProps) {\n  if (objects.length === 0) return null;\n\n  return (\n    <>\n      {objects.map((obj, idx) => {\n        if (!(obj instanceof THREE.Mesh)) return null;\n        return (\n          <mesh key={idx} geometry={obj.geometry} position={obj.position} rotation={obj.rotation} scale={obj.scale}>\n            <meshBasicMaterial color=\"#00aaff\" transparent opacity={0.3} side={THREE.DoubleSide} />\n            <Edges threshold={15} color=\"#00aaff\" lineWidth={2} />\n          </mesh>\n        );\n      })}\n    </>\n  );\n}\n\n// =============================================================================\n// 3D Measurement Component\n// =============================================================================\n\ninterface MeasurementLine3DProps {\n  points: THREE.Vector3[];\n  unit: string;\n}\n\nfunction MeasurementLine3D({ points, unit }: MeasurementLine3DProps) {\n  if (points.length < 2) return null;\n\n  const linePoints = points.map((p) => [p.x, p.y, p.z] as [number, number, number]);\n\n  // Calculate total distance\n  let totalDistance = 0;\n  for (let i = 0; i < points.length - 1; i++) {\n    totalDistance += points[i].distanceTo(points[i + 1]);\n  }\n\n  const midpoint = points.length >= 2\n    ? new THREE.Vector3().lerpVectors(points[0], points[points.length - 1], 0.5)\n    : points[0];\n\n  const formatDistance = (d: number): string => {\n    switch (unit) {\n      case \"mm\":\n        return `${(d * 1000).toFixed(0)} mm`;\n      case \"ft\":\n        return `${(d * 3.28084).toFixed(2)} ft`;\n      default:\n        return `${d.toFixed(2)} m`;\n    }\n  };\n\n  return (\n    <group>\n      <Line points={linePoints} color=\"#ffaa00\" lineWidth={3} />\n      {/* Measurement points */}\n      {points.map((p, i) => (\n        <mesh key={i} position={p}>\n          <sphereGeometry args={[0.2, 16, 16]} />\n          <meshBasicMaterial color=\"#ffaa00\" />\n        </mesh>\n      ))}\n      {/* Distance label */}\n      <Html position={[midpoint.x, midpoint.y + 1, midpoint.z]} center>\n        <div className=\"bg-amber-500 text-white px-2 py-1 rounded text-sm font-mono shadow-lg whitespace-nowrap\">\n          {formatDistance(totalDistance)}\n        </div>\n      </Html>\n    </group>\n  );\n}\n\n// =============================================================================\n// First Person Controls Component\n// =============================================================================\n\ninterface FirstPersonModeProps {\n  enabled: boolean;\n  speed?: number;\n}\n\nfunction FirstPersonMode({ enabled, speed = 0.5 }: FirstPersonModeProps) {\n  const { camera } = useThree();\n  const controlsRef = useRef<PointerLockControlsImpl | null>(null);\n  const moveState = useRef({\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    up: false,\n    down: false,\n  });\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      switch (e.code) {\n        case \"KeyW\":\n        case \"ArrowUp\":\n          moveState.current.forward = true;\n          break;\n        case \"KeyS\":\n        case \"ArrowDown\":\n          moveState.current.backward = true;\n          break;\n        case \"KeyA\":\n        case \"ArrowLeft\":\n          moveState.current.left = true;\n          break;\n        case \"KeyD\":\n        case \"ArrowRight\":\n          moveState.current.right = true;\n          break;\n        case \"Space\":\n          moveState.current.up = true;\n          break;\n        case \"ShiftLeft\":\n        case \"ShiftRight\":\n          moveState.current.down = true;\n          break;\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      switch (e.code) {\n        case \"KeyW\":\n        case \"ArrowUp\":\n          moveState.current.forward = false;\n          break;\n        case \"KeyS\":\n        case \"ArrowDown\":\n          moveState.current.backward = false;\n          break;\n        case \"KeyA\":\n        case \"ArrowLeft\":\n          moveState.current.left = false;\n          break;\n        case \"KeyD\":\n        case \"ArrowRight\":\n          moveState.current.right = false;\n          break;\n        case \"Space\":\n          moveState.current.up = false;\n          break;\n        case \"ShiftLeft\":\n        case \"ShiftRight\":\n          moveState.current.down = false;\n          break;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"keyup\", handleKeyUp);\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"keyup\", handleKeyUp);\n      moveState.current = {\n        forward: false,\n        backward: false,\n        left: false,\n        right: false,\n        up: false,\n        down: false,\n      };\n    };\n  }, [enabled]);\n\n  useFrame((_, delta) => {\n    if (!enabled) return;\n\n    const direction = new THREE.Vector3();\n    const frontVector = new THREE.Vector3(0, 0, Number(moveState.current.backward) - Number(moveState.current.forward));\n    const sideVector = new THREE.Vector3(Number(moveState.current.left) - Number(moveState.current.right), 0, 0);\n    const upVector = new THREE.Vector3(0, Number(moveState.current.up) - Number(moveState.current.down), 0);\n\n    direction\n      .subVectors(frontVector, sideVector)\n      .normalize()\n      .multiplyScalar(speed * delta * 60)\n      .applyEuler(camera.rotation);\n\n    direction.add(upVector.multiplyScalar(speed * delta * 60));\n\n    camera.position.add(direction);\n  });\n\n  if (!enabled) return null;\n\n  return <PointerLockControls ref={controlsRef} />;\n}\n\n// =============================================================================\n// Scene Content Component\n// =============================================================================\n\ninterface SceneContentProps {\n  modelUrl: string;\n  onLoad?: () => void;\n  onError?: (error: Error) => void;\n}\n\nfunction SceneContent({ modelUrl, onLoad, onError }: SceneContentProps) {\n  const { scene: gltfScene } = useGLTF(modelUrl, true, true, (loader) => {\n    loader.manager.onLoad = () => onLoad?.();\n    loader.manager.onError = (url) => onError?.(new Error(`Failed to load: ${url}`));\n  });\n\n  const { raycaster, pointer, camera } = useThree();\n\n  const {\n    visibleFloors,\n    setTotalFloors,\n    explodedView,\n    explodeDistance,\n    selectedObjectIds,\n    selectObject,\n    setHoveredObject,\n    clearObjectSelection,\n    measurement3DActive,\n    measurement3DPoints,\n    addMeasurement3DPoint,\n    measurementUnit,\n  } = useViewerStore();\n\n  const floorDataRef = useRef<FloorData[]>([]);\n  const visibleFloorsRef = useRef(visibleFloors);\n  const explodedViewRef = useRef(explodedView);\n  const explodeDistanceRef = useRef(explodeDistance);\n\n  useEffect(() => {\n    visibleFloorsRef.current = visibleFloors;\n    explodedViewRef.current = explodedView;\n    explodeDistanceRef.current = explodeDistance;\n  }, [visibleFloors, explodedView, explodeDistance]);\n\n  const applyFloorVisibility = useCallback(() => {\n    const floorData = floorDataRef.current;\n    if (!floorData.length) return;\n    const activeFloors = visibleFloorsRef.current;\n    const isExploded = explodedViewRef.current;\n    const explodeDistanceValue = explodeDistanceRef.current;\n\n    floorData.forEach((floor) => {\n      const isVisible = activeFloors.includes(floor.index);\n      floor.meshes.forEach((mesh) => {\n        mesh.visible = isVisible;\n\n        if (isExploded && isVisible) {\n          mesh.position.y = mesh.userData.originalY ?? mesh.position.y;\n          if (mesh.userData.originalY === undefined) {\n            mesh.userData.originalY = mesh.position.y;\n          }\n          mesh.position.y += floor.index * explodeDistanceValue;\n        } else if (mesh.userData.originalY !== undefined) {\n          mesh.position.y = mesh.userData.originalY;\n        }\n      });\n    });\n  }, []);\n\n  // Analyze model and detect floors\n  useEffect(() => {\n    if (!gltfScene) return;\n\n    // Center and scale the model\n    const box = new THREE.Box3().setFromObject(gltfScene);\n    const center = box.getCenter(new THREE.Vector3());\n    const size = box.getSize(new THREE.Vector3());\n\n    gltfScene.position.sub(center);\n\n    const maxDim = Math.max(size.x, size.y, size.z);\n    if (maxDim > 50) {\n      const scale = 50 / maxDim;\n      gltfScene.scale.setScalar(scale);\n    }\n\n    // Detect floors based on Y position\n    const meshes: THREE.Mesh[] = [];\n    gltfScene.traverse((child) => {\n      if (child instanceof THREE.Mesh) {\n        meshes.push(child);\n        // Enable clipping for each mesh\n        if (child.material instanceof THREE.Material) {\n          child.material.clippingPlanes = [];\n          child.material.clipShadows = true;\n        }\n        // Assign unique userData for selection\n        child.userData.selectableId = child.uuid;\n      }\n    });\n\n    if (meshes.length === 0) return;\n\n    // Calculate bounding boxes for floor detection\n    const yPositions = meshes.map((m) => {\n      const meshBox = new THREE.Box3().setFromObject(m);\n      return { mesh: m, minY: meshBox.min.y, maxY: meshBox.max.y };\n    });\n\n    // Sort by Y position and group into floors\n    yPositions.sort((a, b) => a.minY - b.minY);\n\n    // Simple floor detection: divide height into equal sections\n    const totalHeight = Math.max(...yPositions.map((p) => p.maxY)) - Math.min(...yPositions.map((p) => p.minY));\n    const estimatedFloorHeight = 3; // meters (scaled)\n    const estimatedFloors = Math.max(1, Math.round(totalHeight / estimatedFloorHeight));\n\n    const detectedFloors: FloorData[] = [];\n    const floorHeight = totalHeight / estimatedFloors;\n    const baseY = Math.min(...yPositions.map((p) => p.minY));\n\n    for (let i = 0; i < estimatedFloors; i++) {\n      const floorMinY = baseY + i * floorHeight;\n      const floorMaxY = baseY + (i + 1) * floorHeight;\n      const floorMeshes = meshes.filter((m) => {\n        const meshBox = new THREE.Box3().setFromObject(m);\n        const meshCenterY = (meshBox.min.y + meshBox.max.y) / 2;\n        return meshCenterY >= floorMinY && meshCenterY < floorMaxY;\n      });\n\n      if (floorMeshes.length > 0) {\n        detectedFloors.push({\n          index: i,\n          meshes: floorMeshes,\n          minY: floorMinY,\n          maxY: floorMaxY,\n        });\n      }\n    }\n\n    floorDataRef.current = detectedFloors;\n    setTotalFloors(detectedFloors.length || 1);\n    applyFloorVisibility();\n  }, [gltfScene, setTotalFloors, applyFloorVisibility]);\n\n  useEffect(() => {\n    applyFloorVisibility();\n  }, [applyFloorVisibility, visibleFloors, explodedView, explodeDistance]);\n\n  const selectedMeshes = useMemo(() => {\n    if (!gltfScene) return [];\n    const selected: THREE.Mesh[] = [];\n    gltfScene.traverse((child) => {\n      if (child instanceof THREE.Mesh && selectedObjectIds.includes(child.userData.selectableId)) {\n        selected.push(child);\n      }\n    });\n    return selected;\n  }, [gltfScene, selectedObjectIds]);\n\n  // Click handler for selection and measurement\n  const handleClick = useCallback(\n    (event: { stopPropagation: () => void; shiftKey?: boolean }) => {\n      raycaster.setFromCamera(pointer, camera);\n      const intersects = raycaster.intersectObjects(gltfScene.children, true);\n\n      if (intersects.length > 0) {\n        const hit = intersects[0];\n\n        if (measurement3DActive) {\n          // Add measurement point\n          addMeasurement3DPoint({\n            x: hit.point.x,\n            y: hit.point.y,\n            z: hit.point.z,\n          });\n        } else {\n          // Object selection\n          const mesh = hit.object as THREE.Mesh;\n          if (mesh.userData.selectableId) {\n            selectObject(mesh.userData.selectableId, event.shiftKey ?? false);\n          }\n        }\n      } else if (!measurement3DActive) {\n        clearObjectSelection();\n      }\n    },\n    [raycaster, pointer, camera, gltfScene, measurement3DActive, addMeasurement3DPoint, selectObject, clearObjectSelection]\n  );\n\n  // Pointer move for hover effect\n  const handlePointerMove = useCallback(() => {\n    raycaster.setFromCamera(pointer, camera);\n    const intersects = raycaster.intersectObjects(gltfScene.children, true);\n\n    if (intersects.length > 0) {\n      const mesh = intersects[0].object as THREE.Mesh;\n      if (mesh.userData.selectableId) {\n        setHoveredObject(mesh.userData.selectableId);\n      }\n    } else {\n      setHoveredObject(null);\n    }\n  }, [raycaster, pointer, camera, gltfScene, setHoveredObject]);\n\n  // Measurement points as THREE.Vector3\n  const measurementVector3Points = useMemo(() => {\n    return measurement3DPoints.map((p) => new THREE.Vector3(p.x, p.y, p.z));\n  }, [measurement3DPoints]);\n\n  return (\n    <group onClick={handleClick} onPointerMove={handlePointerMove}>\n      <Center>\n        <primitive object={gltfScene} />\n      </Center>\n      <SelectionOutline objects={selectedMeshes} />\n      {measurement3DActive && measurement3DPoints.length > 0 && (\n        <MeasurementLine3D points={measurementVector3Points} unit={measurementUnit} />\n      )}\n    </group>\n  );\n}\n\n// =============================================================================\n// Orbit Controls Wrapper\n// =============================================================================\n\ninterface ControlsWrapperProps {\n  cameraMode: \"orbit\" | \"firstPerson\" | \"plan\" | \"elevation\";\n  controlsRef: RefObject<OrbitControlsImpl | null>;\n}\n\nfunction ControlsWrapper({ cameraMode, controlsRef }: ControlsWrapperProps) {\n  const { camera } = useThree();\n  const { cameraPosition, cameraTarget, setCameraPosition, setCameraTarget } = useViewerStore();\n\n  // Apply camera position from store\n  useEffect(() => {\n    const target = new THREE.Vector3(cameraTarget.x, cameraTarget.y, cameraTarget.z);\n    const distance = Math.max(camera.position.distanceTo(target), 10);\n\n    if (cameraMode === \"firstPerson\") {\n      camera.up.set(0, 1, 0);\n      return;\n    }\n\n    if (cameraMode === \"orbit\") {\n      camera.up.set(0, 1, 0);\n      camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);\n    } else if (cameraMode === \"plan\") {\n      camera.up.set(0, 0, -1);\n      camera.position.set(target.x, target.y + distance, target.z);\n    } else if (cameraMode === \"elevation\") {\n      camera.up.set(0, 1, 0);\n      camera.position.set(target.x, target.y + distance * 0.2, target.z + distance);\n    }\n\n    if (controlsRef.current) {\n      controlsRef.current.target.set(target.x, target.y, target.z);\n      controlsRef.current.update();\n    }\n\n    camera.lookAt(target);\n    camera.updateProjectionMatrix();\n  }, [camera, cameraMode, cameraPosition, cameraTarget, controlsRef]);\n\n  if (cameraMode === \"firstPerson\") return null;\n\n  const lockRotation = cameraMode === \"plan\" || cameraMode === \"elevation\";\n\n  return (\n    <OrbitControls\n      ref={controlsRef}\n      enableDamping\n      dampingFactor={0.05}\n      minDistance={5}\n      maxDistance={500}\n      enableRotate={!lockRotation}\n      minPolarAngle={cameraMode === \"plan\" ? Math.PI / 2 : 0}\n      maxPolarAngle={cameraMode === \"plan\" ? Math.PI / 2 : Math.PI * 0.9}\n      target={[cameraTarget.x, cameraTarget.y, cameraTarget.z]}\n      onChange={() => {\n        if (cameraMode !== \"orbit\") return;\n        if (!controlsRef.current) return;\n        const pos = camera.position;\n        const target = controlsRef.current.target;\n        setCameraPosition({ x: pos.x, y: pos.y, z: pos.z });\n        setCameraTarget({ x: target.x, y: target.y, z: target.z });\n      }}\n    />\n  );\n}\n\n// =============================================================================\n// Main ModelViewer3D Component\n// =============================================================================\n\nexport function ModelViewer3D({ modelUrl, className = \"\", onLoad, onError }: ModelViewer3DProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  const controlsRef = useRef<OrbitControlsImpl | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const {\n    cameraMode,\n    renderQuality,\n    showShadows,\n    clippingPlanes,\n    measurement3DActive,\n    setCameraMode,\n  } = useViewerStore();\n\n  const qualitySettings = RENDER_QUALITY_SETTINGS[renderQuality];\n\n  const handleLoad = useCallback(() => {\n    setLoading(false);\n    setError(null);\n    onLoad?.();\n  }, [onLoad]);\n\n  const handleError = useCallback(\n    (err: Error) => {\n      setLoading(false);\n      setError(err.message);\n      onError?.(err);\n    },\n    [onError]\n  );\n\n  // Pause rendering when tab is not visible\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      setIsVisible(!document.hidden);\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n  }, []);\n\n  // Handle escape key for first person mode\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\" && cameraMode === \"firstPerson\") {\n        setCameraMode(\"orbit\");\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [cameraMode, setCameraMode]);\n\n  if (!modelUrl) {\n    return (\n      <div className={`flex items-center justify-center h-full bg-gradient-to-b from-slate-900 to-slate-800 ${className}`}>\n        <div className=\"text-center text-slate-400\">\n          <div className=\"w-16 h-16 mx-auto mb-4 opacity-30 border-2 border-dashed border-slate-500 rounded-lg flex items-center justify-center\">\n            <span className=\"text-2xl\">3D</span>\n          </div>\n          <p className=\"text-lg font-medium\">No model available</p>\n          <p className=\"text-sm mt-2\">Generate a project to view the 3D model</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative w-full h-full ${className}`}>\n      <Canvas\n        ref={canvasRef}\n        camera={{ position: [60, 40, 60], fov: 50 }}\n        style={{ background: \"linear-gradient(to bottom, #1a1a2e, #16213e)\" }}\n        frameloop={isVisible ? \"always\" : \"never\"}\n        dpr={[1, qualitySettings.pixelRatio]}\n        shadows={showShadows}\n        gl={{\n          antialias: qualitySettings.antialias,\n          alpha: false,\n          powerPreference: \"high-performance\",\n          stencil: false,\n          depth: true,\n          localClippingEnabled: true,\n        }}\n        performance={{ min: 0.5 }}\n      >\n        <FrameLimiter />\n        <ClippingPlanesManager enabled={clippingPlanes.length > 0} />\n\n        {/* Lighting */}\n        <ambientLight intensity={0.5} />\n        <directionalLight\n          position={[50, 100, 50]}\n          intensity={1}\n          castShadow={showShadows}\n          shadow-mapSize={[qualitySettings.shadowMapSize, qualitySettings.shadowMapSize]}\n          shadow-camera-far={200}\n          shadow-camera-left={-50}\n          shadow-camera-right={50}\n          shadow-camera-top={50}\n          shadow-camera-bottom={-50}\n        />\n        <directionalLight position={[-30, 50, -30]} intensity={0.4} />\n        <hemisphereLight intensity={0.3} groundColor=\"#1a1a2e\" />\n\n        {/* Model */}\n        <Suspense fallback={<LoadingSpinner />}>\n          <SceneContent modelUrl={modelUrl} onLoad={handleLoad} onError={handleError} />\n        </Suspense>\n\n        {/* Ground Grid */}\n        <Grid\n          args={[200, 200]}\n          position={[0, -0.1, 0]}\n          cellSize={5}\n          cellThickness={0.5}\n          cellColor=\"#334155\"\n          sectionSize={25}\n          sectionThickness={1}\n          sectionColor=\"#475569\"\n          fadeDistance={150}\n          fadeStrength={1.5}\n          followCamera={false}\n        />\n\n        {/* Controls */}\n        <ControlsWrapper cameraMode={cameraMode} controlsRef={controlsRef} />\n        <FirstPersonMode enabled={cameraMode === \"firstPerson\"} speed={0.3} />\n      </Canvas>\n\n      {/* Loading Overlay */}\n      {loading && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm\">\n          <div className=\"text-center\">\n            <div className=\"w-10 h-10 mx-auto mb-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n            <p className=\"text-sm text-slate-300\">Loading 3D model...</p>\n          </div>\n        </div>\n      )}\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"absolute top-4 left-4 right-4 bg-red-900/80 border border-red-500 rounded-lg p-3\">\n          <p className=\"text-sm text-red-200\">{error}</p>\n        </div>\n      )}\n\n      {/* First Person Mode Instructions */}\n      {cameraMode === \"firstPerson\" && (\n        <div className=\"absolute top-4 left-1/2 -translate-x-1/2 bg-slate-800/90 backdrop-blur rounded-lg px-4 py-2 text-sm text-slate-200\">\n          <span className=\"font-medium\">Walkthrough Mode:</span> WASD to move, Mouse to look, Space/Shift for up/down, ESC to exit\n        </div>\n      )}\n\n      {/* Measurement Mode Indicator */}\n      {measurement3DActive && (\n        <div className=\"absolute top-4 left-4 bg-amber-500/90 backdrop-blur rounded-lg px-3 py-2 text-sm text-white font-medium\">\n          Measurement Mode: Click points to measure distance\n        </div>\n      )}\n\n      {/* Model Info */}\n      <div className=\"absolute top-4 right-4 bg-slate-800/80 backdrop-blur rounded px-3 py-1.5 shadow border border-slate-600\">\n        <span className=\"text-xs text-slate-300 font-mono\">glTF 2.0</span>\n      </div>\n    </div>\n  );\n}\n\nexport default ModelViewer3D;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1940, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/FloorManager.tsx"],"sourcesContent":["\"use client\";\n\nimport { useViewerStore } from \"@/stores/viewer-store\";\nimport { Eye, EyeOff, Layers, SplitSquareVertical } from \"lucide-react\";\n\ninterface FloorManagerProps {\n  className?: string;\n  isRtl?: boolean;\n}\n\nexport function FloorManager({ className = \"\", isRtl = false }: FloorManagerProps) {\n  const {\n    totalFloors,\n    visibleFloors,\n    explodedView,\n    explodeDistance,\n    toggleFloorVisibility,\n    showAllFloors,\n    hideAllFloors,\n    isolateFloor,\n    toggleExplodedView,\n    setExplodeDistance,\n  } = useViewerStore();\n\n  if (totalFloors <= 1) {\n    return (\n      <div className={`bg-slate-800/90 backdrop-blur rounded-lg p-2 ${className}`}>\n        <div className=\"text-xs text-slate-400 text-center px-2\">\n          {isRtl ? \" \" : \"Single floor\"}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`bg-slate-800/90 backdrop-blur rounded-lg p-2 shadow-xl border border-slate-700 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-2 px-1\">\n        <div className=\"flex items-center gap-1.5\">\n          <Layers className=\"w-4 h-4 text-slate-400\" />\n          <span className=\"text-xs font-medium text-slate-300\">\n            {isRtl ? \"\" : \"Floors\"}\n          </span>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={showAllFloors}\n            className=\"p-1 rounded hover:bg-slate-700 text-slate-400 hover:text-slate-200 transition-colors\"\n            title={isRtl ? \" \" : \"Show all\"}\n          >\n            <Eye className=\"w-3.5 h-3.5\" />\n          </button>\n          <button\n            onClick={hideAllFloors}\n            className=\"p-1 rounded hover:bg-slate-700 text-slate-400 hover:text-slate-200 transition-colors\"\n            title={isRtl ? \" \" : \"Hide all\"}\n          >\n            <EyeOff className=\"w-3.5 h-3.5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Floor Buttons */}\n      <div className=\"space-y-1\">\n        {Array.from({ length: totalFloors }, (_, i) => {\n          const floorNum = totalFloors - 1 - i; // Display from top to bottom\n          const isVisible = visibleFloors.includes(floorNum);\n          const isIsolated = visibleFloors.length === 1 && visibleFloors[0] === floorNum;\n\n          return (\n            <div\n              key={floorNum}\n              className={`flex items-center gap-2 px-2 py-1.5 rounded transition-colors ${\n                isVisible ? \"bg-slate-700/50\" : \"bg-transparent\"\n              }`}\n            >\n              {/* Visibility toggle */}\n              <button\n                onClick={() => toggleFloorVisibility(floorNum)}\n                className={`w-6 h-6 rounded flex items-center justify-center transition-colors ${\n                  isVisible\n                    ? \"bg-blue-600 text-white hover:bg-blue-500\"\n                    : \"bg-slate-700 text-slate-400 hover:bg-slate-600\"\n                }`}\n              >\n                {isVisible ? (\n                  <Eye className=\"w-3.5 h-3.5\" />\n                ) : (\n                  <EyeOff className=\"w-3.5 h-3.5\" />\n                )}\n              </button>\n\n              {/* Floor number */}\n              <span\n                className={`flex-1 text-sm font-medium ${\n                  isVisible ? \"text-slate-200\" : \"text-slate-500\"\n                }`}\n              >\n                {isRtl ? ` ${floorNum + 1}` : `Floor ${floorNum + 1}`}\n              </span>\n\n              {/* Isolate button */}\n              <button\n                onClick={() => isolateFloor(floorNum)}\n                className={`px-1.5 py-0.5 text-xs rounded transition-colors ${\n                  isIsolated\n                    ? \"bg-blue-600 text-white\"\n                    : \"text-slate-400 hover:text-slate-200 hover:bg-slate-700\"\n                }`}\n                title={isRtl ? \"\" : \"Solo\"}\n              >\n                S\n              </button>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Exploded View */}\n      <div className=\"mt-3 pt-2 border-t border-slate-700\">\n        <button\n          onClick={toggleExplodedView}\n          className={`w-full flex items-center justify-between px-2 py-1.5 rounded transition-colors ${\n            explodedView ? \"bg-blue-600/30 text-blue-300\" : \"hover:bg-slate-700 text-slate-400\"\n          }`}\n        >\n          <div className=\"flex items-center gap-2\">\n            <SplitSquareVertical className=\"w-4 h-4\" />\n            <span className=\"text-xs font-medium\">\n              {isRtl ? \" \" : \"Exploded View\"}\n            </span>\n          </div>\n          <div\n            className={`w-8 h-4 rounded-full transition-colors ${\n              explodedView ? \"bg-blue-600\" : \"bg-slate-600\"\n            }`}\n          >\n            <div\n              className={`w-3 h-3 rounded-full bg-white mt-0.5 transition-transform ${\n                explodedView ? \"translate-x-4.5 ml-0.5\" : \"translate-x-0.5\"\n              }`}\n            />\n          </div>\n        </button>\n\n        {/* Explode distance slider */}\n        {explodedView && (\n          <div className=\"mt-2 px-2\">\n            <div className=\"flex items-center justify-between text-xs text-slate-400 mb-1\">\n              <span>{isRtl ? \"\" : \"Distance\"}</span>\n              <span>{explodeDistance.toFixed(1)}m</span>\n            </div>\n            <input\n              type=\"range\"\n              min=\"1\"\n              max=\"15\"\n              step=\"0.5\"\n              value={explodeDistance}\n              onChange={(e) => setExplodeDistance(parseFloat(e.target.value))}\n              className=\"w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default FloorManager;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2231, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/SectionPlanePanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useState } from \"react\";\nimport { useViewerStore } from \"@/stores/viewer-store\";\nimport { Scissors, Plus, Trash2, Eye, EyeOff, RotateCcw } from \"lucide-react\";\nimport type { ClippingPlane } from \"@/types/cad\";\n\ninterface SectionPlanePanelProps {\n  className?: string;\n  isRtl?: boolean;\n}\n\nconst PRESET_PLANES = [\n  { name: \"Top\", normal: { x: 0, y: -1, z: 0 }, nameAr: \"\" },\n  { name: \"Bottom\", normal: { x: 0, y: 1, z: 0 }, nameAr: \"\" },\n  { name: \"Front\", normal: { x: 0, y: 0, z: -1 }, nameAr: \"\" },\n  { name: \"Back\", normal: { x: 0, y: 0, z: 1 }, nameAr: \"\" },\n  { name: \"Left\", normal: { x: 1, y: 0, z: 0 }, nameAr: \"\" },\n  { name: \"Right\", normal: { x: -1, y: 0, z: 0 }, nameAr: \"\" },\n];\n\nexport function SectionPlanePanel({ className = \"\", isRtl = false }: SectionPlanePanelProps) {\n  const {\n    clippingPlanes,\n    activeClippingPlaneId,\n    addClippingPlane,\n    removeClippingPlane,\n    toggleClippingPlane,\n    setActiveClippingPlane,\n    updateClippingPlane,\n    clearAllClippingPlanes,\n  } = useViewerStore();\n\n  const [showPresets, setShowPresets] = useState(false);\n  const planeIdRef = useRef(0);\n\n  const handleAddPreset = (preset: (typeof PRESET_PLANES)[0]) => {\n    planeIdRef.current += 1;\n    const id = `plane-${planeIdRef.current}`;\n    const newPlane: ClippingPlane = {\n      id,\n      name: isRtl ? preset.nameAr : preset.name,\n      normal: preset.normal,\n      constant: 0,\n      enabled: true,\n    };\n    addClippingPlane(newPlane);\n    setActiveClippingPlane(id);\n    setShowPresets(false);\n  };\n\n  const handleDistanceChange = (id: string, constant: number) => {\n    updateClippingPlane(id, { constant });\n  };\n\n  return (\n    <div className={`bg-slate-800/90 backdrop-blur rounded-lg p-2 shadow-xl border border-slate-700 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-2 px-1\">\n        <div className=\"flex items-center gap-1.5\">\n          <Scissors className=\"w-4 h-4 text-slate-400\" />\n          <span className=\"text-xs font-medium text-slate-300\">\n            {isRtl ? \" \" : \"Section Cuts\"}\n          </span>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={() => setShowPresets(!showPresets)}\n            className=\"p-1 rounded hover:bg-slate-700 text-slate-400 hover:text-green-400 transition-colors\"\n            title={isRtl ? \" \" : \"Add section\"}\n          >\n            <Plus className=\"w-3.5 h-3.5\" />\n          </button>\n          {clippingPlanes.length > 0 && (\n            <button\n              onClick={clearAllClippingPlanes}\n              className=\"p-1 rounded hover:bg-slate-700 text-slate-400 hover:text-red-400 transition-colors\"\n              title={isRtl ? \" \" : \"Clear all\"}\n            >\n              <Trash2 className=\"w-3.5 h-3.5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Preset Selector */}\n      {showPresets && (\n        <div className=\"mb-2 grid grid-cols-3 gap-1\">\n          {PRESET_PLANES.map((preset) => (\n            <button\n              key={preset.name}\n              onClick={() => handleAddPreset(preset)}\n              className=\"px-2 py-1.5 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors\"\n            >\n              {isRtl ? preset.nameAr : preset.name}\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Active Planes */}\n      {clippingPlanes.length === 0 ? (\n        <div className=\"text-xs text-slate-500 text-center py-3\">\n          {isRtl ? \"  \" : \"No section planes\"}\n        </div>\n      ) : (\n        <div className=\"space-y-2\">\n          {clippingPlanes.map((plane) => {\n            const isActive = activeClippingPlaneId === plane.id;\n\n            return (\n              <div\n                key={plane.id}\n                className={`rounded p-2 transition-colors ${\n                  isActive ? \"bg-slate-700/70 ring-1 ring-blue-500\" : \"bg-slate-700/30\"\n                }`}\n              >\n                <div className=\"flex items-center justify-between mb-1.5\">\n                  {/* Plane name */}\n                  <button\n                    onClick={() => setActiveClippingPlane(isActive ? null : plane.id)}\n                    className={`text-xs font-medium transition-colors ${\n                      plane.enabled ? \"text-slate-200\" : \"text-slate-500\"\n                    }`}\n                  >\n                    {plane.name}\n                  </button>\n\n                  <div className=\"flex items-center gap-1\">\n                    {/* Toggle visibility */}\n                    <button\n                      onClick={() => toggleClippingPlane(plane.id)}\n                      className={`p-1 rounded transition-colors ${\n                        plane.enabled\n                          ? \"text-blue-400 hover:bg-slate-600\"\n                          : \"text-slate-500 hover:bg-slate-600\"\n                      }`}\n                      title={plane.enabled ? (isRtl ? \"\" : \"Hide\") : (isRtl ? \"\" : \"Show\")}\n                    >\n                      {plane.enabled ? (\n                        <Eye className=\"w-3.5 h-3.5\" />\n                      ) : (\n                        <EyeOff className=\"w-3.5 h-3.5\" />\n                      )}\n                    </button>\n\n                    {/* Remove plane */}\n                    <button\n                      onClick={() => removeClippingPlane(plane.id)}\n                      className=\"p-1 rounded text-slate-500 hover:text-red-400 hover:bg-slate-600 transition-colors\"\n                      title={isRtl ? \"\" : \"Remove\"}\n                    >\n                      <Trash2 className=\"w-3.5 h-3.5\" />\n                    </button>\n                  </div>\n                </div>\n\n                {/* Distance slider */}\n                <div className=\"flex items-center gap-2\">\n                  <input\n                    type=\"range\"\n                    min=\"-50\"\n                    max=\"50\"\n                    step=\"0.5\"\n                    value={plane.constant}\n                    onChange={(e) => handleDistanceChange(plane.id, parseFloat(e.target.value))}\n                    className=\"flex-1 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer\"\n                    disabled={!plane.enabled}\n                  />\n                  <span className=\"text-xs text-slate-400 w-10 text-right font-mono\">\n                    {plane.constant.toFixed(1)}\n                  </span>\n                  <button\n                    onClick={() => handleDistanceChange(plane.id, 0)}\n                    className=\"p-0.5 rounded text-slate-500 hover:text-slate-300 hover:bg-slate-600 transition-colors\"\n                    title={isRtl ? \" \" : \"Reset\"}\n                  >\n                    <RotateCcw className=\"w-3 h-3\" />\n                  </button>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default SectionPlanePanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2573, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/Viewer3DControls.tsx"],"sourcesContent":["\"use client\";\n\nimport { useViewerStore } from \"@/stores/viewer-store\";\nimport {\n  RotateCcw,\n  Ruler,\n  Sun,\n  Moon,\n  Move3D,\n  User,\n  Target,\n  Maximize2,\n} from \"lucide-react\";\n\ninterface Viewer3DControlsProps {\n  onFullscreen?: () => void;\n  className?: string;\n  isRtl?: boolean;\n}\n\nexport function Viewer3DControls({ onFullscreen, className = \"\", isRtl = false }: Viewer3DControlsProps) {\n  const {\n    cameraMode,\n    renderQuality,\n    showShadows,\n    measurement3DActive,\n    setCameraMode,\n    resetCamera,\n    setRenderQuality,\n    toggleShadows,\n    startMeasurement3D,\n    clearMeasurement3D,\n  } = useViewerStore();\n\n  const handleMeasureToggle = () => {\n    if (measurement3DActive) {\n      clearMeasurement3D();\n    } else {\n      startMeasurement3D();\n    }\n  };\n\n  return (\n    <div className={`flex items-center gap-1 bg-slate-800/90 backdrop-blur rounded-full px-3 py-1.5 shadow-lg border border-slate-700 ${className}`}>\n      {/* Camera Mode Toggle */}\n      <div className=\"flex items-center border-r border-slate-600 pr-2 mr-1\">\n        <button\n          onClick={() => setCameraMode(\"orbit\")}\n          className={`p-1.5 rounded-full transition-colors ${\n            cameraMode === \"orbit\"\n              ? \"bg-blue-600 text-white\"\n              : \"text-slate-400 hover:bg-slate-700 hover:text-slate-200\"\n          }`}\n          title={isRtl ? \" \" : \"Orbit Mode\"}\n        >\n          <Move3D className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => setCameraMode(\"firstPerson\")}\n          className={`p-1.5 rounded-full transition-colors ${\n            cameraMode === \"firstPerson\"\n              ? \"bg-blue-600 text-white\"\n              : \"text-slate-400 hover:bg-slate-700 hover:text-slate-200\"\n          }`}\n          title={isRtl ? \" \" : \"Walk Mode\"}\n        >\n          <User className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => setCameraMode(\"plan\")}\n          className={`p-1.5 rounded-full transition-colors ${\n            cameraMode === \"plan\"\n              ? \"bg-blue-600 text-white\"\n              : \"text-slate-400 hover:bg-slate-700 hover:text-slate-200\"\n          }`}\n          title={isRtl ? \" \" : \"Plan View\"}\n        >\n          <Target className=\"w-4 h-4\" />\n        </button>\n      </div>\n\n      {/* Reset Camera */}\n      <button\n        onClick={resetCamera}\n        className=\"p-1.5 rounded-full text-slate-400 hover:bg-slate-700 hover:text-slate-200 transition-colors\"\n        title={isRtl ? \"  \" : \"Reset Camera\"}\n      >\n        <RotateCcw className=\"w-4 h-4\" />\n      </button>\n\n      {/* Measure Tool */}\n      <button\n        onClick={handleMeasureToggle}\n        className={`p-1.5 rounded-full transition-colors ${\n          measurement3DActive\n            ? \"bg-amber-600 text-white\"\n            : \"text-slate-400 hover:bg-slate-700 hover:text-slate-200\"\n        }`}\n        title={isRtl ? \" \" : \"Measure Tool\"}\n      >\n        <Ruler className=\"w-4 h-4\" />\n      </button>\n\n      {/* Divider */}\n      <div className=\"w-px h-5 bg-slate-600 mx-1\" />\n\n      {/* Render Quality */}\n      <div className=\"flex items-center gap-0.5\">\n        <button\n          onClick={() => setRenderQuality(\"low\")}\n          className={`px-2 py-1 text-xs rounded transition-colors ${\n            renderQuality === \"low\"\n              ? \"bg-slate-600 text-slate-200\"\n              : \"text-slate-500 hover:text-slate-300\"\n          }`}\n          title={isRtl ? \" \" : \"Low Quality\"}\n        >\n          L\n        </button>\n        <button\n          onClick={() => setRenderQuality(\"medium\")}\n          className={`px-2 py-1 text-xs rounded transition-colors ${\n            renderQuality === \"medium\"\n              ? \"bg-slate-600 text-slate-200\"\n              : \"text-slate-500 hover:text-slate-300\"\n          }`}\n          title={isRtl ? \" \" : \"Medium Quality\"}\n        >\n          M\n        </button>\n        <button\n          onClick={() => setRenderQuality(\"high\")}\n          className={`px-2 py-1 text-xs rounded transition-colors ${\n            renderQuality === \"high\"\n              ? \"bg-slate-600 text-slate-200\"\n              : \"text-slate-500 hover:text-slate-300\"\n          }`}\n          title={isRtl ? \" \" : \"High Quality\"}\n        >\n          H\n        </button>\n      </div>\n\n      {/* Shadows Toggle */}\n      <button\n        onClick={toggleShadows}\n        className={`p-1.5 rounded-full transition-colors ${\n          showShadows\n            ? \"text-yellow-400 bg-slate-700\"\n            : \"text-slate-500 hover:bg-slate-700 hover:text-slate-300\"\n        }`}\n        title={isRtl ? \"\" : \"Shadows\"}\n      >\n        {showShadows ? <Sun className=\"w-4 h-4\" /> : <Moon className=\"w-4 h-4\" />}\n      </button>\n\n      {/* Fullscreen */}\n      {onFullscreen && (\n        <button\n          onClick={onFullscreen}\n          className=\"p-1.5 rounded-full text-slate-400 hover:bg-slate-700 hover:text-slate-200 transition-colors\"\n          title={isRtl ? \" \" : \"Fullscreen\"}\n        >\n          <Maximize2 className=\"w-4 h-4\" />\n        </button>\n      )}\n\n      {/* Instructions */}\n      <div className=\"hidden sm:block text-xs text-slate-500 px-2 border-l border-slate-600 ml-1\">\n        {isRtl ? \"  |  \" : \"Drag to orbit | Scroll to zoom\"}\n      </div>\n    </div>\n  );\n}\n\nexport default Viewer3DControls;\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;;;;AAoBO,SAAS,iBAAiB,EAAE,YAAY,EAAE,YAAY,EAAE,EAAE,QAAQ,KAAK,EAAyB;IACrG,MAAM,EACJ,UAAU,EACV,aAAa,EACb,WAAW,EACX,mBAAmB,EACnB,aAAa,EACb,WAAW,EACX,gBAAgB,EAChB,aAAa,EACb,kBAAkB,EAClB,kBAAkB,EACnB,GAAG,IAAA,kJAAc;IAElB,MAAM,sBAAsB;QAC1B,IAAI,qBAAqB;YACvB;QACF,OAAO;YACL;QACF;IACF;IAEA,qBACE,8OAAC;QAAI,WAAW,CAAC,iHAAiH,EAAE,WAAW;;0BAE7I,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS,IAAM,cAAc;wBAC7B,WAAW,CAAC,qCAAqC,EAC/C,eAAe,UACX,2BACA,0DACJ;wBACF,OAAO,QAAQ,gBAAgB;kCAE/B,cAAA,8OAAC,oNAAM;4BAAC,WAAU;;;;;;;;;;;kCAEpB,8OAAC;wBACC,SAAS,IAAM,cAAc;wBAC7B,WAAW,CAAC,qCAAqC,EAC/C,eAAe,gBACX,2BACA,0DACJ;wBACF,OAAO,QAAQ,eAAe;kCAE9B,cAAA,8OAAC,0MAAI;4BAAC,WAAU;;;;;;;;;;;kCAElB,8OAAC;wBACC,SAAS,IAAM,cAAc;wBAC7B,WAAW,CAAC,qCAAqC,EAC/C,eAAe,SACX,2BACA,0DACJ;wBACF,OAAO,QAAQ,eAAe;kCAE9B,cAAA,8OAAC,gNAAM;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAKtB,8OAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAO,QAAQ,yBAAyB;0BAExC,cAAA,8OAAC,6NAAS;oBAAC,WAAU;;;;;;;;;;;0BAIvB,8OAAC;gBACC,SAAS;gBACT,WAAW,CAAC,qCAAqC,EAC/C,sBACI,4BACA,0DACJ;gBACF,OAAO,QAAQ,gBAAgB;0BAE/B,cAAA,8OAAC,6MAAK;oBAAC,WAAU;;;;;;;;;;;0BAInB,8OAAC;gBAAI,WAAU;;;;;;0BAGf,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS,IAAM,iBAAiB;wBAChC,WAAW,CAAC,4CAA4C,EACtD,kBAAkB,QACd,gCACA,uCACJ;wBACF,OAAO,QAAQ,gBAAgB;kCAChC;;;;;;kCAGD,8OAAC;wBACC,SAAS,IAAM,iBAAiB;wBAChC,WAAW,CAAC,4CAA4C,EACtD,kBAAkB,WACd,gCACA,uCACJ;wBACF,OAAO,QAAQ,gBAAgB;kCAChC;;;;;;kCAGD,8OAAC;wBACC,SAAS,IAAM,iBAAiB;wBAChC,WAAW,CAAC,4CAA4C,EACtD,kBAAkB,SACd,gCACA,uCACJ;wBACF,OAAO,QAAQ,eAAe;kCAC/B;;;;;;;;;;;;0BAMH,8OAAC;gBACC,SAAS;gBACT,WAAW,CAAC,qCAAqC,EAC/C,cACI,iCACA,0DACJ;gBACF,OAAO,QAAQ,WAAW;0BAEzB,4BAAc,8OAAC,uMAAG;oBAAC,WAAU;;;;;yCAAe,8OAAC,0MAAI;oBAAC,WAAU;;;;;;;;;;;YAI9D,8BACC,8OAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAO,QAAQ,eAAe;0BAE9B,cAAA,8OAAC,6NAAS;oBAAC,WAAU;;;;;;;;;;;0BAKzB,8OAAC;gBAAI,WAAU;0BACZ,QAAQ,iCAAiC;;;;;;;;;;;;AAIlD;uCAEe"}},
    {"offset": {"line": 2798, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/components/viewer/index.ts"],"sourcesContent":["export { ModelViewer } from \"./ModelViewer\";\nexport { ModelViewer3D } from \"./ModelViewer3D\";\nexport { FloorManager } from \"./FloorManager\";\nexport { SectionPlanePanel } from \"./SectionPlanePanel\";\nexport { Viewer3DControls } from \"./Viewer3DControls\";\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 2813, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/lib/api-client.ts"],"sourcesContent":["import type {\n  StateResponse,\n  StatePayload,\n  RunEvent,\n  Artifact,\n  Project,\n  Run,\n} from \"@/types\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000\";\n\n// Demo mode flag - set to true when backend is unavailable\nlet demoMode = false;\n\nclass ApiError extends Error {\n  constructor(\n    public status: number,\n    message: string\n  ) {\n    super(message);\n    this.name = \"ApiError\";\n  }\n}\n\nasync function handleResponse<T>(response: Response): Promise<T> {\n  if (!response.ok) {\n    const message = await response.text().catch(() => \"Unknown error\");\n    throw new ApiError(response.status, message);\n  }\n  return response.json();\n}\n\n// Demo data for when backend is unavailable\nconst demoProjects: Project[] = [\n  {\n    id: 1,\n    name: \"KAFD Tower Complex\",\n    region: \"saudi_arabia\",\n    building_type: \"office\",\n    phase: \"design_development\",\n    gfa: 45000,\n    floors: 32,\n    status: \"In progress\",\n  },\n  {\n    id: 2,\n    name: \"Al Maryah Residences\",\n    region: \"uae\",\n    building_type: \"residential\",\n    phase: \"schematic\",\n    gfa: 28000,\n    floors: 18,\n    status: \"Review\",\n  },\n  {\n    id: 3,\n    name: \"Qatar Innovation Hub\",\n    region: \"qatar\",\n    building_type: \"mixed_use\",\n    phase: \"construction_documents\",\n    gfa: 62000,\n    floors: 24,\n    status: \"Completed\",\n  },\n];\n\nlet nextProjectId = 100;\n\nexport const apiClient = {\n  // Check if backend is available\n  async checkBackend(): Promise<boolean> {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\n      const response = await fetch(`${API_BASE}/api/state`, {\n        signal: controller.signal,\n        method: \"GET\",\n      });\n      clearTimeout(timeoutId);\n      demoMode = !response.ok;\n      return response.ok;\n    } catch {\n      demoMode = true;\n      console.warn(\"Backend not available, using demo mode\");\n      return false;\n    }\n  },\n\n  isDemoMode(): boolean {\n    return demoMode;\n  },\n\n  // Check if backend is connected and return status info\n  getBackendStatus(): { available: boolean; message: string } {\n    if (demoMode) {\n      return {\n        available: false,\n        message: \"Backend server is not connected. Start the backend to view generated content.\",\n      };\n    }\n    return { available: true, message: \"\" };\n  },\n\n  // Retry backend connection\n  async retryConnection(): Promise<boolean> {\n    const wasDemo = demoMode;\n    const isAvailable = await this.checkBackend();\n    if (wasDemo && isAvailable) {\n      console.info(\"Backend connection restored\");\n    }\n    return isAvailable;\n  },\n\n  // State Management\n  async getState(): Promise<StateResponse> {\n    try {\n      const response = await fetch(`${API_BASE}/api/state`);\n      return handleResponse<StateResponse>(response);\n    } catch {\n      demoMode = true;\n      return { project: null, run: null, outputs: null };\n    }\n  },\n\n  async updateState(payload: StatePayload): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate project creation\n      const newProject: Project = {\n        id: nextProjectId++,\n        name: payload.project.name || \"New Project\",\n        region: payload.project.region || \"saudi_arabia\",\n        building_type: payload.project.building_type || \"office\",\n        phase: payload.project.phase || \"schematic\",\n        gfa: payload.project.gfa || 10000,\n        floors: payload.project.floors || 10,\n        status: \"Draft\",\n        ...payload.project,\n      };\n      demoProjects.unshift(newProject);\n      return { project: newProject, run: null, outputs: null };\n    }\n\n    const response = await fetch(`${API_BASE}/api/state`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    return handleResponse<StateResponse>(response);\n  },\n\n  // Project Operations\n  async createProject(project: Partial<Project>): Promise<StateResponse> {\n    return this.updateState({ project });\n  },\n\n  async getProject(id: string | number): Promise<Project | null> {\n    if (demoMode) {\n      const numericId = typeof id === \"number\" ? id : Number(id);\n      if (!Number.isFinite(numericId)) return null;\n      return demoProjects.find((p) => p.id === numericId) || null;\n    }\n    const state = await this.getState();\n    return state.project;\n  },\n\n  getProjects(): Project[] {\n    return demoProjects;\n  },\n\n  // Run Operations\n  async startRun(\n    projectId: string | number,\n    stage: \"architectural\" | \"full\" = \"full\"\n  ): Promise<StateResponse> {\n    if (demoMode) {\n      // Demo mode: simulate run creation\n      const project = demoProjects.find((p) => p.id === projectId);\n      if (project) {\n        project.status = \"In progress\";\n      }\n      return {\n        project: project || null,\n        run: {\n          id: Date.now(),\n          project_id: projectId,\n          status: \"In progress\",\n          conflicts: 0,\n          started_at: new Date().toISOString(),\n        },\n        outputs: null,\n      };\n    }\n\n    const response = await fetch(\n      `${API_BASE}/api/runs/start?project_id=${projectId}&stage=${stage}`,\n      { method: \"POST\" }\n    );\n    return handleResponse<StateResponse>(response);\n  },\n\n  async getRunEvents(runId: string | number): Promise<RunEvent[]> {\n    if (demoMode) {\n      // Demo mode: return sample events\n      return [\n        { id: 1, run_id: runId, message: \"Starting design generation...\", level: \"info\", step: \"init\", created_at: new Date().toISOString() },\n        { id: 2, run_id: runId, message: \"Analyzing site context\", level: \"info\", step: \"analysis\", created_at: new Date().toISOString() },\n        { id: 3, run_id: runId, message: \"Generating floor plans\", level: \"info\", step: \"architectural\", created_at: new Date().toISOString() },\n      ];\n    }\n\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/events`);\n    return handleResponse<RunEvent[]>(response);\n  },\n\n  async getRunArtifacts(runId: string | number): Promise<Artifact[]> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Artifacts not available - backend connection required\");\n      return [];\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/runs/${runId}/artifacts`);\n      return handleResponse<Artifact[]>(response);\n    } catch (error) {\n      console.error(\"Failed to fetch artifacts:\", error);\n      return [];\n    }\n  },\n\n  // Get the latest run for a specific project\n  async getLatestRunForProject(projectId: string | number): Promise<Run | null> {\n    if (demoMode) {\n      console.warn(\"[Demo Mode] Runs not available - backend connection required\");\n      return null;\n    }\n    try {\n      const response = await fetch(`${API_BASE}/api/projects/${projectId}/runs/latest`);\n      const data = await handleResponse<{ run: Run | null }>(response);\n      return data.run;\n    } catch {\n      return null;\n    }\n  },\n\n  // Plan Operations\n  async getPlanRevision(runId: string | number): Promise<Record<string, unknown>> {\n    if (demoMode) {\n      return {};\n    }\n    const response = await fetch(`${API_BASE}/api/runs/${runId}/plan`);\n    return handleResponse<Record<string, unknown>>(response);\n  },\n\n  async savePlanRevision(\n    runId: string | number,\n    payload: Record<string, unknown>\n  ): Promise<void> {\n    if (demoMode) {\n      console.log(\"Demo mode: Plan saved locally\", payload);\n      return;\n    }\n    await fetch(`${API_BASE}/api/runs/${runId}/plan`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ payload }),\n    });\n  },\n\n  // File URLs\n  getFileUrl(projectId: string | number, runId: string | number, fileName: string): string {\n    return `${API_BASE}/files/${projectId}/${runId}/${fileName}`;\n  },\n\n  // Generic file fetch\n  async fetchFile(url: string): Promise<string> {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to fetch file\");\n    }\n    return response.text();\n  },\n\n  // Get run outputs with file URLs\n  async getRunOutputs(\n    projectId: string | number,\n    runId: string | number\n  ): Promise<{\n    plan_svg?: string;\n    gltf?: string;\n    ifc?: string;\n    dxf?: string;\n    schedule?: string;\n    energy_report?: string;\n    structural_report?: string;\n    structural_plan?: string;\n    mep_layout?: string;\n    review_package?: string;\n  }> {\n    const artifacts = await this.getRunArtifacts(runId);\n    const outputs: Record<string, string> = {};\n\n    for (const artifact of artifacts) {\n      const url = this.getFileUrl(projectId, runId, artifact.file_name);\n      outputs[artifact.kind] = url;\n    }\n\n    return outputs;\n  },\n\n  // Download a file by triggering browser download\n  async downloadFile(\n    projectId: string | number,\n    runId: string | number,\n    fileName: string\n  ): Promise<void> {\n    const url = this.getFileUrl(projectId, runId, fileName);\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new ApiError(response.status, \"Failed to download file\");\n    }\n\n    const blob = await response.blob();\n    const downloadUrl = URL.createObjectURL(blob);\n\n    const a = document.createElement(\"a\");\n    a.href = downloadUrl;\n    a.download = fileName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(downloadUrl);\n  },\n};\n\nexport { ApiError };\n\n// Artifact kind constants for robust artifact finding\nexport const ARTIFACT_KINDS = {\n  PLAN_SVG: [\"plan\", \"plan_svg\"],\n  GLTF: [\"gltf\", \"model\", \"3d\"],\n  DXF: [\"dxf\", \"cad\"],\n  IFC: [\"ifc\", \"bim\"],\n  SCHEDULE: [\"schedule\", \"mep_schedule\"],\n  ENERGY_REPORT: [\"energy\", \"energy_report\"],\n  STRUCTURAL_REPORT: [\"structural\", \"structural_report\"],\n  STRUCTURAL_PLAN: [\"structural_plan\"],\n  MEP_LAYOUT: [\"mep\", \"mep_layout\"],\n  REVIEW_PACKAGE: [\"package\", \"review_package\"],\n} as const;\n\n// Helper to find artifact by kind with fallback to file extensions\nexport function findArtifactByKind(\n  artifacts: Artifact[],\n  kinds: readonly string[],\n  fileExtensions?: string[]\n): Artifact | undefined {\n  return artifacts.find((a) => {\n    // Check kind match\n    if (kinds.includes(a.kind)) return true;\n    // Check file extension match\n    if (fileExtensions?.some((ext) => a.file_name?.endsWith(ext))) return true;\n    return false;\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3184, "column": 0}, "map": {"version":3,"sources":["file:///Users/senos/Library/CloudStorage/GoogleDrive-ahmed0ibrahim%40gmail.com/My%20Drive/2023%20files/Development/new%20new%20ai%20designer/new-ai-designer/frontend/src/app/project/%5Bid%5D/3d-view/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useParams } from \"next/navigation\";\nimport { useEffect, useState, useCallback, useRef } from \"react\";\nimport { Box, Maximize, Minimize } from \"lucide-react\";\nimport { Card, CardContent, Button } from \"@/components/ui\";\nimport { ModelViewer3D, FloorManager, SectionPlanePanel, Viewer3DControls } from \"@/components/viewer\";\nimport { apiClient } from \"@/lib/api-client\";\nimport { useUIStore } from \"@/stores/ui-store\";\nimport { useProjectStore } from \"@/stores/project-store\";\nimport { useViewerStore } from \"@/stores/viewer-store\";\n\n// Feature flag for new viewer (can be controlled via env)\nconst USE_NEW_VIEWER = true;\n\nexport default function ThreeDViewPage() {\n  const params = useParams();\n  const { language } = useUIStore();\n  const { project, run, setProject, setRun } = useProjectStore();\n  const { setTotalFloors } = useViewerStore();\n  const isRtl = language === \"ar\";\n  const projectIdParam = Array.isArray(params.id) ? params.id[0] : params.id;\n  const projectId = projectIdParam ?? \"\";\n\n  const [modelUrl, setModelUrl] = useState<string | null>(null);\n  const [backendStatus, setBackendStatus] = useState({ available: true, message: \"\" });\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [showFloorPanel, setShowFloorPanel] = useState(true);\n  const [showSectionPanel, setShowSectionPanel] = useState(false);\n\n  const viewerContainerRef = useRef<HTMLDivElement>(null);\n\n  // Load project and run data\n  useEffect(() => {\n    const loadProjectAndRun = async () => {\n      // Check backend connection first\n      await apiClient.checkBackend();\n      const status = apiClient.getBackendStatus();\n      setBackendStatus(status);\n\n      const found = await apiClient.getProject(projectId);\n      if (found) {\n        setProject(found);\n        // Set total floors from project data\n        if (found.floors) {\n          setTotalFloors(found.floors);\n        }\n        // Load the latest run\n        const latestRun = await apiClient.getLatestRunForProject(projectId);\n        if (latestRun) {\n          setRun(latestRun);\n        }\n      }\n    };\n    loadProjectAndRun();\n  }, [projectId, setProject, setRun, setTotalFloors]);\n\n  // Retry connection handler\n  const handleRetryConnection = async () => {\n    const connected = await apiClient.retryConnection();\n    if (connected) {\n      window.location.reload();\n    } else {\n      setBackendStatus(apiClient.getBackendStatus());\n    }\n  };\n\n  // Load glTF model from artifacts\n  useEffect(() => {\n    const loadModel = async () => {\n      if (!run?.id || !project?.id) return;\n      try {\n        setModelUrl(null);\n        const artifacts = await apiClient.getRunArtifacts(run.id);\n        const gltfArtifact = artifacts.find(\n          (a) => a.kind === \"gltf\" || a.file_name?.endsWith(\".glb\") || a.file_name?.endsWith(\".gltf\")\n        );\n        if (gltfArtifact) {\n          const url = apiClient.getFileUrl(project.id, run.id, gltfArtifact.file_name);\n          setModelUrl(url);\n          return;\n        }\n\n        const state = await apiClient.getState().catch(() => null);\n        const outputFile = state?.outputs?.gltf_file;\n        const stateRunId = state?.run?.id ? String(state.run.id) : \"\";\n        const stateProjectId = state?.project?.id ? String(state.project.id) : \"\";\n        if (\n          outputFile &&\n          stateRunId &&\n          stateProjectId &&\n          stateRunId === String(run.id) &&\n          stateProjectId === String(project.id)\n        ) {\n          setModelUrl(apiClient.getFileUrl(project.id, run.id, outputFile));\n        }\n      } catch (error) {\n        console.error(\"Failed to load model:\", error);\n      }\n    };\n    loadModel();\n  }, [run?.id, project?.id]);\n\n  // Fullscreen handler\n  const handleFullscreen = useCallback(() => {\n    if (!viewerContainerRef.current) return;\n\n    if (!isFullscreen) {\n      if (viewerContainerRef.current.requestFullscreen) {\n        viewerContainerRef.current.requestFullscreen();\n      }\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      }\n    }\n  }, [isFullscreen]);\n\n  // Track fullscreen changes\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n    document.addEventListener(\"fullscreenchange\", handleFullscreenChange);\n    return () => document.removeEventListener(\"fullscreenchange\", handleFullscreenChange);\n  }, []);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if user is typing in an input\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      switch (e.key.toLowerCase()) {\n        case \"f\":\n          handleFullscreen();\n          break;\n        case \"l\":\n          setShowFloorPanel((prev) => !prev);\n          break;\n        case \"s\":\n          if (!e.ctrlKey && !e.metaKey) {\n            setShowSectionPanel((prev) => !prev);\n          }\n          break;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [handleFullscreen]);\n\n  return (\n    <div className=\"space-y-4 animate-fade-in\">\n      {/* Page Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <p className=\"text-xs font-bold uppercase tracking-[3px] text-[var(--accent-2)] mb-1\">\n            {project?.name || (isRtl ? \"\" : \"Project\")}\n          </p>\n          <h1 className=\"text-2xl font-bold text-[var(--ink)]\">\n            {isRtl ? \"  \" : \"3D View\"}\n          </h1>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={showFloorPanel ? \"primary\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setShowFloorPanel(!showFloorPanel)}\n            title=\"Toggle Floors (L)\"\n          >\n            {isRtl ? \"\" : \"Floors\"}\n          </Button>\n          <Button\n            variant={showSectionPanel ? \"primary\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setShowSectionPanel(!showSectionPanel)}\n            title=\"Toggle Sections (S)\"\n          >\n            {isRtl ? \"\" : \"Sections\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleFullscreen}\n            title=\"Fullscreen (F)\"\n          >\n            {isFullscreen ? (\n              <Minimize className=\"w-4 h-4\" />\n            ) : (\n              <Maximize className=\"w-4 h-4\" />\n            )}\n            <span className={isRtl ? \"mr-2\" : \"ml-2\"}>\n              {isRtl ? \" \" : \"Fullscreen\"}\n            </span>\n          </Button>\n        </div>\n      </div>\n\n      {/* 3D Viewer */}\n      <Card className=\"overflow-hidden\">\n        <CardContent className=\"p-0 relative\">\n          <div\n            ref={viewerContainerRef}\n            className={`relative ${isFullscreen ? \"fixed inset-0 z-50\" : \"min-h-[700px]\"}`}\n          >\n            {modelUrl ? (\n              USE_NEW_VIEWER ? (\n                <ModelViewer3D\n                  modelUrl={modelUrl}\n                  className={`w-full ${isFullscreen ? \"h-full\" : \"h-[700px]\"} rounded-[var(--radius-lg)]`}\n                />\n              ) : (\n                // Fallback to old viewer if needed\n                <div className=\"w-full h-[700px] bg-gradient-to-b from-slate-900 to-slate-800 rounded-[var(--radius-lg)] flex items-center justify-center text-slate-400\">\n                  Old viewer disabled\n                </div>\n              )\n            ) : (\n              <div\n                className={`w-full ${\n                  isFullscreen ? \"h-full\" : \"h-[700px]\"\n                } bg-gradient-to-b from-slate-900 to-slate-800 rounded-[var(--radius-lg)] flex items-center justify-center`}\n              >\n                <div className=\"text-center text-slate-400 max-w-md px-4\">\n                  <Box className=\"w-20 h-20 mx-auto mb-4 opacity-30\" />\n                  {!backendStatus.available ? (\n                    <>\n                      <p className=\"text-lg font-medium text-amber-500\">\n                        {isRtl ? \"  \" : \"Backend Not Connected\"}\n                      </p>\n                      <p className=\"text-sm mt-2\">\n                        {isRtl\n                          ? \"      \"\n                          : \"Start the backend server to view 3D models\"}\n                      </p>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"mt-4\"\n                        onClick={handleRetryConnection}\n                      >\n                        {isRtl ? \" \" : \"Retry Connection\"}\n                      </Button>\n                    </>\n                  ) : !run?.id ? (\n                    <>\n                      <p className=\"text-lg font-medium\">\n                        {isRtl ? \"   \" : \"No Active Run\"}\n                      </p>\n                      <p className=\"text-sm mt-2\">\n                        {isRtl\n                          ? \"    \"\n                          : \"Go to Orchestrator to start generation\"}\n                      </p>\n                    </>\n                  ) : (\n                    <>\n                      <p className=\"text-lg font-medium\">\n                        {isRtl ? \"  ...\" : \"Loading model...\"}\n                      </p>\n                      <p className=\"text-sm mt-2\">\n                        {isRtl\n                          ? \"    \"\n                          : \"Please wait while files are loading\"}\n                      </p>\n                    </>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Floor Manager Panel - Right Side */}\n            {showFloorPanel && modelUrl && (\n              <div className=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                <FloorManager isRtl={isRtl} />\n              </div>\n            )}\n\n            {/* Section Plane Panel - Left Side */}\n            {showSectionPanel && modelUrl && (\n              <div className=\"absolute left-4 top-1/2 -translate-y-1/2\">\n                <SectionPlanePanel isRtl={isRtl} />\n              </div>\n            )}\n\n            {/* Bottom Controls */}\n            {modelUrl && (\n              <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2\">\n                <Viewer3DControls\n                  isRtl={isRtl}\n                  onFullscreen={handleFullscreen}\n                />\n              </div>\n            )}\n\n            {/* Keyboard Shortcuts Help */}\n            {modelUrl && !isFullscreen && (\n              <div className=\"absolute bottom-4 left-4 text-xs text-slate-500\">\n                <span className=\"bg-slate-800/80 px-2 py-1 rounded\">\n                  {isRtl ? \"L:  | S:  | F:  \" : \"L: Floors | S: Sections | F: Fullscreen\"}\n                </span>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}