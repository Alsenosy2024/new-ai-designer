<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="ai-designer-api-base" content="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© - Ù…ØµÙ…Ù… AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.loading { background: #d1ecf1; color: #0c5460; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        .btn:hover { opacity: 0.9; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin-top: 20px;
            direction: ltr;
            text-align: left;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© - Ù…ØµÙ…Ù… AI</h1>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">
            Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨Ø¯ÙˆÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡
        </p>

        <div class="status success" id="status">
            â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...
        </div>

        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <input type="text" id="name" value="Ù…Ø´Ø±ÙˆØ¹ ØªØ¬Ø±ÙŠØ¨ÙŠ">
        </div>

        <div class="form-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¨Ù†Ù‰</label>
            <select id="type">
                <option value="office">Ù…ÙƒØ§ØªØ¨</option>
                <option value="residential">Ø³ÙƒÙ†ÙŠ</option>
                <option value="hotel">ÙÙ†Ø¯Ù‚</option>
                <option value="retail">ØªØ¬Ø§Ø±ÙŠ</option>
            </select>
        </div>

        <div class="form-group">
            <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
            <select id="region">
                <option value="saudi">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                <option value="uae">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
                <option value="qatar">Ù‚Ø·Ø±</option>
            </select>
        </div>

        <button class="btn" onclick="testAPI()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ (Ø¨Ø¯ÙˆÙ† ØªØµÙ…ÙŠÙ…)</button>

        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';

        // Check connection on load
        window.addEventListener('load', async () => {
            const status = document.getElementById('status');
            try {
                const response = await fetch(`${API_BASE}/api/state`);
                if (response.ok) {
                    status.className = 'status success';
                    status.textContent = 'âœ… Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø²';
                } else {
                    throw new Error();
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = 'âŒ Ø§Ù„Ø³ÙŠØ±ÙØ± ØºÙŠØ± Ù…ØªØµÙ„<br>Ø´ØºÙ‘Ù„: cd backend && uvicorn app.main:app --reload --port 8001';
            }
        });

        async function testAPI() {
            const resultDiv = document.getElementById('result');
            const status = document.getElementById('status');

            status.className = 'status loading';
            status.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...';
            resultDiv.innerHTML = '';

            const name = document.getElementById('name').value;
            const type = document.getElementById('type').value;
            const region = document.getElementById('region').value;

            try {
                // Step 1: Create project
                console.log('Sending request...');
                const response = await fetch(`${API_BASE}/api/state`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        project: {
                            name: name,
                            type: type,
                            region: region,
                            gfa: '10000',
                            floors: '10',
                            core_ratio: '0.12',
                            structural_system: 'moment_frame',
                            mep_strategy: 'central',
                            budget: 'standard'
                        }
                    })
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Response data:', data);

                if (!data.project?.id) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ ID Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
                }

                // Success!
                status.className = 'status success';
                status.textContent = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!';

                resultDiv.innerHTML = `
                    <h3 style="color: #667eea; margin-top: 20px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</h3>
                    <pre>${JSON.stringify(data.project, null, 2)}</pre>

                    <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                        <strong>Project ID:</strong> ${data.project.id}<br>
                        <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${data.project.name}<br>
                        <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${data.project.building_type}<br>
                        <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${data.project.region}<br>
                        <strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> ${data.project.gfa} Ù…Â²<br>
                        <strong>Ø§Ù„Ø·ÙˆØ§Ø¨Ù‚:</strong> ${data.project.floors}
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                        <strong>âœ¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¹Ù…Ù„!</strong><br>
                        Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ØŒ Ø§Ø³ØªØ®Ø¯Ù…:<br>
                        <code style="display: block; margin-top: 10px; padding: 10px; background: #333; color: #0f0; border-radius: 4px;">
                        cd backend && python test_agents.py
                        </code>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                status.className = 'status error';
                status.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£';

                resultDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 15px; background: #f8d7da; border-radius: 8px; color: #721c24;">
                        <strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}<br><br>
                        <strong>ØªØ­Ù‚Ù‚ Ù…Ù†:</strong><br>
                        â€¢ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ http://localhost:8001<br>
                        â€¢ Console Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ (F12)
                    </div>
                    <pre>${error.stack || error.toString()}</pre>
                `;
            }
        }
    </script>
</body>
</html>
